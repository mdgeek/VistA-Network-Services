KIDS Distribution saved on Apr 04, 2015@09:07:24
NETWORK SERVICES 1.0
**KIDS**:NETWORK SERVICES 1.0^NETSERV CONNECTION MANAGER 1.0^NETSERV WEB SERVER 1.0^NETSERV RPC BROKER 1.0^NETSERV OAUTH2 SERVICE 1.0^

**INSTALL NAME**
NETWORK SERVICES 1.0
"BLD",8510,0)
NETWORK SERVICES 1.0^NETWORK SERVICES^1^3150404^n
"BLD",8510,1,0)
^^7^7^3150401.074118
"BLD",8510,1,1,0)
This is a suite of network services including:
"BLD",8510,1,2,0)

"BLD",8510,1,3,0)
NETSERV CONNECTION MANAGER - Manages TCP connections for network services.
"BLD",8510,1,4,0)
NETSERV WEB SERVER         - HTTP Web Server
"BLD",8510,1,5,0)
NETSERV RPC BROKER         - Remote procedure call broker.
"BLD",8510,1,6,0)
NETSERV OATH2 SERVICE      - OAuth 2 implementation.
"BLD",8510,1,7,0)

"BLD",8510,6.3)
15
"BLD",8510,10,0)
^9.63^400^4
"BLD",8510,10,100,0)
NETSERV CONNECTION MANAGER 1.0^1
"BLD",8510,10,200,0)
NETSERV WEB SERVER 1.0^1
"BLD",8510,10,300,0)
NETSERV RPC BROKER 1.0^1
"BLD",8510,10,400,0)
NETSERV OAUTH2 SERVICE 1.0^1
"BLD",8510,10,"B","NETSERV CONNECTION MANAGER 1.0",100)

"BLD",8510,10,"B","NETSERV OAUTH2 SERVICE 1.0",400)

"BLD",8510,10,"B","NETSERV RPC BROKER 1.0",300)

"BLD",8510,10,"B","NETSERV WEB SERVER 1.0",200)

"BLD",8510,"KRN",0)
^9.67PA^779.2^20
"BLD",8510,"KRN",.4,0)
.4
"BLD",8510,"KRN",.401,0)
.401
"BLD",8510,"KRN",.402,0)
.402
"BLD",8510,"KRN",.403,0)
.403
"BLD",8510,"KRN",.5,0)
.5
"BLD",8510,"KRN",.84,0)
.84
"BLD",8510,"KRN",3.6,0)
3.6
"BLD",8510,"KRN",3.8,0)
3.8
"BLD",8510,"KRN",9.2,0)
9.2
"BLD",8510,"KRN",9.8,0)
9.8
"BLD",8510,"KRN",19,0)
19
"BLD",8510,"KRN",19.1,0)
19.1
"BLD",8510,"KRN",101,0)
101
"BLD",8510,"KRN",409.61,0)
409.61
"BLD",8510,"KRN",771,0)
771
"BLD",8510,"KRN",779.2,0)
779.2
"BLD",8510,"KRN",870,0)
870
"BLD",8510,"KRN",8989.51,0)
8989.51
"BLD",8510,"KRN",8989.52,0)
8989.52
"BLD",8510,"KRN",8994,0)
8994
"BLD",8510,"KRN","B",.4,.4)

"BLD",8510,"KRN","B",.401,.401)

"BLD",8510,"KRN","B",.402,.402)

"BLD",8510,"KRN","B",.403,.403)

"BLD",8510,"KRN","B",.5,.5)

"BLD",8510,"KRN","B",.84,.84)

"BLD",8510,"KRN","B",3.6,3.6)

"BLD",8510,"KRN","B",3.8,3.8)

"BLD",8510,"KRN","B",9.2,9.2)

"BLD",8510,"KRN","B",9.8,9.8)

"BLD",8510,"KRN","B",19,19)

"BLD",8510,"KRN","B",19.1,19.1)

"BLD",8510,"KRN","B",101,101)

"BLD",8510,"KRN","B",409.61,409.61)

"BLD",8510,"KRN","B",771,771)

"BLD",8510,"KRN","B",779.2,779.2)

"BLD",8510,"KRN","B",870,870)

"BLD",8510,"KRN","B",8989.51,8989.51)

"BLD",8510,"KRN","B",8989.52,8989.52)

"BLD",8510,"KRN","B",8994,8994)

"MBREQ")
0
"PKG",225,-1)
1^1
"PKG",225,0)
NETWORK SERVICES^RGNE^Network services
"PKG",225,20,0)
^9.402P^^
"PKG",225,22,0)
^9.49I^1^1
"PKG",225,22,1,0)
1.0^3150404
"PKG",225,22,1,1,0)
^^7^7^3150404
"PKG",225,22,1,1,1,0)
This is a suite of network services including:
"PKG",225,22,1,1,2,0)

"PKG",225,22,1,1,3,0)
NETSERV CONNECTION MANAGER - Manages TCP connections for network services.
"PKG",225,22,1,1,4,0)
NETSERV WEB SERVER         - HTTP Web Server
"PKG",225,22,1,1,5,0)
NETSERV RPC BROKER         - Remote procedure call broker.
"PKG",225,22,1,1,6,0)
NETSERV OATH2 SERVICE      - OAuth 2 implementation.
"PKG",225,22,1,1,7,0)

"PKG",225,"VERSION")
1.0
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"VER")
8.0^22.0
**INSTALL NAME**
NETSERV CONNECTION MANAGER 1.0
"BLD",8506,0)
NETSERV CONNECTION MANAGER 1.0^NETWORK SERVICES^0^3150404^n
"BLD",8506,1,0)
^^2^2^3150401.074349
"BLD",8506,1,1,0)
Manages TCP connections for various network services.  Provides concurrent
"BLD",8506,1,2,0)
socket modes for Intersystems Cache and for GT.M.
"BLD",8506,4,0)
^9.64PA^996.5^1
"BLD",8506,4,996.5,0)
996.5
"BLD",8506,4,996.5,222)
y^y^f^^^^n^^
"BLD",8506,4,996.5,224)

"BLD",8506,4,"B",996.5,996.5)

"BLD",8506,6.3)
44
"BLD",8506,"ABPKG")
n
"BLD",8506,"KRN",0)
^9.67PA^779.2^20
"BLD",8506,"KRN",.4,0)
.4
"BLD",8506,"KRN",.401,0)
.401
"BLD",8506,"KRN",.402,0)
.402
"BLD",8506,"KRN",.403,0)
.403
"BLD",8506,"KRN",.5,0)
.5
"BLD",8506,"KRN",.84,0)
.84
"BLD",8506,"KRN",3.6,0)
3.6
"BLD",8506,"KRN",3.8,0)
3.8
"BLD",8506,"KRN",9.2,0)
9.2
"BLD",8506,"KRN",9.8,0)
9.8
"BLD",8506,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",8506,"KRN",9.8,"NM",1,0)
RGNETTCP^^0^B81491712
"BLD",8506,"KRN",9.8,"NM","B","RGNETTCP",1)

"BLD",8506,"KRN",19,0)
19
"BLD",8506,"KRN",19.1,0)
19.1
"BLD",8506,"KRN",101,0)
101
"BLD",8506,"KRN",409.61,0)
409.61
"BLD",8506,"KRN",771,0)
771
"BLD",8506,"KRN",779.2,0)
779.2
"BLD",8506,"KRN",870,0)
870
"BLD",8506,"KRN",8989.51,0)
8989.51
"BLD",8506,"KRN",8989.52,0)
8989.52
"BLD",8506,"KRN",8994,0)
8994
"BLD",8506,"KRN","B",.4,.4)

"BLD",8506,"KRN","B",.401,.401)

"BLD",8506,"KRN","B",.402,.402)

"BLD",8506,"KRN","B",.403,.403)

"BLD",8506,"KRN","B",.5,.5)

"BLD",8506,"KRN","B",.84,.84)

"BLD",8506,"KRN","B",3.6,3.6)

"BLD",8506,"KRN","B",3.8,3.8)

"BLD",8506,"KRN","B",9.2,9.2)

"BLD",8506,"KRN","B",9.8,9.8)

"BLD",8506,"KRN","B",19,19)

"BLD",8506,"KRN","B",19.1,19.1)

"BLD",8506,"KRN","B",101,101)

"BLD",8506,"KRN","B",409.61,409.61)

"BLD",8506,"KRN","B",771,771)

"BLD",8506,"KRN","B",779.2,779.2)

"BLD",8506,"KRN","B",870,870)

"BLD",8506,"KRN","B",8989.51,8989.51)

"BLD",8506,"KRN","B",8989.52,8989.52)

"BLD",8506,"KRN","B",8994,8994)

"BLD",8506,"QUES",0)
^9.62^^
"BLD",8506,"REQB",0)
^9.611^1^1
"BLD",8506,"REQB",1,0)
RG UTILITIES 3.0^2
"BLD",8506,"REQB","B","RG UTILITIES 3.0",1)

"FIA",996.5)
NETSERV TCP LISTENER
"FIA",996.5,0)
^RGNET(996.5,
"FIA",996.5,0,0)
996.5
"FIA",996.5,0,1)
y^y^f^^^^n^^
"FIA",996.5,0,10)

"FIA",996.5,0,11)

"FIA",996.5,0,"RLRO")

"FIA",996.5,0,"VR")
1.0^NETSERV CONNECTION MANAGER
"FIA",996.5,996.5)
0
"MBREQ")
1
"PKG",225,-1)
1^1
"PKG",225,0)
NETWORK SERVICES^RGNE^Network services
"PKG",225,20,0)
^9.402P^^
"PKG",225,22,0)
^9.49I^1^1
"PKG",225,22,1,0)
1.0^3150404
"PKG",225,22,1,1,0)
^^2^2^3150404
"PKG",225,22,1,1,1,0)
Manages TCP connections for various network services.  Provides concurrent
"PKG",225,22,1,1,2,0)
socket modes for Intersystems Cache and for GT.M.
"PKG",225,"VERSION")
1.0
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","RGNETTCP")
0^1^B81491712
"RTN","RGNETTCP",1,0)
RGNETTCP ;RI/CBMI/DKM - TCP Connection Manager ;04-Apr-2015 09:05;DKM
"RTN","RGNETTCP",2,0)
 ;;1.0;NETWORK SERVICES;;29-Mar-2015;Build 44
"RTN","RGNETTCP",3,0)
 ;=================================================================
"RTN","RGNETTCP",4,0)
 ; Start a primary listener
"RTN","RGNETTCP",5,0)
START(RGCFG) ;
"RTN","RGNETTCP",6,0)
 D SSLIS(RGCFG,1)
"RTN","RGNETTCP",7,0)
 Q
"RTN","RGNETTCP",8,0)
 ; Stop a primary listener
"RTN","RGNETTCP",9,0)
STOP(RGCFG) ;
"RTN","RGNETTCP",10,0)
 D SSLIS(RGCFG,0)
"RTN","RGNETTCP",11,0)
 Q
"RTN","RGNETTCP",12,0)
 ; Restart a primary listener
"RTN","RGNETTCP",13,0)
RESTART(RGCFG) ;
"RTN","RGNETTCP",14,0)
 Q:$$OSCHECK
"RTN","RGNETTCP",15,0)
 D STOP(.RGCFG),START(.RGCFG)
"RTN","RGNETTCP",16,0)
 Q
"RTN","RGNETTCP",17,0)
 ; Start all primary listeners
"RTN","RGNETTCP",18,0)
STARTALL D SSALL(1)
"RTN","RGNETTCP",19,0)
 Q
"RTN","RGNETTCP",20,0)
 ; Stop all primary listeners
"RTN","RGNETTCP",21,0)
STOPALL D SSALL(0)
"RTN","RGNETTCP",22,0)
 Q
"RTN","RGNETTCP",23,0)
 ; Restart all primary listeners
"RTN","RGNETTCP",24,0)
RESTALL Q:$$OSCHECK
"RTN","RGNETTCP",25,0)
 D STOPALL,STARTALL
"RTN","RGNETTCP",26,0)
 Q
"RTN","RGNETTCP",27,0)
 ; List the status of all primary listeners
"RTN","RGNETTCP",28,0)
LISTALL Q:$$OSCHECK
"RTN","RGNETTCP",29,0)
 N RGCFG,LP,X
"RTN","RGNETTCP",30,0)
 F LP=0:0 S LP=$O(^RGNET(996.5,LP)) Q:'LP  D
"RTN","RGNETTCP",31,0)
 .K RGCFG
"RTN","RGNETTCP",32,0)
 .S RGCFG=LP
"RTN","RGNETTCP",33,0)
 .D GETCFG(.RGCFG)
"RTN","RGNETTCP",34,0)
 .S X=$$STATE
"RTN","RGNETTCP",35,0)
 .W RGCFG("name")," is",$S(X:"",1:" not")," running on port ",RGCFG("port"),".",!!
"RTN","RGNETTCP",36,0)
 Q
"RTN","RGNETTCP",37,0)
 ; Start/stop all registered listeners
"RTN","RGNETTCP",38,0)
 ; SS - 1 = start, 0 = stop
"RTN","RGNETTCP",39,0)
 ; SL - true = silent mode
"RTN","RGNETTCP",40,0)
SSALL(SS,SL) ;
"RTN","RGNETTCP",41,0)
 Q:$$OSCHECK(.SL)
"RTN","RGNETTCP",42,0)
 N RGCFG
"RTN","RGNETTCP",43,0)
 F RGCFG=0:0 S RGCFG=$O(^RGNET(996.5,RGCFG)) Q:'RGCFG  D SSLIS(RGCFG,SS,.SL)
"RTN","RGNETTCP",44,0)
 Q
"RTN","RGNETTCP",45,0)
 ; Start/stop primary listener
"RTN","RGNETTCP",46,0)
 ; SS - 1 = start, 0 = stop
"RTN","RGNETTCP",47,0)
 ; SL - true = silent mode
"RTN","RGNETTCP",48,0)
SSLIS(RGCFG,SS,SL) ;
"RTN","RGNETTCP",49,0)
 Q:$$OSCHECK(.SL)
"RTN","RGNETTCP",50,0)
 N $ET,SAME,RGMODE
"RTN","RGNETTCP",51,0)
 Q:'$$GETCFG(.RGCFG)
"RTN","RGNETTCP",52,0)
 S SL=$G(SL,$D(ZTQUEUED))
"RTN","RGNETTCP",53,0)
 S:'SL $ET="D SSERR^RGNETTCP"
"RTN","RGNETTCP",54,0)
 W:'SL RGCFG("name"),": "
"RTN","RGNETTCP",55,0)
 S SAME=$$STATE=SS
"RTN","RGNETTCP",56,0)
 S:'SS @$$LOCKNODE(.RGCFG)=1
"RTN","RGNETTCP",57,0)
 I SAME W:'SL $S(SS:"already",1:"not")," running.",!!  Q
"RTN","RGNETTCP",58,0)
 I SS,RGCFG("disabled") W:'SL "disabled.",!! Q
"RTN","RGNETTCP",59,0)
 D:SS JOB(0,.RGCFG)
"RTN","RGNETTCP",60,0)
 Q:SL
"RTN","RGNETTCP",61,0)
 N P1,P2,LP
"RTN","RGNETTCP",62,0)
 S P1=$S(SS:"start",1:"stop"),P2=P1_$S(SS:"ed",1:"ped")
"RTN","RGNETTCP",63,0)
 W "waiting for ",P1," signal..."
"RTN","RGNETTCP",64,0)
 F LP=1:1:5 D
"RTN","RGNETTCP",65,0)
 .H 2
"RTN","RGNETTCP",66,0)
 .W "."
"RTN","RGNETTCP",67,0)
 .S:$$STATE=SS LP=99
"RTN","RGNETTCP",68,0)
 I LP<99 W " failed to ",P1,".",!!
"RTN","RGNETTCP",69,0)
 E  W " ",P2," on port ",RGCFG("port"),".",!!
"RTN","RGNETTCP",70,0)
 Q
"RTN","RGNETTCP",71,0)
SSERR W "failed: ",$$EC^%ZOSV,!!
"RTN","RGNETTCP",72,0)
 D UNWIND^%ZTER
"RTN","RGNETTCP",73,0)
 Q
"RTN","RGNETTCP",74,0)
 ; Fetch listener configuration
"RTN","RGNETTCP",75,0)
 ; Populates RGCFG with configuration data.
"RTN","RGNETTCP",76,0)
 ; Returns listener IEN
"RTN","RGNETTCP",77,0)
GETCFG(RGCFG) ;
"RTN","RGNETTCP",78,0)
 Q:$D(RGCFG)=11 RGCFG
"RTN","RGNETTCP",79,0)
 S:RGCFG'=+RGCFG RGCFG=+$O(^RGNET(996.5,"B",RGCFG,0))
"RTN","RGNETTCP",80,0)
 I RGCFG D
"RTN","RGNETTCP",81,0)
 .N N0,LP
"RTN","RGNETTCP",82,0)
 .S N0=^RGNET(996.5,RGCFG,0),RGCFG("handler")=$G(^(10))
"RTN","RGNETTCP",83,0)
 .F LP=1:1:5 S RGCFG($P("name^port^uci^disabled^maximum",U,LP))=$P(N0,U,LP)
"RTN","RGNETTCP",84,0)
 Q:$Q RGCFG
"RTN","RGNETTCP",85,0)
 Q
"RTN","RGNETTCP",86,0)
 ; Entry point for GT.M socket dispatch
"RTN","RGNETTCP",87,0)
GTMEP D EN(2,$ZCM)
"RTN","RGNETTCP",88,0)
 Q
"RTN","RGNETTCP",89,0)
 ; Start listener as background process
"RTN","RGNETTCP",90,0)
 ; Returns true if operation was successful.
"RTN","RGNETTCP",91,0)
JOB(RGMODE,RGCFG) ;
"RTN","RGNETTCP",92,0)
 N SUCCESS
"RTN","RGNETTCP",93,0)
 I RGMODE>1 S SUCCESS=0
"RTN","RGNETTCP",94,0)
 E  I '$$GETCFG(.RGCFG) S SUCCESS=0
"RTN","RGNETTCP",95,0)
 E  I RGMODE=1 D
"RTN","RGNETTCP",96,0)
 .X "J EN^RGNETTCP(RGMODE,RGCFG):(:4:RGTDEV:RGTDEV):15"
"RTN","RGNETTCP",97,0)
 .S SUCCESS=$T
"RTN","RGNETTCP",98,0)
 E  I $L(RGCFG("uci")) D
"RTN","RGNETTCP",99,0)
 .X "J EN^RGNETTCP(RGMODE,RGCFG)[RGCFG(""uci"")]"
"RTN","RGNETTCP",100,0)
 .S SUCCESS=$T
"RTN","RGNETTCP",101,0)
 E  D
"RTN","RGNETTCP",102,0)
 .J EN^RGNETTCP(RGMODE,RGCFG)
"RTN","RGNETTCP",103,0)
 .S SUCCESS=$T
"RTN","RGNETTCP",104,0)
 Q:$Q SUCCESS
"RTN","RGNETTCP",105,0)
 Q
"RTN","RGNETTCP",106,0)
 ; Start listener process (primary and secondary)
"RTN","RGNETTCP",107,0)
 ;   RGMODE = Connection type:
"RTN","RGNETTCP",108,0)
 ;     0: primary listener   - dispatches connections
"RTN","RGNETTCP",109,0)
 ;     1: secondary listener - dispatched by primary listener
"RTN","RGNETTCP",110,0)
 ;     2: secondary listener - dispatched by OS
"RTN","RGNETTCP",111,0)
 ;     3: debug listener     - debug mode listener
"RTN","RGNETTCP",112,0)
 ;   RGCFG = Listener name or IEN
"RTN","RGNETTCP",113,0)
EN(RGMODE,RGCFG) ;
"RTN","RGNETTCP",114,0)
 N RGTDEV,RGQUIT,RGRETRY,RGOS,$ET,$ES
"RTN","RGNETTCP",115,0)
 S U="^",DT=$$DT^XLFDT,$ET="D ETRAP1^RGNETTCP"
"RTN","RGNETTCP",116,0)
 D:'$$GETCFG(.RGCFG) RAISE("Unknown listener.")
"RTN","RGNETTCP",117,0)
 Q:RGCFG("disabled")
"RTN","RGNETTCP",118,0)
 S (RGQUIT,RGRETRY)=0,RGOS=$$OS
"RTN","RGNETTCP",119,0)
 D:RGOS<0 RAISE("Unsupported operating system.")
"RTN","RGNETTCP",120,0)
 I RGOS,RGMODE'>1 D BADMODE                                            ; GT.M supports only modes 2 and 3
"RTN","RGNETTCP",121,0)
 I 'RGOS,RGMODE=2 D BADMODE                                            ; Cache does not support mode 2
"RTN","RGNETTCP",122,0)
 Q:'$$STATE(1)                                                         ; Quit if listener already running
"RTN","RGNETTCP",123,0)
 D CLEANUP,STSAVE(0),NULLOPEN,STSAVE(1)                                ; Initialize environment
"RTN","RGNETTCP",124,0)
 D CHPRN(.RGCFG)                                                       ; Change process name
"RTN","RGNETTCP",125,0)
 F  D LISTEN Q:RGQUIT>0!RGMODE                                         ; Main loop
"RTN","RGNETTCP",126,0)
 D STATE(0),STREST(1),^%ZISC,STREST(0),CLEANUP,LOGOUT^XUSRB:$G(DUZ)
"RTN","RGNETTCP",127,0)
 Q
"RTN","RGNETTCP",128,0)
 ; Entry point for interactive debugging
"RTN","RGNETTCP",129,0)
DEBUG N PORT,CFG
"RTN","RGNETTCP",130,0)
 D TITLE^RGUT("Debug Mode Support",$P($T(+2),";",3))
"RTN","RGNETTCP",131,0)
 F  D  Q:$D(CFG)
"RTN","RGNETTCP",132,0)
 .S CFG=$$ENTRY^RGUTLKP(996.5,,"Enter listener name: ")
"RTN","RGNETTCP",133,0)
 .W !
"RTN","RGNETTCP",134,0)
 .Q:CFG'>0
"RTN","RGNETTCP",135,0)
 .D GETCFG(.CFG)
"RTN","RGNETTCP",136,0)
 .I CFG("disabled") W "That listener is disabled.  Try again.",! K CFG
"RTN","RGNETTCP",137,0)
 Q:CFG'>0
"RTN","RGNETTCP",138,0)
 S PORT=$$PMPT("Port","Enter listener port.",CFG("port"))
"RTN","RGNETTCP",139,0)
 Q:U[PORT
"RTN","RGNETTCP",140,0)
 S CFG("port")=PORT
"RTN","RGNETTCP",141,0)
 I $L($T(^%Serenji)),$$ASK^RGUT("Use Serenji Debugger","Y") D  Q
"RTN","RGNETTCP",142,0)
 .N SRJIP,SRJPORT
"RTN","RGNETTCP",143,0)
 .S SRJIP=$$PMPT("Serenji Listener Addr","Enter Serenji listener address",IP)
"RTN","RGNETTCP",144,0)
 .Q:U[SRJIP
"RTN","RGNETTCP",145,0)
 .S SRJPORT=$$PMPT("Serenji Listener Port","Enter Serenji listener port",4321)
"RTN","RGNETTCP",146,0)
 .Q:U[SRJPORT
"RTN","RGNETTCP",147,0)
 .D DEBUG^%Serenji("EN^RGNETTCP(3,.CFG)",SRJIP,SRJPORT)
"RTN","RGNETTCP",148,0)
 W !,"Now listening on port ",CFG("port"),!
"RTN","RGNETTCP",149,0)
 D EN(3,.CFG)
"RTN","RGNETTCP",150,0)
 Q
"RTN","RGNETTCP",151,0)
 ; Prompt for user input
"RTN","RGNETTCP",152,0)
PMPT(PMPT,HELP,DFLT) ;
"RTN","RGNETTCP",153,0)
 N RET
"RTN","RGNETTCP",154,0)
 F  D  Q:$D(RET)
"RTN","RGNETTCP",155,0)
 .W PMPT,": ",$S($D(DFLT):DFLT_"// ",1:"")
"RTN","RGNETTCP",156,0)
 .R RET:$G(DTIME,30)
"RTN","RGNETTCP",157,0)
 .E  S RET=U
"RTN","RGNETTCP",158,0)
 .I $D(DFLT),'$L(RET) S RET=DFLT W DFLT
"RTN","RGNETTCP",159,0)
 .W !
"RTN","RGNETTCP",160,0)
 .I RET["?" W !,HELP,!! K RET
"RTN","RGNETTCP",161,0)
 Q RET
"RTN","RGNETTCP",162,0)
 ; Determine operating system
"RTN","RGNETTCP",163,0)
 ; Returns 0 = Cache, 1 = GT.M, -1 = unknown
"RTN","RGNETTCP",164,0)
OS() N OS
"RTN","RGNETTCP",165,0)
 S OS=$P($G(^%ZOSF("OS")),U)
"RTN","RGNETTCP",166,0)
 Q $S(OS["OpenM":0,OS["GT.M":1,1:-1)
"RTN","RGNETTCP",167,0)
 ; Displays function not available message for GT.M environments
"RTN","RGNETTCP",168,0)
 ; Returns 1 if function not available.
"RTN","RGNETTCP",169,0)
OSCHECK(SL) ;
"RTN","RGNETTCP",170,0)
 Q:'$$OS 0
"RTN","RGNETTCP",171,0)
 W:'$G(SL) "That function is not available for this environment.",!
"RTN","RGNETTCP",172,0)
 Q 1
"RTN","RGNETTCP",173,0)
 ; Main loop
"RTN","RGNETTCP",174,0)
LISTEN N $ET,$ES,RGOUT,RGSTATE,HNDLR
"RTN","RGNETTCP",175,0)
 S $ET="D ETRAP2^RGNETTCP",RGQUIT='$$TCPOPEN,RGOUT=""
"RTN","RGNETTCP",176,0)
 S HNDLR=RGCFG("handler")_"(.RGSTATE)"
"RTN","RGNETTCP",177,0)
 F  Q:$$QUIT  D
"RTN","RGNETTCP",178,0)
 .D TCPUSE
"RTN","RGNETTCP",179,0)
 .D:RGMODE @HNDLR
"RTN","RGNETTCP",180,0)
 .D:'RGMODE WAIT
"RTN","RGNETTCP",181,0)
 .D TCPFLUSH
"RTN","RGNETTCP",182,0)
 D TCPCLOSE
"RTN","RGNETTCP",183,0)
 Q
"RTN","RGNETTCP",184,0)
 ; Wait for connection request, then spawn handler (RGMODE = 0)
"RTN","RGNETTCP",185,0)
WAIT N X
"RTN","RGNETTCP",186,0)
 R X:10
"RTN","RGNETTCP",187,0)
 D:$T JOB(1,.RGCFG)
"RTN","RGNETTCP",188,0)
 Q
"RTN","RGNETTCP",189,0)
 ; Return temp global root
"RTN","RGNETTCP",190,0)
TMPGBL() Q $NA(^TMP("RGNETTCP",$J))
"RTN","RGNETTCP",191,0)
 ; Cleanup environment
"RTN","RGNETTCP",192,0)
CLEANUP K @$$TMPGBL,^XUTL("XQ",$J),@$$LOCKNODE(.RGCFG)
"RTN","RGNETTCP",193,0)
 Q
"RTN","RGNETTCP",194,0)
 ; Returns true if listener should quit
"RTN","RGNETTCP",195,0)
QUIT() S:'RGQUIT RGQUIT=RGRETRY>5
"RTN","RGNETTCP",196,0)
 S:'RGQUIT RGQUIT=+$G(@$$LOCKNODE(.RGCFG))
"RTN","RGNETTCP",197,0)
 I 'RGQUIT,RGMODE=3 S RGQUIT=$$QUIT3
"RTN","RGNETTCP",198,0)
 Q RGQUIT
"RTN","RGNETTCP",199,0)
 ; Allows user to request quit in debug mode
"RTN","RGNETTCP",200,0)
QUIT3() N X
"RTN","RGNETTCP",201,0)
 U $P
"RTN","RGNETTCP",202,0)
 R X#1:0
"RTN","RGNETTCP",203,0)
 D TCPUSE
"RTN","RGNETTCP",204,0)
 Q X=U
"RTN","RGNETTCP",205,0)
 ; Save application state
"RTN","RGNETTCP",206,0)
STSAVE(ST) ;
"RTN","RGNETTCP",207,0)
 D SAVE^XUS1
"RTN","RGNETTCP",208,0)
 K @$$TMPGBL@(ST)
"RTN","RGNETTCP",209,0)
 M @$$TMPGBL@(ST)=^XUTL("XQ",$J)
"RTN","RGNETTCP",210,0)
 Q
"RTN","RGNETTCP",211,0)
 ; Restore application state
"RTN","RGNETTCP",212,0)
STREST(ST) ;
"RTN","RGNETTCP",213,0)
 K ^XUTL("XQ",$J)
"RTN","RGNETTCP",214,0)
 M ^XUTL("XQ",$J)=@$$TMPGBL@(ST)
"RTN","RGNETTCP",215,0)
 K IO
"RTN","RGNETTCP",216,0)
 D RESETVAR^%ZIS
"RTN","RGNETTCP",217,0)
 I ST,$D(IO)#2 D
"RTN","RGNETTCP",218,0)
 .N $ET
"RTN","RGNETTCP",219,0)
 .S $ET="S $EC="""" D NULLOPEN^RGNETTCP"
"RTN","RGNETTCP",220,0)
 .U IO
"RTN","RGNETTCP",221,0)
 Q
"RTN","RGNETTCP",222,0)
 ; Establish null device as default IO device
"RTN","RGNETTCP",223,0)
NULLOPEN N %ZIS,IOP,POP
"RTN","RGNETTCP",224,0)
 S %ZIS="0H",IOP="NULL"
"RTN","RGNETTCP",225,0)
 D ^%ZIS,RAISE("Failed to open null device."):POP
"RTN","RGNETTCP",226,0)
 U IO
"RTN","RGNETTCP",227,0)
 Q
"RTN","RGNETTCP",228,0)
 ; Open TCP listener port
"RTN","RGNETTCP",229,0)
 ; Returns true if successful
"RTN","RGNETTCP",230,0)
TCPOPEN() ;
"RTN","RGNETTCP",231,0)
 N POP
"RTN","RGNETTCP",232,0)
 S POP=0
"RTN","RGNETTCP",233,0)
 I RGMODE=3 D
"RTN","RGNETTCP",234,0)
 .I RGOS D
"RTN","RGNETTCP",235,0)
 ..S RGTDEV="server$"_RGCFG("port")
"RTN","RGNETTCP",236,0)
 ..X "O RGTDEV:(ZLISTEN=RGCFG(""port"")_"":TCP"":attach=""server""):9999:""socket"""
"RTN","RGNETTCP",237,0)
 ..X:$T "U RGTDEV:(nowrap:nodelimiter:ioerror=""ETRAP2^RGNETTCP"")"
"RTN","RGNETTCP",238,0)
 ..S POP='$T
"RTN","RGNETTCP",239,0)
 .E  D
"RTN","RGNETTCP",240,0)
 ..S RGTDEV="|TCP|"_RGCFG("port")
"RTN","RGNETTCP",241,0)
 ..X "O RGTDEV:(:RGCFG(""port""):""DS""):9999"
"RTN","RGNETTCP",242,0)
 ..S POP='$T
"RTN","RGNETTCP",243,0)
 E  I RGMODE D
"RTN","RGNETTCP",244,0)
 .S RGTDEV=$P
"RTN","RGNETTCP",245,0)
 .I RGOS D
"RTN","RGNETTCP",246,0)
 ..S @"$ZINTERRUPT=""I $$JOBEXAM^ZU($ZPOSITION)"""
"RTN","RGNETTCP",247,0)
 ..X "U RGTDEV:(nowrap:nodelimiter:ioerror=""ETRAP2^RGNETTCP"")"
"RTN","RGNETTCP",248,0)
 E  D
"RTN","RGNETTCP",249,0)
 .I 'RGOS D
"RTN","RGNETTCP",250,0)
 ..S RGTDEV="|TCP|"_RGCFG("port")
"RTN","RGNETTCP",251,0)
 ..X "O RGTDEV:(:RGCFG(""port""):""ADS""):5"
"RTN","RGNETTCP",252,0)
 ..S POP='$T
"RTN","RGNETTCP",253,0)
 Q 'POP
"RTN","RGNETTCP",254,0)
 ; Use TCP listener port
"RTN","RGNETTCP",255,0)
TCPUSE U RGTDEV
"RTN","RGNETTCP",256,0)
 Q
"RTN","RGNETTCP",257,0)
 ; Close TCP listener port
"RTN","RGNETTCP",258,0)
TCPCLOSE C:$D(RGTDEV) RGTDEV
"RTN","RGNETTCP",259,0)
 Q
"RTN","RGNETTCP",260,0)
 ; Return CNT characters from input buffer
"RTN","RGNETTCP",261,0)
 ; CNT = # of characters to return
"RTN","RGNETTCP",262,0)
 ; TMO = Optional timeout in seconds
"RTN","RGNETTCP",263,0)
 ; USE = If true or not specified, call TCPUSE before read
"RTN","RGNETTCP",264,0)
TCPREAD(CNT,TMO,USE) ;
"RTN","RGNETTCP",265,0)
 Q:CNT'>0 ""
"RTN","RGNETTCP",266,0)
 N X
"RTN","RGNETTCP",267,0)
 D:$G(USE,1) TCPUSE
"RTN","RGNETTCP",268,0)
 S TMO=+$G(TMO)
"RTN","RGNETTCP",269,0)
 R X#CNT:TMO
"RTN","RGNETTCP",270,0)
 Q X
"RTN","RGNETTCP",271,0)
 ; Read up to termination sequence
"RTN","RGNETTCP",272,0)
 ; TRM = Read termination sequence (included in returned value)
"RTN","RGNETTCP",273,0)
 ; TMO = Optional timeout in seconds
"RTN","RGNETTCP",274,0)
TCPREADT(TRM,TMO) ;
"RTN","RGNETTCP",275,0)
 N ST,L,X,USE
"RTN","RGNETTCP",276,0)
 S LN="",L=$L(TRM)-1,USE=1
"RTN","RGNETTCP",277,0)
 F  S X=$$TCPREAD(1,.TMO,USE) Q:'$L(X)  D  Q:L<0
"RTN","RGNETTCP",278,0)
 .S LN=LN_X,(TMO,USE)=0
"RTN","RGNETTCP",279,0)
 .S:$E(LN,$L(LN)-L,$L(LN))=TRM L=-1
"RTN","RGNETTCP",280,0)
 Q LN
"RTN","RGNETTCP",281,0)
 ; Read one byte from socket
"RTN","RGNETTCP",282,0)
 ; TMO = Optional timeout in seconds
"RTN","RGNETTCP",283,0)
TCPREADB(TMO) ;
"RTN","RGNETTCP",284,0)
 Q $A($$TCPREAD(1,.TMO))
"RTN","RGNETTCP",285,0)
 ; Write data to socket
"RTN","RGNETTCP",286,0)
 ; All write operations must be done via this method.
"RTN","RGNETTCP",287,0)
 ; This operation is buffered with a write threshold at 1024 bytes.
"RTN","RGNETTCP",288,0)
 ; DATA = Date to write
"RTN","RGNETTCP",289,0)
TCPWRITE(DATA) ;
"RTN","RGNETTCP",290,0)
 S RGOUT=RGOUT_DATA
"RTN","RGNETTCP",291,0)
 D:$L(RGOUT)>1024 TCPFLUSH
"RTN","RGNETTCP",292,0)
 Q
"RTN","RGNETTCP",293,0)
 ; Flush the output buffer
"RTN","RGNETTCP",294,0)
TCPFLUSH Q:'$L(RGOUT)
"RTN","RGNETTCP",295,0)
 D TCPUSE
"RTN","RGNETTCP",296,0)
 W RGOUT,!
"RTN","RGNETTCP",297,0)
 S RGOUT=""
"RTN","RGNETTCP",298,0)
 Q
"RTN","RGNETTCP",299,0)
 ; Write array (local or global) to TCP stream
"RTN","RGNETTCP",300,0)
 ; ARY  = Local or global array reference
"RTN","RGNETTCP",301,0)
 ; EOL  = Line terminator to add (optional)
"RTN","RGNETTCP",302,0)
 ; KILL = If true, kill array after writing (default is false)
"RTN","RGNETTCP",303,0)
ARYOUT(ARY,EOL,KILL) ;
"RTN","RGNETTCP",304,0)
 N ND,LN
"RTN","RGNETTCP",305,0)
 Q:'$L(ARY)
"RTN","RGNETTCP",306,0)
 S ARY=$NA(@ARY)
"RTN","RGNETTCP",307,0)
 S ND=ARY,LN=$QL(ARY),EOL=$G(EOL)
"RTN","RGNETTCP",308,0)
 F  S ND=$Q(@ND) Q:'$L(ND)  Q:$NA(@ND,LN)'=ARY  D TCPWRITE(@ND_EOL)
"RTN","RGNETTCP",309,0)
 K:$G(KILL) @ARY
"RTN","RGNETTCP",310,0)
 Q
"RTN","RGNETTCP",311,0)
 ; Write contents of a file to TCP stream
"RTN","RGNETTCP",312,0)
 ; FIL  = File path
"RTN","RGNETTCP",313,0)
 ; EOL  = Line terminator to add (optional)
"RTN","RGNETTCP",314,0)
 ; KILL = If true, delete the file after writing (default is false)
"RTN","RGNETTCP",315,0)
FILOUT(FIL,EOL,KILL) ;
"RTN","RGNETTCP",316,0)
 N LN
"RTN","RGNETTCP",317,0)
 S EOL=$G(EOL)
"RTN","RGNETTCP",318,0)
 D OPEN^RGUTOS(.FIL,"R")
"RTN","RGNETTCP",319,0)
 F  Q:$$READ^RGUTOS(.LN,FIL)  D TCPWRITE(LN_EOL)
"RTN","RGNETTCP",320,0)
 D CLOSE^RGUTOS(.FIL)
"RTN","RGNETTCP",321,0)
 D:$G(KILL) DELETE^RGUTOS(FIL)
"RTN","RGNETTCP",322,0)
 Q
"RTN","RGNETTCP",323,0)
 ; Throw a bad mode exception
"RTN","RGNETTCP",324,0)
BADMODE D RAISE("Mode not supported for OS.")
"RTN","RGNETTCP",325,0)
 Q
"RTN","RGNETTCP",326,0)
 ; Raise an exception
"RTN","RGNETTCP",327,0)
RAISE(MSG) ;
"RTN","RGNETTCP",328,0)
 D RAISE^RGUTOS(MSG)
"RTN","RGNETTCP",329,0)
 Q
"RTN","RGNETTCP",330,0)
 ; Startup error
"RTN","RGNETTCP",331,0)
ETRAP1 S RGQUIT=1
"RTN","RGNETTCP",332,0)
 D ^%ZTER,UNWIND^%ZTER
"RTN","RGNETTCP",333,0)
 Q
"RTN","RGNETTCP",334,0)
 ; Communication error
"RTN","RGNETTCP",335,0)
ETRAP2 S RGRETRY=RGRETRY+1
"RTN","RGNETTCP",336,0)
 S:RGQUIT'>0 RGQUIT=$S(RGRETRY>5:1,'RGMODE:-1,1:0)
"RTN","RGNETTCP",337,0)
 D:RGRETRY=1 ^%ZTER
"RTN","RGNETTCP",338,0)
 D UNWIND^%ZTER
"RTN","RGNETTCP",339,0)
 Q
"RTN","RGNETTCP",340,0)
 ; Lock/Unlock listener
"RTN","RGNETTCP",341,0)
 ; ACT:  1 = lock, 0 = unlock, missing = return status
"RTN","RGNETTCP",342,0)
 ; Returns true if locked, false if not.
"RTN","RGNETTCP",343,0)
STATE(ACT) ;
"RTN","RGNETTCP",344,0)
 N RES,LN
"RTN","RGNETTCP",345,0)
 S LN=$$LOCKNODE(.RGCFG)
"RTN","RGNETTCP",346,0)
 I '$D(ACT) D
"RTN","RGNETTCP",347,0)
 .L +@LN:0
"RTN","RGNETTCP",348,0)
 .S RES='$T
"RTN","RGNETTCP",349,0)
 .L:'RES -@LN
"RTN","RGNETTCP",350,0)
 E  I ACT D
"RTN","RGNETTCP",351,0)
 .L +@LN:1
"RTN","RGNETTCP",352,0)
 .S RES=$T
"RTN","RGNETTCP",353,0)
 E  D
"RTN","RGNETTCP",354,0)
 .L -@LN
"RTN","RGNETTCP",355,0)
 .S RES=0
"RTN","RGNETTCP",356,0)
 Q:$Q RES
"RTN","RGNETTCP",357,0)
 Q
"RTN","RGNETTCP",358,0)
 ; Get global reference for lock node
"RTN","RGNETTCP",359,0)
LOCKNODE(RGCFG) ;
"RTN","RGNETTCP",360,0)
 Q:'$$GETCFG(.RGCFG) ""
"RTN","RGNETTCP",361,0)
 Q $NA(^[RGCFG("uci")]XTMP("RGNETTCP","LN",RGCFG,$S($G(RGMODE):$J,1:0)))
"RTN","RGNETTCP",362,0)
 ; Change process name to reflect active listener
"RTN","RGNETTCP",363,0)
CHPRN(RGCFG) ;
"RTN","RGNETTCP",364,0)
 D SETNM^%ZOSV("RGNETTCP_"_RGCFG("port"))
"RTN","RGNETTCP",365,0)
 Q
"SEC","^DIC",996.5,996.5,0,"AUDIT")
@
"SEC","^DIC",996.5,996.5,0,"DD")
@
"SEC","^DIC",996.5,996.5,0,"DEL")
@
"SEC","^DIC",996.5,996.5,0,"LAYGO")
@
"SEC","^DIC",996.5,996.5,0,"RD")
@
"SEC","^DIC",996.5,996.5,0,"WR")
@
"VER")
8.0^22.0
"^DD",996.5,996.5,0)
FIELD^^4^6
"^DD",996.5,996.5,0,"DDA")
N
"^DD",996.5,996.5,0,"DT")
3150330
"^DD",996.5,996.5,0,"IX","B",996.5,.01)

"^DD",996.5,996.5,0,"NM","NETSERV TCP LISTENER")

"^DD",996.5,996.5,.01,0)
NAME^RF^^0;1^K:$L(X)>30!(X?.N)!($L(X)<3)!'(X'?1P.E) X
"^DD",996.5,996.5,.01,1,0)
^.1
"^DD",996.5,996.5,.01,1,1,0)
996.5^B
"^DD",996.5,996.5,.01,1,1,1)
S ^RGNET(996.5,"B",$E(X,1,30),DA)=""
"^DD",996.5,996.5,.01,1,1,2)
K ^RGNET(996.5,"B",$E(X,1,30),DA)
"^DD",996.5,996.5,.01,3)
NAME MUST BE 3-30 CHARACTERS, NOT NUMERIC OR STARTING WITH PUNCTUATION
"^DD",996.5,996.5,.01,21,0)
^^1^1^3150330.090909
"^DD",996.5,996.5,.01,21,1,0)
This is the unique name for the primary listener.
"^DD",996.5,996.5,1,0)
PORT^NJ5,0^^0;2^K:+X'=X!(X>32767)!(X<1)!(X?.E1"."1N.N) X
"^DD",996.5,996.5,1,3)
Enter the TCP port number.
"^DD",996.5,996.5,1,21,0)
^^2^2^3150330.090954
"^DD",996.5,996.5,1,21,1,0)
This is the TCP port that the primary listener uses to service connection
"^DD",996.5,996.5,1,21,2,0)
requests.
"^DD",996.5,996.5,1,"DT")
3150329
"^DD",996.5,996.5,2,0)
UCI^F^^0;3^K:$L(X)>10!($L(X)<1) X
"^DD",996.5,996.5,2,3)
Enter the target UCI (none = current).
"^DD",996.5,996.5,2,21,0)
^^2^2^3150330.091148
"^DD",996.5,996.5,2,21,1,0)
This is the UCI where the primary listener should be spawned.  If not specified,
"^DD",996.5,996.5,2,21,2,0)
the primary listener will reside in the same UCI where it was initially spawned.
"^DD",996.5,996.5,2,"DT")
3150329
"^DD",996.5,996.5,3,0)
DISABLE^S^0:NO;1:YES;^0;4^Q
"^DD",996.5,996.5,3,3)
Enter YES to disable the listener.
"^DD",996.5,996.5,3,21,0)
^^2^2^3150330.091254
"^DD",996.5,996.5,3,21,1,0)
If set to YES, attempts to spawn a primary or secondary listener will fail.
"^DD",996.5,996.5,3,21,2,0)
This has no impact on currently running listeners.
"^DD",996.5,996.5,3,"DT")
3150330
"^DD",996.5,996.5,4,0)
MAXIMUM^NJ6,0^^0;5^K:+X'=X!(X>999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",996.5,996.5,4,3)
Enter the maximum number of secondary listeners.
"^DD",996.5,996.5,4,21,0)
^.001^3^3^3150330^
"^DD",996.5,996.5,4,21,1,0)
This sets the maximum allowable number of secondary listeners that may be 
"^DD",996.5,996.5,4,21,2,0)
spawned by the primary listener.  When this number is exceeded, additional
"^DD",996.5,996.5,4,21,3,0)
connection requests will be denied.
"^DD",996.5,996.5,4,"DT")
3150330
"^DD",996.5,996.5,10,0)
HANDLER^FX^^10;E1,250^K:X'?.8AN1"^"1.8AN X
"^DD",996.5,996.5,10,3)
Enter entry point for I/O handler as TAG^ROUTINE.
"^DD",996.5,996.5,10,21,0)
^^7^7^3150330.091725
"^DD",996.5,996.5,10,21,1,0)
This is the entry point (as TAG^ROUTINE) that will service an established
"^DD",996.5,996.5,10,21,2,0)
connection.  The handler should relinquish control back to the caller after
"^DD",996.5,996.5,10,21,3,0)
completing each request/response cycle to allow the caller to determine if
"^DD",996.5,996.5,10,21,4,0)
the connection should be terminated.  The handler may request termination
"^DD",996.5,996.5,10,21,5,0)
by setting RGQUIT to a nonzero value.  Otherwise, unless an external request
"^DD",996.5,996.5,10,21,6,0)
to terminate the connection has been received, the handler will be called
"^DD",996.5,996.5,10,21,7,0)
again.
"^DD",996.5,996.5,10,"DT")
3150330
"^DIC",996.5,996.5,0)
NETSERV TCP LISTENER^996.5
"^DIC",996.5,996.5,0,"GL")
^RGNET(996.5,
"^DIC",996.5,996.5,"%D",0)
^1.001^2^2^3150330^
"^DIC",996.5,996.5,"%D",1,0)
Each entry in this file represents a configuration for a listener that will
"^DIC",996.5,996.5,"%D",2,0)
process requests on a given TCP port via the specified handler.
"^DIC",996.5,"B","NETSERV TCP LISTENER",996.5)

**INSTALL NAME**
NETSERV WEB SERVER 1.0
"BLD",8508,0)
NETSERV WEB SERVER 1.0^NETWORK SERVICES^0^3150404^n
"BLD",8508,1,0)
^^3^3^3150401.074908
"BLD",8508,1,1,0)
This is an implementation of a Web Server that uses the NETSERV connection
"BLD",8508,1,2,0)
manager.  It can be used not only to serve web pages, but also for web
"BLD",8508,1,3,0)
service endpoints for SOAP or REST interfaces.
"BLD",8508,4,0)
^9.64PA^996.5^3
"BLD",8508,4,996.5,0)
996.5
"BLD",8508,4,996.5,222)
n^y^f^^n^^y^o^n
"BLD",8508,4,996.5,224)
I $G(^RGNET(996.5,Y,10))["^RGNETW"
"BLD",8508,4,996.51,0)
996.51
"BLD",8508,4,996.51,222)
y^y^f^^n^^y^o^n
"BLD",8508,4,996.52,0)
996.52
"BLD",8508,4,996.52,222)
y^y^f^^n^^y^o^n
"BLD",8508,4,996.52,224)
I $G(^RGNET(996.52,Y,10))["^RGNETW"
"BLD",8508,4,"B",996.5,996.5)

"BLD",8508,4,"B",996.51,996.51)

"BLD",8508,4,"B",996.52,996.52)

"BLD",8508,6.3)
44
"BLD",8508,"ABPKG")
n
"BLD",8508,"KRN",0)
^9.67PA^779.2^20
"BLD",8508,"KRN",.4,0)
.4
"BLD",8508,"KRN",.401,0)
.401
"BLD",8508,"KRN",.402,0)
.402
"BLD",8508,"KRN",.403,0)
.403
"BLD",8508,"KRN",.5,0)
.5
"BLD",8508,"KRN",.84,0)
.84
"BLD",8508,"KRN",3.6,0)
3.6
"BLD",8508,"KRN",3.8,0)
3.8
"BLD",8508,"KRN",9.2,0)
9.2
"BLD",8508,"KRN",9.8,0)
9.8
"BLD",8508,"KRN",9.8,"NM",0)
^9.68A^3^2
"BLD",8508,"KRN",9.8,"NM",2,0)
RGNETWWW^^0^B82369018
"BLD",8508,"KRN",9.8,"NM",3,0)
RGNETWRR^^0^B31409526
"BLD",8508,"KRN",9.8,"NM","B","RGNETWRR",3)

"BLD",8508,"KRN",9.8,"NM","B","RGNETWWW",2)

"BLD",8508,"KRN",19,0)
19
"BLD",8508,"KRN",19.1,0)
19.1
"BLD",8508,"KRN",101,0)
101
"BLD",8508,"KRN",409.61,0)
409.61
"BLD",8508,"KRN",771,0)
771
"BLD",8508,"KRN",779.2,0)
779.2
"BLD",8508,"KRN",870,0)
870
"BLD",8508,"KRN",8989.51,0)
8989.51
"BLD",8508,"KRN",8989.52,0)
8989.52
"BLD",8508,"KRN",8994,0)
8994
"BLD",8508,"KRN","B",.4,.4)

"BLD",8508,"KRN","B",.401,.401)

"BLD",8508,"KRN","B",.402,.402)

"BLD",8508,"KRN","B",.403,.403)

"BLD",8508,"KRN","B",.5,.5)

"BLD",8508,"KRN","B",.84,.84)

"BLD",8508,"KRN","B",3.6,3.6)

"BLD",8508,"KRN","B",3.8,3.8)

"BLD",8508,"KRN","B",9.2,9.2)

"BLD",8508,"KRN","B",9.8,9.8)

"BLD",8508,"KRN","B",19,19)

"BLD",8508,"KRN","B",19.1,19.1)

"BLD",8508,"KRN","B",101,101)

"BLD",8508,"KRN","B",409.61,409.61)

"BLD",8508,"KRN","B",771,771)

"BLD",8508,"KRN","B",779.2,779.2)

"BLD",8508,"KRN","B",870,870)

"BLD",8508,"KRN","B",8989.51,8989.51)

"BLD",8508,"KRN","B",8989.52,8989.52)

"BLD",8508,"KRN","B",8994,8994)

"BLD",8508,"QUES",0)
^9.62^^
"BLD",8508,"REQB",0)
^9.611^1^1
"BLD",8508,"REQB",1,0)
NETSERV CONNECTION MANAGER 1.0^2
"BLD",8508,"REQB","B","NETSERV CONNECTION MANAGER 1.0",1)

"DATA",996.5,1,0)
HTTP ENDPOINT^9080^^0^^
"DATA",996.5,1,10)
NETSERV^RGNETWWW
"DATA",996.51,100,0)
100^Continue
"DATA",996.51,101,0)
101^Switching Protocols
"DATA",996.51,102,0)
102^Processing (WebDAV)
"DATA",996.51,200,0)
200^OK
"DATA",996.51,201,0)
201^Created
"DATA",996.51,202,0)
202^Accepted
"DATA",996.51,203,0)
203^Non-Authoritative Information
"DATA",996.51,204,0)
204^No Content
"DATA",996.51,205,0)
205^Reset Content
"DATA",996.51,206,0)
206^Partial Content
"DATA",996.51,207,0)
207^Multi-Status (WebDAV)
"DATA",996.51,208,0)
208^Already Reported (WebDAV)
"DATA",996.51,226,0)
226^IM Used
"DATA",996.51,300,0)
300^Multiple Choices
"DATA",996.51,301,0)
301^Moved Permanently
"DATA",996.51,302,0)
302^Found
"DATA",996.51,303,0)
303^See Other
"DATA",996.51,304,0)
304^Not Modified
"DATA",996.51,305,0)
305^Use Proxy
"DATA",996.51,306,0)
306^(Unused)
"DATA",996.51,307,0)
307^Temporary Redirect
"DATA",996.51,308,0)
308^Permanent Redirect (experiemental)
"DATA",996.51,400,0)
400^Bad Request
"DATA",996.51,401,0)
401^Unauthorized
"DATA",996.51,402,0)
402^Payment Required
"DATA",996.51,403,0)
403^Forbidden
"DATA",996.51,404,0)
404^Not Found
"DATA",996.51,405,0)
405^Method Not Allowed
"DATA",996.51,406,0)
406^Not Acceptable
"DATA",996.51,407,0)
407^Proxy Authentication Required
"DATA",996.51,408,0)
408^Request Timeout
"DATA",996.51,409,0)
409^Conflict
"DATA",996.51,410,0)
410^Gone
"DATA",996.51,411,0)
411^Length Required
"DATA",996.51,412,0)
412^Precondition Failed
"DATA",996.51,413,0)
413^Request Entity Too Large
"DATA",996.51,414,0)
414^Request-URI Too Long
"DATA",996.51,415,0)
415^Unsupported Media Type
"DATA",996.51,416,0)
416^Requested Range Not Satisfiable
"DATA",996.51,417,0)
417^Expectation Failed
"DATA",996.51,418,0)
418^I'm a teapot (RFC 2324)
"DATA",996.51,420,0)
420^Enhance Your Calm (Twitter)
"DATA",996.51,422,0)
422^Unprocessable Entity (WebDAV)
"DATA",996.51,423,0)
423^Locked (WebDAV)
"DATA",996.51,424,0)
424^Failed Dependency (WebDAV)
"DATA",996.51,425,0)
425^Reserved for WebDAV
"DATA",996.51,426,0)
426^Upgrade Required
"DATA",996.51,428,0)
428^Precondition Required
"DATA",996.51,429,0)
429^Too Many Requests
"DATA",996.51,431,0)
431^Request Header Fields Too Large
"DATA",996.51,444,0)
444^No Response (Nginx)
"DATA",996.51,449,0)
449^Retry With (Microsoft)
"DATA",996.51,450,0)
450^Blocked by Windows Parental Controls (Microsoft)
"DATA",996.51,499,0)
499^Client Closed Request (Nginx)
"DATA",996.51,500,0)
500^Internal Server Error
"DATA",996.51,501,0)
501^Not Implemented
"DATA",996.51,502,0)
502^Bad Gateway
"DATA",996.51,503,0)
503^Service Unavailable
"DATA",996.51,504,0)
504^Gateway Timeout
"DATA",996.51,505,0)
505^HTTP Version Not Supported
"DATA",996.51,506,0)
506^Variant Also Negotiates (Experimental)
"DATA",996.51,507,0)
507^Insufficient Storage (WebDAV)
"DATA",996.51,508,0)
508^Loop Detected (WebDAV)
"DATA",996.51,509,0)
509^Bandwidth Limit Exceeded (Apache)
"DATA",996.51,510,0)
510^Not Extended
"DATA",996.51,511,0)
511^Network Authentication Required
"DATA",996.51,598,0)
598^Network read timeout error
"DATA",996.51,599,0)
599^Network connect timeout error
"DATA",996.52,6,0)
/^GET^
"DATA",996.52,6,10)
GREETING^RGNETWWW
"DATA",996.52,6,99,0)
^996.5299^1^1^3150330.181114
"DATA",996.52,6,99,1,0)
This is the root endpoint for this service.
"DATA",996.52,7,0)
UTILITY/RTN^GET^BASIC
"DATA",996.52,7,10)
RTN^RGNETWRR
"DATA",996.52,8,0)
UTILITY/RPC^GET^BASIC
"DATA",996.52,8,10)
RPC^RGNETWRR
"FIA",996.5)
NETSERV TCP LISTENER
"FIA",996.5,0)
^RGNET(996.5,
"FIA",996.5,0,0)
996.5
"FIA",996.5,0,1)
n^y^f^^n^^y^o^n
"FIA",996.5,0,10)

"FIA",996.5,0,11)
I $G(^RGNET(996.5,Y,10))["^RGNETW"
"FIA",996.5,0,"RLRO")

"FIA",996.5,0,"VR")
1.0^NETSERV WEB SERVER
"FIA",996.5,996.5)
0
"FIA",996.51)
NETSERV HTTP STATUS
"FIA",996.51,0)
^RGNET(996.51,
"FIA",996.51,0,0)
996.51
"FIA",996.51,0,1)
y^y^f^^n^^y^o^n
"FIA",996.51,0,10)

"FIA",996.51,0,11)

"FIA",996.51,0,"RLRO")

"FIA",996.51,0,"VR")
1.0^NETSERV WEB SERVER
"FIA",996.51,996.51)
0
"FIA",996.52)
NETSERV HTTP ENDPOINT
"FIA",996.52,0)
^RGNET(996.52,
"FIA",996.52,0,0)
996.52
"FIA",996.52,0,1)
y^y^f^^n^^y^o^n
"FIA",996.52,0,10)

"FIA",996.52,0,11)
I $G(^RGNET(996.52,Y,10))["^RGNETW"
"FIA",996.52,0,"RLRO")

"FIA",996.52,0,"VR")
1.0^NETSERV WEB SERVER
"FIA",996.52,996.52)
0
"FIA",996.52,996.5299)
0
"IX",996.52,996.52,"C",0)
996.52^C^Compound index by METHOD and URL.^MU^^R^IR^I^996.52^^^^^LS
"IX",996.52,996.52,"C",1)
S ^RGNET(996.52,"C",X(1),X(2),DA)=$$TOPTRN^RGNETWWW(X(2))
"IX",996.52,996.52,"C",2)
K ^RGNET(996.52,"C",X(1),X(2),DA)
"IX",996.52,996.52,"C",2.5)
K ^RGNET(996.52,"C")
"IX",996.52,996.52,"C",11.1,0)
^.114IA^2^2
"IX",996.52,996.52,"C",11.1,1,0)
1^F^996.52^1^10^1^F
"IX",996.52,996.52,"C",11.1,2,0)
2^F^996.52^.01^150^2^F
"MBREQ")
1
"PKG",225,-1)
1^1
"PKG",225,0)
NETWORK SERVICES^RGNE^Network services
"PKG",225,20,0)
^9.402P^^
"PKG",225,22,0)
^9.49I^1^1
"PKG",225,22,1,0)
1.0^3150404
"PKG",225,22,1,1,0)
^^3^3^3150404
"PKG",225,22,1,1,1,0)
This is an implementation of a Web Server that uses the NETSERV connection
"PKG",225,22,1,1,2,0)
manager.  It can be used not only to serve web pages, but also for web
"PKG",225,22,1,1,3,0)
service endpoints for SOAP or REST interfaces.
"PKG",225,"VERSION")
1.0
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","RGNETWRR")
0^3^B31409526
"RTN","RGNETWRR",1,0)
RGNETWRR ;RI/CBMI/DKM - Web endpoint for RPC and routine lookup ;01-Apr-2015 11:20;DKM
"RTN","RGNETWRR",2,0)
 ;;1.0;RGSERV WEB SERVER;;1-Apr-2015;Build 44
"RTN","RGNETWRR",3,0)
 ;=================================================================
"RTN","RGNETWRR",4,0)
 ; RPC lookup entry point
"RTN","RGNETWRR",5,0)
RPC N RPC,RPCX,RTN,TAG,IEN,CCH,LN,X,Y,Z
"RTN","RGNETWRR",6,0)
 S Y="Remote Procedure Inquiry ("_$$UCI^RGUTOS(1)_")"
"RTN","RGNETWRR",7,0)
 D ADDCSS
"RTN","RGNETWRR",8,0)
 D BODY("<title>"_Y_"</title>")
"RTN","RGNETWRR",9,0)
 D BODY("<h1>"_Y_"</h1><br>")
"RTN","RGNETWRR",10,0)
 D BODY("<form method=GET action='RPC'>")
"RTN","RGNETWRR",11,0)
 D BODY("RPC Name: ")
"RTN","RGNETWRR",12,0)
 D BODY("<input name='NAME' type=text autofocus></input>")
"RTN","RGNETWRR",13,0)
 D BODY("<input type=submit value='Search'>")
"RTN","RGNETWRR",14,0)
 D BODY("</form>")
"RTN","RGNETWRR",15,0)
 D BODY("<br><div class='content'/>")
"RTN","RGNETWRR",16,0)
 S RPC=$$GETPARAM^RGNETWWW("NAME"),RPCX=RPC,LN=$L(RPCX)
"RTN","RGNETWRR",17,0)
 Q:'LN
"RTN","RGNETWRR",18,0)
 D BODY("<table>")
"RTN","RGNETWRR",19,0)
 F X="NAME","ENTRY POINT","RETURN TYPE","WRAP","DESCRIPTION" D
"RTN","RGNETWRR",20,0)
 .D BODY("<th>"_X_"</th>")
"RTN","RGNETWRR",21,0)
 F  D  S RPCX=$O(^XWB(8994,"B",RPCX)) Q:$E(RPCX,1,LN)'=RPC
"RTN","RGNETWRR",22,0)
 .F IEN=0:0 S IEN=$O(^XWB(8994,"B",RPCX,IEN)) Q:'IEN  D
"RTN","RGNETWRR",23,0)
 ..D BODY("<tr bgcolor=#"_$$COLOR(.CCH)_">")
"RTN","RGNETWRR",24,0)
 ..S Y=$G(^XWB(8994,IEN,0)),RTN=$P(Y,U,3),TAG=$P(Y,U,2)
"RTN","RGNETWRR",25,0)
 ..D CELL($P(Y,U))
"RTN","RGNETWRR",26,0)
 ..D CELL("<a target='"_$$UCI^RGUTOS(1)_":RTN' href='RTN?NAME="_TAG_U_RTN_$S($L(TAG):"#"_TAG,1:"")_"'>"_$P(Y,U,2,3)_"</a>",1)
"RTN","RGNETWRR",27,0)
 ..D SET($P(Y,U,4),8994,.04)
"RTN","RGNETWRR",28,0)
 ..D SET($P(Y,U,8),8994,.08)
"RTN","RGNETWRR",29,0)
 ..D BODY("<td>")
"RTN","RGNETWRR",30,0)
 ..; Output RPC Description
"RTN","RGNETWRR",31,0)
 ..S Z=0
"RTN","RGNETWRR",32,0)
 ..F X=0:0 S X=$O(^XWB(8994,IEN,1,X)) Q:'X  S Y=$$ESCAPE(^(X,0)) D
"RTN","RGNETWRR",33,0)
 ...I 'Z D
"RTN","RGNETWRR",34,0)
 ....D BODY("<table><tr><td><br><pre>")
"RTN","RGNETWRR",35,0)
 ....S Z=1
"RTN","RGNETWRR",36,0)
 ...D BODY(Y)
"RTN","RGNETWRR",37,0)
 ..D:Z BODY("</pre></td></tr></table>")
"RTN","RGNETWRR",38,0)
 ..; Output Parameter Descriptions
"RTN","RGNETWRR",39,0)
 ..S Z=0
"RTN","RGNETWRR",40,0)
 ..F X=0:0 S X=$O(^XWB(8994,IEN,2,X)) Q:'X  S Y=$$ESCAPE(^(X,0)) D
"RTN","RGNETWRR",41,0)
 ...I 'Z D
"RTN","RGNETWRR",42,0)
 ....D BODY("<table>")
"RTN","RGNETWRR",43,0)
 ....F Z="NAME","TYPE","DESCRIPTION" D BODY("<th>"_Z_"</th>")
"RTN","RGNETWRR",44,0)
 ....S Z=1
"RTN","RGNETWRR",45,0)
 ...D BODY("<tr>")
"RTN","RGNETWRR",46,0)
 ...D CELL($P(Y,U),1)
"RTN","RGNETWRR",47,0)
 ...D SET($P(Y,U,2),8994.02,.02)
"RTN","RGNETWRR",48,0)
 ...D BODY("<td><br><pre>")
"RTN","RGNETWRR",49,0)
 ...F Y=0:0 S Y=$O(^XWB(8994,IEN,2,X,1,Y)) Q:'Y  D BODY($$ESCAPE(^(Y,0))) S Z=2
"RTN","RGNETWRR",50,0)
 ...D:Z'=2 BODY("none")
"RTN","RGNETWRR",51,0)
 ...D BODY("</pre></td></tr>")
"RTN","RGNETWRR",52,0)
 ..D:Z BODY("</table>")
"RTN","RGNETWRR",53,0)
 ..; Output Return Description
"RTN","RGNETWRR",54,0)
 ..S Z=0
"RTN","RGNETWRR",55,0)
 ..F X=0:0 S X=$O(^XWB(8994,IEN,3,X)) Q:'X  S Y=$$ESCAPE(^(X,0)) D
"RTN","RGNETWRR",56,0)
 ...I 'Z D
"RTN","RGNETWRR",57,0)
 ....D BODY("<table><th>RETURN VALUE</th><tr><td><br><pre>")
"RTN","RGNETWRR",58,0)
 ....S Z=1
"RTN","RGNETWRR",59,0)
 ...D BODY(Y)
"RTN","RGNETWRR",60,0)
 ..D:Z BODY("</pre></td></tr></table>")
"RTN","RGNETWRR",61,0)
 ..D BODY("</td></tr>")
"RTN","RGNETWRR",62,0)
 D BODY("</table></div>")
"RTN","RGNETWRR",63,0)
 Q
"RTN","RGNETWRR",64,0)
 ; Routine lookup endpoint
"RTN","RGNETWRR",65,0)
RTN N RTN,TAG,BLD,LN,X,X1,X2,XL,XP,Y
"RTN","RGNETWRR",66,0)
 S Y=$$UCI^RGUTOS(1),X="Routine Inquiry ("_Y_")"
"RTN","RGNETWRR",67,0)
 S RTN=$$GETPARAM^RGNETWWW("NAME"),TAG=" "
"RTN","RGNETWRR",68,0)
 D ADDCSS
"RTN","RGNETWRR",69,0)
 D:'$L(RTN) BODY("<title>"_X_"</title>")
"RTN","RGNETWRR",70,0)
 D:$L(RTN) BODY("<title>"_Y_": "_RTN_"</title>")
"RTN","RGNETWRR",71,0)
 D BODY("<h1>"_X_"</h1><br>")
"RTN","RGNETWRR",72,0)
 D BODY("<form method=GET action='RTN'>")
"RTN","RGNETWRR",73,0)
 D BODY("Routine Name: ")
"RTN","RGNETWRR",74,0)
 D BODY("<input name='NAME' type=text autofocus value='"_RTN_"'></input>")
"RTN","RGNETWRR",75,0)
 D BODY("<input type=submit value='Search'>")
"RTN","RGNETWRR",76,0)
 D BODY("</form>")
"RTN","RGNETWRR",77,0)
 D BODY("<br><div class='content highlight'>")
"RTN","RGNETWRR",78,0)
 Q:'$L(RTN)
"RTN","RGNETWRR",79,0)
 S:RTN[U TAG=$P(RTN,U),RTN=$P(RTN,U,2)
"RTN","RGNETWRR",80,0)
 I '$$TEST^RGUTRTN(RTN) D  Q
"RTN","RGNETWRR",81,0)
 .D BODY("<h2>Routine not found.</h2>")
"RTN","RGNETWRR",82,0)
 I '$L($T(+1^@RTN)) D  Q
"RTN","RGNETWRR",83,0)
 .D BODY("<h2>Source code not found.</h2>")
"RTN","RGNETWRR",84,0)
 D BODY("<pre>")
"RTN","RGNETWRR",85,0)
 F LN=1:1 S X=$T(+LN^@RTN) Q:'$L(X)  D
"RTN","RGNETWRR",86,0)
 .S X1=$P(X," "),X2=$P(X," ",2,9999)
"RTN","RGNETWRR",87,0)
 .S XP=$P(X1,"(",2,999),X1=$P(X1,"("),XL=$L(X1),BLD=X1=TAG
"RTN","RGNETWRR",88,0)
 .S:$L(XP) XP="("_XP
"RTN","RGNETWRR",89,0)
 .D:XL BODY("<a NAME='"_X1_"'></a>")
"RTN","RGNETWRR",90,0)
 .S X1=$$LJ^XLFSTR(X1_XP,8)
"RTN","RGNETWRR",91,0)
 .S:BLD X1="<span class='bold'>"_$E(X1,1,XL)_"</span>"_$E(X1,XL+1,999)
"RTN","RGNETWRR",92,0)
 .D ADDLNK(.X2)
"RTN","RGNETWRR",93,0)
 .S X2=$TR($$ESCAPE^RGNETWWW(X2),$C(1,2),"<>")
"RTN","RGNETWRR",94,0)
 .D BODY(X1_" "_X2)
"RTN","RGNETWRR",95,0)
 D BODY("</pre></div>")
"RTN","RGNETWRR",96,0)
 Q
"RTN","RGNETWRR",97,0)
ADDCSS D BODY("<style>")
"RTN","RGNETWRR",98,0)
 D BODY("body {overflow:hidden}")
"RTN","RGNETWRR",99,0)
 D BODY("input[type=submit] {background:none}")
"RTN","RGNETWRR",100,0)
 D BODY("td {vertical-align: middle}")
"RTN","RGNETWRR",101,0)
 D BODY(".content {position:absolute;top:120px;bottom:0;left:0;right:0;overflow:auto;padding:2px;margin:5px}")
"RTN","RGNETWRR",102,0)
 D BODY(".bold {font-weight:bold;color:red}")
"RTN","RGNETWRR",103,0)
 D BODY(".highlight {background:antiquewhite}")
"RTN","RGNETWRR",104,0)
 D BODY("table {width:100%}")
"RTN","RGNETWRR",105,0)
 D BODY("table, th, td, .highlight {border:1px solid black}")
"RTN","RGNETWRR",106,0)
 D BODY("</style>")
"RTN","RGNETWRR",107,0)
 Q
"RTN","RGNETWRR",108,0)
ADDLNK(TXT) ;
"RTN","RGNETWRR",109,0)
 N P,R,S,C,Q,E,E1,B,PC
"RTN","RGNETWRR",110,0)
 S S=0,Q=0,R=0,E=""
"RTN","RGNETWRR",111,0)
 F P=1:1 D  Q:'$L(C)
"RTN","RGNETWRR",112,0)
 .S C=$E(TXT,P)
"RTN","RGNETWRR",113,0)
 .I C="""" D  Q
"RTN","RGNETWRR",114,0)
 ..I Q,$E(TXT,P+1)="""" S P=P+1 Q
"RTN","RGNETWRR",115,0)
 ..S Q='Q
"RTN","RGNETWRR",116,0)
 .Q:Q
"RTN","RGNETWRR",117,0)
 .I C=";" S P=99999 Q
"RTN","RGNETWRR",118,0)
 .I C="(" S R=R+1
"RTN","RGNETWRR",119,0)
 .I C=")",R S R=R-1
"RTN","RGNETWRR",120,0)
 .D @("AL"_S)
"RTN","RGNETWRR",121,0)
 Q
"RTN","RGNETWRR",122,0)
 ; Looking for branch command
"RTN","RGNETWRR",123,0)
AL0 S B="DGdg"[C
"RTN","RGNETWRR",124,0)
 S:" ."'[C S=1
"RTN","RGNETWRR",125,0)
 Q
"RTN","RGNETWRR",126,0)
 ; Postconditional?
"RTN","RGNETWRR",127,0)
AL1 S PC=C=":",S=$S(PC:3,C=" ":3-B,1:99)
"RTN","RGNETWRR",128,0)
 Q
"RTN","RGNETWRR",129,0)
 ; Collect branch target
"RTN","RGNETWRR",130,0)
AL2 S:'$L(E) E1=P
"RTN","RGNETWRR",131,0)
 I $L(C),"^%"[C!(C?1AN) S E=E_C Q
"RTN","RGNETWRR",132,0)
 D ALX
"RTN","RGNETWRR",133,0)
 S S=$S(R:3,C=",":2,C=" ":0,1:99)
"RTN","RGNETWRR",134,0)
 Q
"RTN","RGNETWRR",135,0)
 ; Expression
"RTN","RGNETWRR",136,0)
AL3 I C=" ",PC S PC=0,S=$S(B:2,1:3)
"RTN","RGNETWRR",137,0)
 E  S S=$S(C="$":4,C=" ":0,1:3)
"RTN","RGNETWRR",138,0)
 Q
"RTN","RGNETWRR",139,0)
 ; Extrinsic?
"RTN","RGNETWRR",140,0)
AL4 S S=$S(C="$":5,C=" ":0,1:3)
"RTN","RGNETWRR",141,0)
 Q
"RTN","RGNETWRR",142,0)
 ; Extrinsic EP
"RTN","RGNETWRR",143,0)
AL5 S:'$L(E) E1=P
"RTN","RGNETWRR",144,0)
 I "^%"[C!(C?1AN) S E=E_C Q
"RTN","RGNETWRR",145,0)
 D ALX
"RTN","RGNETWRR",146,0)
 S S=$S(C=" ":0,1:3)
"RTN","RGNETWRR",147,0)
 Q
"RTN","RGNETWRR",148,0)
 ; Bad syntax
"RTN","RGNETWRR",149,0)
AL99 S P=99999
"RTN","RGNETWRR",150,0)
 Q
"RTN","RGNETWRR",151,0)
 ; Add a link
"RTN","RGNETWRR",152,0)
ALX Q:'$L(E)
"RTN","RGNETWRR",153,0)
 S E=$S(E[U:$P(E,U,1,2),1:E_U_RTN)
"RTN","RGNETWRR",154,0)
 S:E["%" E=$$SUBST^RGUT(E,"%","%25")
"RTN","RGNETWRR",155,0)
 S E=$C(1)_"a href='RTN?NAME="_E_"#"_$P(E,U)_"'"_$C(2),TXT=$E(TXT,1,E1-1)_E_$E(TXT,E1,P-1)_$C(1)_"/a"_$C(2)_$E(TXT,P,9999),P=P+$L(E)+4,E=""
"RTN","RGNETWRR",156,0)
 Q
"RTN","RGNETWRR",157,0)
BODY(X) D ADD^RGNETWWW(X_$C(13,10))
"RTN","RGNETWRR",158,0)
 Q
"RTN","RGNETWRR",159,0)
CELL(X,C) ;
"RTN","RGNETWRR",160,0)
 D BODY("<td align="_$S($G(C):"center",1:"left")_">")
"RTN","RGNETWRR",161,0)
 D BODY(X)
"RTN","RGNETWRR",162,0)
 D BODY("</td>")
"RTN","RGNETWRR",163,0)
 Q
"RTN","RGNETWRR",164,0)
SET(VAL,FIL,FLD) ;
"RTN","RGNETWRR",165,0)
 D CELL($$SET^RGUT(+VAL,$P($G(^DD(FIL,FLD,0)),U,3)_";0:UNKNOWN"),1)
"RTN","RGNETWRR",166,0)
 Q
"RTN","RGNETWRR",167,0)
 ; Return a rotating palette of pastel colors
"RTN","RGNETWRR",168,0)
 ;   CCH = Last color used.
"RTN","RGNETWRR",169,0)
 ;   Returns next color in sequence.
"RTN","RGNETWRR",170,0)
COLOR(CCH) ;
"RTN","RGNETWRR",171,0)
 ;S CCH=$S($G(CCH)="":"FFFFCC",CCH="FFCCFF":"FFCCCC",CCH="CCCCFF":"FFFFCC",1:$E(CCH,5,6)_$E(CCH,1,4))
"RTN","RGNETWRR",172,0)
 ;S CCH=$S($G(CCH)="":"FFFFCC",1:$E(CCH,5,6)_$E(CCH,1,4))
"RTN","RGNETWRR",173,0)
 S CCH=$S($G(CCH)="":"CCFFFF",CCH="FFFFCC":"CCCCFF",CCH="FFCCCC":"CCFFFF",1:$E(CCH,5,6)_$E(CCH,1,4))
"RTN","RGNETWRR",174,0)
 Q CCH
"RTN","RGNETWRR",175,0)
ESCAPE(X) ;
"RTN","RGNETWRR",176,0)
 Q $$ESCAPE^RGNETWWW(X)
"RTN","RGNETWWW")
0^2^B82369018
"RTN","RGNETWWW",1,0)
RGNETWWW ;RI/CBMI/DKM - HTTP support ;04-Apr-2015 08:46;DKM
"RTN","RGNETWWW",2,0)
 ;;1.0;NETWORK SERVICES;;14-March-2014;Build 44
"RTN","RGNETWWW",3,0)
 ;=================================================================
"RTN","RGNETWWW",4,0)
 ; This is the TCP I/O handler entry point
"RTN","RGNETWWW",5,0)
NETSERV(DUMMY) ;
"RTN","RGNETWWW",6,0)
 D WRITEALL($$PROCESS("$$TCPSTRM(.LN)"))
"RTN","RGNETWWW",7,0)
 S RGQUIT=RGMODE'=3
"RTN","RGNETWWW",8,0)
 Q
"RTN","RGNETWWW",9,0)
 ; Entry point where request is in an array.
"RTN","RGNETWWW",10,0)
 ;  SRCARY = Array reference.  Note that the array contents will be destroyed.
"RTN","RGNETWWW",11,0)
 ;  Returns the global reference where the response is stored.
"RTN","RGNETWWW",12,0)
ENTRYARY(SRCARY) ;
"RTN","RGNETWWW",13,0)
 Q $$PROCESS("$$ARYSTRM(.LN,""SRCARY"")")
"RTN","RGNETWWW",14,0)
 ; Entry point for processing a request.  By using a stream,
"RTN","RGNETWWW",15,0)
 ; we can process requests from sources other than a TCP
"RTN","RGNETWWW",16,0)
 ; stream.
"RTN","RGNETWWW",17,0)
 ;   SOURCE = Extrinsic that will act as an input stream for reading the request.
"RTN","RGNETWWW",18,0)
PROCESS(SOURCE) ;
"RTN","RGNETWWW",19,0)
 N RGNETREQ,RGNETRSP
"RTN","RGNETWWW",20,0)
 D INIT,PROCX,ENDRSP,CLEANUP
"RTN","RGNETWWW",21,0)
 Q:$Q RGNETRSP
"RTN","RGNETWWW",22,0)
 Q
"RTN","RGNETWWW",23,0)
PROCX N HANDLER,EP,AUTH,X,$ET,$ES
"RTN","RGNETWWW",24,0)
 S $ET="D ETRAP^RGNETWWW"
"RTN","RGNETWWW",25,0)
 S X=$$PARSEREQ(SOURCE,.RGNETREQ)
"RTN","RGNETWWW",26,0)
 I X D SETSTAT(X) Q
"RTN","RGNETWWW",27,0)
 S HANDLER=$$URL2EP(RGNETREQ("METHOD"),RGNETREQ("PATH"))
"RTN","RGNETWWW",28,0)
 I 'HANDLER D SETSTAT(404,"No endpoint") Q
"RTN","RGNETWWW",29,0)
 S EP=$G(^RGNET(996.52,HANDLER,10)),AUTH=$P(^(0),U,3)
"RTN","RGNETWWW",30,0)
 I '$L(EP) D SETSTAT(404,"No handler") Q
"RTN","RGNETWWW",31,0)
 Q:'$$AUTH(AUTH,$L(AUTH))
"RTN","RGNETWWW",32,0)
 D @EP
"RTN","RGNETWWW",33,0)
 Q
"RTN","RGNETWWW",34,0)
 ; Trap an expected error, returning it as a 500 status code.
"RTN","RGNETWWW",35,0)
ETRAP D SETSTAT(500,$P($EC,",",2)),^%ZTER,UNWIND^%ZTER
"RTN","RGNETWWW",36,0)
 Q
"RTN","RGNETWWW",37,0)
 ; Writes the contents of the buffer to the TCP socket.
"RTN","RGNETWWW",38,0)
 ;  BUFFER = Array reference containing buffered output.
"RTN","RGNETWWW",39,0)
WRITEALL(BUFFER) ;
"RTN","RGNETWWW",40,0)
 N LP1,LP2
"RTN","RGNETWWW",41,0)
 S LP1=""
"RTN","RGNETWWW",42,0)
 F  S LP1=$O(@BUFFER@(LP1)) Q:'$L(LP1)  D
"RTN","RGNETWWW",43,0)
 .D:$D(@BUFFER@(LP1))#2 TCPWRITE^RGNETTCP(@BUFFER@(LP1))
"RTN","RGNETWWW",44,0)
 .S LP2=""
"RTN","RGNETWWW",45,0)
 .F  S LP2=$O(@BUFFER@(LP1,LP2)) Q:'$L(LP2)  D
"RTN","RGNETWWW",46,0)
 ..D TCPWRITE^RGNETTCP(@BUFFER@(LP1,LP2))
"RTN","RGNETWWW",47,0)
 Q
"RTN","RGNETWWW",48,0)
 ; Extrinsic to act as a TCP input stream
"RTN","RGNETWWW",49,0)
 ;  .LN = Single line returned from input stream.
"RTN","RGNETWWW",50,0)
TCPSTRM(LN) ;
"RTN","RGNETWWW",51,0)
 N L,TMO
"RTN","RGNETWWW",52,0)
 S TMO=$S('$D(LN):10,1:0)
"RTN","RGNETWWW",53,0)
 S LN=$$TCPREADT^RGNETTCP($C(13,10),TMO),L=$L(LN)
"RTN","RGNETWWW",54,0)
 I L,$E(LN,L-1,L)=$C(13,10) S LN=$E(LN,1,L-2)
"RTN","RGNETWWW",55,0)
 Q L
"RTN","RGNETWWW",56,0)
 ; Extrinsic to act as an array stream source
"RTN","RGNETWWW",57,0)
 ;  .LN = Single line returned from input stream.
"RTN","RGNETWWW",58,0)
 ;  ARYREF = Contains arrary reference.  Note: input array will be killed.
"RTN","RGNETWWW",59,0)
ARYSTRM(LN,ARYREF) ;
"RTN","RGNETWWW",60,0)
 N X,L
"RTN","RGNETWWW",61,0)
 S X=$Q(@ARYREF),L=$QL(ARYREF)
"RTN","RGNETWWW",62,0)
 Q:'$L(X) 0
"RTN","RGNETWWW",63,0)
 Q:$NA(@X,L)'=ARYREF 0
"RTN","RGNETWWW",64,0)
 S LN=@X
"RTN","RGNETWWW",65,0)
 K @X
"RTN","RGNETWWW",66,0)
 Q 1
"RTN","RGNETWWW",67,0)
 ; Parse the HTTP request
"RTN","RGNETWWW",68,0)
 ;  STREAM  = Input stream (an extrinsic for returning successive lines)
"RTN","RGNETWWW",69,0)
 ; .RGNETREQ = Array to receive the parsed results
"RTN","RGNETWWW",70,0)
 ; Parsed components are stored under the following nodes:
"RTN","RGNETWWW",71,0)
 ;  HDR    = Headers
"RTN","RGNETWWW",72,0)
 ;  METHOD = Method
"RTN","RGNETWWW",73,0)
 ;  PARAMS = Query parameters
"RTN","RGNETWWW",74,0)
 ;  PATH   = Request path
"RTN","RGNETWWW",75,0)
 ;  HOST   = Request URL (less protocol)
"RTN","RGNETWWW",76,0)
PARSEREQ(STREAM,RGNETREQ) ;
"RTN","RGNETWWW",77,0)
 N METHOD,PATH,HEADERS,LP,LN,CNT,QRY,X
"RTN","RGNETWWW",78,0)
 S CNT=0,NEXT="X="_STREAM
"RTN","RGNETWWW",79,0)
 F  S @NEXT Q:'X  D
"RTN","RGNETWWW",80,0)
 .I '$D(METHOD) S METHOD=LN Q
"RTN","RGNETWWW",81,0)
 .I 'CNT S CNT='$L(LN) Q:CNT
"RTN","RGNETWWW",82,0)
 .I 'CNT D PARSEHDR(LN) Q
"RTN","RGNETWWW",83,0)
 .S RGNETREQ("BODY",CNT)=LN,CNT=CNT+1
"RTN","RGNETWWW",84,0)
 I '$D(METHOD) Q 400
"RTN","RGNETWWW",85,0)
 S PATH=$P(METHOD," ",2),METHOD=$P(METHOD," ")
"RTN","RGNETWWW",86,0)
 I '$L(METHOD) Q 405
"RTN","RGNETWWW",87,0)
 I PATH["?" D
"RTN","RGNETWWW",88,0)
 .S QRY=$P(PATH,"?",2,9999),PATH=$P(PATH,"?")
"RTN","RGNETWWW",89,0)
 .D PARSEQS(QRY)
"RTN","RGNETWWW",90,0)
 S:$E(PATH)="/" PATH=$E(PATH,2,9999)
"RTN","RGNETWWW",91,0)
 S:$E(PATH,$L(PATH))="/" PATH=$E(PATH,1,$L(PATH)-1)
"RTN","RGNETWWW",92,0)
 S PATH=$$UNESCURL(PATH)
"RTN","RGNETWWW",93,0)
 S RGNETREQ("METHOD")=METHOD
"RTN","RGNETWWW",94,0)
 S RGNETREQ("PATH")=PATH
"RTN","RGNETWWW",95,0)
 S RGNETREQ("HOST")=$G(RGNETREQ("HDR","host"))_"/"_$P(PATH,"/")
"RTN","RGNETWWW",96,0)
 Q 0
"RTN","RGNETWWW",97,0)
 ; Parse query string into array named in PREF.
"RTN","RGNETWWW",98,0)
 ;  QS = Query string
"RTN","RGNETWWW",99,0)
 ;  PREF = Array reference to receive data.  Defaults to RGNETREQ("PARAMS").
"RTN","RGNETWWW",100,0)
PARSEQS(QS,PREF) ;
"RTN","RGNETWWW",101,0)
 N X,Y,Z,N,V,M
"RTN","RGNETWWW",102,0)
 S PREF=$G(PREF,$NA(RGNETREQ("PARAMS")))
"RTN","RGNETWWW",103,0)
 F X=1:1:$L(QS,"&") D
"RTN","RGNETWWW",104,0)
 .S Y=$P(QS,"&",X),N=$$UNESCURL($P(Y,"=")),V=$$UNESCURL($P(Y,"=",2,9999)),M=""
"RTN","RGNETWWW",105,0)
 .I $L(N) D
"RTN","RGNETWWW",106,0)
 ..S Z=$L(N,":")
"RTN","RGNETWWW",107,0)
 ..I Z>1 D
"RTN","RGNETWWW",108,0)
 ...S Y=$P(N,":",Z)
"RTN","RGNETWWW",109,0)
 ...S M=$S(Y="missing":"m",Y="exact":"e",Y="text":"t",1:"")
"RTN","RGNETWWW",110,0)
 ...S:$L(M) N=$P(N,":",1,Z-1)
"RTN","RGNETWWW",111,0)
 ..S Y=1+$O(@PREF@(N,""),-1)
"RTN","RGNETWWW",112,0)
 ..F Z=1:1:$L(V,",") D
"RTN","RGNETWWW",113,0)
 ...S @PREF@(N,Y,Z)=$P(V,",",Z)
"RTN","RGNETWWW",114,0)
 ...S @PREF@(N,Y,Z,"OPR")=M
"RTN","RGNETWWW",115,0)
 Q
"RTN","RGNETWWW",116,0)
 ; Parse body as query string values
"RTN","RGNETWWW",117,0)
PARSEBD(PARAMS) ;
"RTN","RGNETWWW",118,0)
 N X
"RTN","RGNETWWW",119,0)
 F X=0:0 S X=$O(RGNETREQ("BODY",X)) Q:'X  D PARSEQS(RGNETREQ("BODY",X),"PARAMS")
"RTN","RGNETWWW",120,0)
 Q
"RTN","RGNETWWW",121,0)
 ; Parse http header into array named in HREF.
"RTN","RGNETWWW",122,0)
PARSEHDR(VALUE,HREF) ;
"RTN","RGNETWWW",123,0)
 N N,V
"RTN","RGNETWWW",124,0)
 S HREF=$G(HREF,$NA(RGNETREQ("HDR")))
"RTN","RGNETWWW",125,0)
 S N=$$LOW^XLFSTR($P(VALUE,":")),V=$$TRIM^XLFSTR($P(VALUE,":",2,999))
"RTN","RGNETWWW",126,0)
 S:$L(N) @HREF@(N)=V
"RTN","RGNETWWW",127,0)
 Q
"RTN","RGNETWWW",128,0)
 ; Replace escaped characters in URL
"RTN","RGNETWWW",129,0)
UNESCURL(X) ;
"RTN","RGNETWWW",130,0)
 I X["%"!(X["+") D
"RTN","RGNETWWW",131,0)
 .N P,C,H
"RTN","RGNETWWW",132,0)
 .F P=1:1 S C=$E(X,P) Q:'$L(C)  D
"RTN","RGNETWWW",133,0)
 ..I C="+" S $E(X,P)=" "
"RTN","RGNETWWW",134,0)
 ..E  I C="%" S H=$E(X,P+1,P+2),$E(X,P,P+2)=$$UNHEX^XTHCUTL(H)
"RTN","RGNETWWW",135,0)
 Q X
"RTN","RGNETWWW",136,0)
 ; Escape reserved characters
"RTN","RGNETWWW",137,0)
ESCAPE(VALUE) ;
"RTN","RGNETWWW",138,0)
 N LP
"RTN","RGNETWWW",139,0)
 F LP="&;amp","<;lt",">;gt",$C(9)_";nbsp","|TAB|;nbsp" D
"RTN","RGNETWWW",140,0)
 .S VALUE=$$SUBST^RGUT(VALUE,$P(LP,";"),"&"_$P(LP,";",2)_";")
"RTN","RGNETWWW",141,0)
 Q VALUE
"RTN","RGNETWWW",142,0)
 ; Returns true if error condition is set
"RTN","RGNETWWW",143,0)
ISERROR() ;
"RTN","RGNETWWW",144,0)
 Q +$G(RGNETRSP("STATUS"))'<400
"RTN","RGNETWWW",145,0)
 ; Sets http status code
"RTN","RGNETWWW",146,0)
SETSTAT(CODE,TEXT) ;
"RTN","RGNETWWW",147,0)
 S:'$L($G(TEXT)) TEXT=$P(^RGNET(996.51,CODE,0),U,2)
"RTN","RGNETWWW",148,0)
 S RGNETRSP("STATUS")=CODE_" "_TEXT
"RTN","RGNETWWW",149,0)
 D:$$ISERROR RESET
"RTN","RGNETWWW",150,0)
 Q
"RTN","RGNETWWW",151,0)
 ; Sets the content type
"RTN","RGNETWWW",152,0)
SETCTYPE(CTYPE) ;
"RTN","RGNETWWW",153,0)
 S RGNETRSP("CTYPE")=CTYPE
"RTN","RGNETWWW",154,0)
 Q
"RTN","RGNETWWW",155,0)
 ; Finishes a response by adding the necessary headers
"RTN","RGNETWWW",156,0)
ENDRSP D ADDHDR("HTTP/1.1 "_$G(RGNETRSP("STATUS"),"200 OK"),-999)
"RTN","RGNETWWW",157,0)
 D ADDHDR("Date: "_$$WWWDATE,-998)
"RTN","RGNETWWW",158,0)
 D:$D(RGNETRSP("CTYPE"))#2 ADDHDR("Content-Type: "_RGNETRSP("CTYPE")_"; charset=utf-8",-998)
"RTN","RGNETWWW",159,0)
 D ADDHDR("Content-Length: "_+$G(RGNETRSP("LEN")),-998)
"RTN","RGNETWWW",160,0)
 D ADDHDR("",0)
"RTN","RGNETWWW",161,0)
 Q
"RTN","RGNETWWW",162,0)
 ; Add to response buffer
"RTN","RGNETWWW",163,0)
ADD(X) N Y
"RTN","RGNETWWW",164,0)
 S:'$$ISERROR Y=$O(@RGNETRSP@(""),-1)+1,@RGNETRSP@(Y)=X,RGNETRSP("LEN")=RGNETRSP("LEN")+$L(X),RGNETRSP("LAST")=Y
"RTN","RGNETWWW",165,0)
 Q
"RTN","RGNETWWW",166,0)
 ; Add array to output buffer
"RTN","RGNETWWW",167,0)
 ; RT  = Array root
"RTN","RGNETWWW",168,0)
 ; EOL = End of line character(s)
"RTN","RGNETWWW",169,0)
ADDARY(RT,EOL) ;
"RTN","RGNETWWW",170,0)
 N LP
"RTN","RGNETWWW",171,0)
 S EOL=$G(EOL),LP=0
"RTN","RGNETWWW",172,0)
 F  S LP=$O(@RT@(LP)) Q:'LP  D
"RTN","RGNETWWW",173,0)
 .D ADD($G(@RT@(LP))_$G(@RT@(LP,0))_EOL)
"RTN","RGNETWWW",174,0)
 Q
"RTN","RGNETWWW",175,0)
 ; Add HTTP response header to output buffer
"RTN","RGNETWWW",176,0)
 ;  HDR = Properly formatted header
"RTN","RGNETWWW",177,0)
 ;  SB  = Affects the position of the header in the output.  Typically, not specified.
"RTN","RGNETWWW",178,0)
ADDHDR(HDR,SB) ;
"RTN","RGNETWWW",179,0)
 N NXT
"RTN","RGNETWWW",180,0)
 S SB=+$G(SB,-1)
"RTN","RGNETWWW",181,0)
 S:SB>0 SB=-SB
"RTN","RGNETWWW",182,0)
 S NXT=$O(@RGNETRSP@(SB,""),-1)+1,@RGNETRSP@(SB,NXT)=HDR_$C(13,10)
"RTN","RGNETWWW",183,0)
 Q
"RTN","RGNETWWW",184,0)
 ; Replace buffer contents at specified index, adjusting content length accordingly.
"RTN","RGNETWWW",185,0)
REPLACE(IDX,X) ;
"RTN","RGNETWWW",186,0)
 N Y
"RTN","RGNETWWW",187,0)
 S Y=$L(X)-$L(@RGNETRSP@(IDX)),@RGNETRSP@(IDX)=X,RGNETRSP("LEN")=RGNETRSP("LEN")+Y
"RTN","RGNETWWW",188,0)
 Q
"RTN","RGNETWWW",189,0)
 ; Returns the specified query parameter
"RTN","RGNETWWW",190,0)
 ; PN = Parameter name
"RTN","RGNETWWW",191,0)
 ; P1 = Parameter series - for duplicate parameters, specifies which among them (defaults to 1)
"RTN","RGNETWWW",192,0)
 ; P2 = Parameter value  - for multivalued parameters, specifies which value (defaults to 1)
"RTN","RGNETWWW",193,0)
GETPARAM(PN,P1,P2) ;
"RTN","RGNETWWW",194,0)
 Q $G(RGNETREQ("PARAMS",PN,$G(P1,1),$G(P2,1)))
"RTN","RGNETWWW",195,0)
 ; Initialize environment
"RTN","RGNETWWW",196,0)
INIT S:'($D(RGNETRSP)#2) RGNETRSP=$$TMPGBL
"RTN","RGNETWWW",197,0)
 D RESET
"RTN","RGNETWWW",198,0)
 Q
"RTN","RGNETWWW",199,0)
 ; Reset the output buffer
"RTN","RGNETWWW",200,0)
RESET K @RGNETRSP
"RTN","RGNETWWW",201,0)
 S (RGNETRSP("LAST"),RGNETRSP("LEN"))=0
"RTN","RGNETWWW",202,0)
 Q
"RTN","RGNETWWW",203,0)
 ; Returns the host url (e.g., www.xyz.net)
"RTN","RGNETWWW",204,0)
HOST(PATH,DFLT) ;
"RTN","RGNETWWW",205,0)
 N URL
"RTN","RGNETWWW",206,0)
 S URL=$G(PATH)
"RTN","RGNETWWW",207,0)
 S:$E(URL)="*" URL=$G(DFLT)_$E(URL,2,9999)
"RTN","RGNETWWW",208,0)
 Q $$CONCAT(RGNETREQ("HOST"),URL)
"RTN","RGNETWWW",209,0)
 ; Returns host URL including the transport protocol (e.g., http://www.xyz.net)
"RTN","RGNETWWW",210,0)
HOSTURL(PATH) ;
"RTN","RGNETWWW",211,0)
 Q $G(RGNETREQ("HDR","x-forwarded-proto"),"http")_"://"_$$HOST(.PATH)
"RTN","RGNETWWW",212,0)
 ; Prepend local system root to path
"RTN","RGNETWWW",213,0)
LOCALSYS(PATH) ;
"RTN","RGNETWWW",214,0)
 Q $$CONCAT("http://"_$$LOW^XLFSTR($$KSP^XUPARAM("WHERE")),.PATH)
"RTN","RGNETWWW",215,0)
 ; Return UUID for this system
"RTN","RGNETWWW",216,0)
SYSUUID() ;
"RTN","RGNETWWW",217,0)
 S:'$L($G(^RGNET("SYS"))) ^("SYS")=$$UUID^RGUT
"RTN","RGNETWWW",218,0)
 Q ^("SYS")
"RTN","RGNETWWW",219,0)
 ; Concatenate path to url.
"RTN","RGNETWWW",220,0)
CONCAT(URL,PATH) ;
"RTN","RGNETWWW",221,0)
 Q:'$D(PATH) URL
"RTN","RGNETWWW",222,0)
 F  Q:$E(URL,$L(URL))'="/"  S $E(URL,$L(URL))=""
"RTN","RGNETWWW",223,0)
 F  Q:$E(PATH)'="/"  S $E(PATH)=""
"RTN","RGNETWWW",224,0)
 Q URL_"/"_PATH
"RTN","RGNETWWW",225,0)
 ; Date (format per RFC 1123)
"RTN","RGNETWWW",226,0)
WWWDATE(DT) ;
"RTN","RGNETWWW",227,0)
 N TZ,H,M,SN
"RTN","RGNETWWW",228,0)
 S:'$G(DT) DT=$$NOW^XLFDT
"RTN","RGNETWWW",229,0)
 S TZ=$$TZ^XLFDT,H=+$E(TZ,2,3),M=+$E(TZ,4,5),SN=$S(TZ<0:1,1:-1)
"RTN","RGNETWWW",230,0)
 S DT=$$FMADD^XLFDT(DT,0,H*SN,M*SN,0)
"RTN","RGNETWWW",231,0)
 Q $$FMTDATE^RGUTDATF(DT,"EEE, dd MMM YYYY HH:mm:ss 'GMT'")
"RTN","RGNETWWW",232,0)
 ; Returns true if request came from a browser
"RTN","RGNETWWW",233,0)
ISBROWSR() ;
"RTN","RGNETWWW",234,0)
 Q $G(RGNETREQ("HDR","user-agent"))["Mozilla"
"RTN","RGNETWWW",235,0)
 ; Attempt authentication if credentials available
"RTN","RGNETWWW",236,0)
 ; If REQUIRED is true, authentication must succeed.
"RTN","RGNETWWW",237,0)
 ; Returns true if successful
"RTN","RGNETWWW",238,0)
AUTH(TYPE,REQUIRED) ;
"RTN","RGNETWWW",239,0)
 N TP,CRED
"RTN","RGNETWWW",240,0)
 S TP=$G(RGNETREQ("HDR","authorization")),CRED=$P(TP," ",2),TP=$$UP^XLFSTR($P(TP," "))
"RTN","RGNETWWW",241,0)
 I '$L(TP),$G(DUZ) Q 1
"RTN","RGNETWWW",242,0)
 S TYPE=$G(TYPE),REQUIRED=+$G(REQUIRED)
"RTN","RGNETWWW",243,0)
 K RGNETREQ("HDR","authorization"),DUZ
"RTN","RGNETWWW",244,0)
 I $L(TYPE),TP'=TYPE
"RTN","RGNETWWW",245,0)
 .S REQUIRED=1
"RTN","RGNETWWW",246,0)
 E  I TP="BASIC" D
"RTN","RGNETWWW",247,0)
 .N IO,RTN
"RTN","RGNETWWW",248,0)
 .S CRED=$$DECODE^RGUTUU(CRED),CRED=$P(CRED,":")_";"_$P(CRED,":",2,9999),IO=$P
"RTN","RGNETWWW",249,0)
 .D SETUP^XUSRB(),VALIDAV^XUSRB(.RTN,$$ENCRYP^XUSRB1(CRED))
"RTN","RGNETWWW",250,0)
 E  I TP="BEARER" D
"RTN","RGNETWWW",251,0)
 .S DUZ=$$ISVALID^RGSEOAUT(CRED)
"RTN","RGNETWWW",252,0)
 I '$G(DUZ),REQUIRED D  Q 0
"RTN","RGNETWWW",253,0)
 .D SETSTAT(401)
"RTN","RGNETWWW",254,0)
 .D ADDHDR("WWW-Authenticate: "_TYPE)
"RTN","RGNETWWW",255,0)
 S:'$D(DUZ(2)) DUZ(2)=$P(^XTV(8989.3,1,"XUS"),U,17)
"RTN","RGNETWWW",256,0)
 Q 1
"RTN","RGNETWWW",257,0)
 ; Convert to pattern (Used for URL matching)
"RTN","RGNETWWW",258,0)
TOPTRN(NM) ;
"RTN","RGNETWWW",259,0)
 N P,C,X,L
"RTN","RGNETWWW",260,0)
 S (L,P)=""
"RTN","RGNETWWW",261,0)
 F X=1:1:$L(NM) D
"RTN","RGNETWWW",262,0)
 .S C=$E(NM,X)
"RTN","RGNETWWW",263,0)
 .I C="*" D TOPTRN2(".E") Q
"RTN","RGNETWWW",264,0)
 .I C="#" D TOPTRN2("1.N") Q
"RTN","RGNETWWW",265,0)
 .S L=L_C
"RTN","RGNETWWW",266,0)
 D:$L(P) TOPTRN2("")
"RTN","RGNETWWW",267,0)
 Q P
"RTN","RGNETWWW",268,0)
TOPTRN2(X) ;
"RTN","RGNETWWW",269,0)
 S:$L(L) P=P_"1"""_L_"""",L=""
"RTN","RGNETWWW",270,0)
 S P=P_X
"RTN","RGNETWWW",271,0)
 Q
"RTN","RGNETWWW",272,0)
 ; Looks up endpoint for URL
"RTN","RGNETWWW",273,0)
 ; Returns IEN of endpoint
"RTN","RGNETWWW",274,0)
URL2EP(METHOD,URL) ;
"RTN","RGNETWWW",275,0)
 N IEN
"RTN","RGNETWWW",276,0)
 S:'$L(URL) URL="/"
"RTN","RGNETWWW",277,0)
 S IEN=$$URL2EPX(METHOD,URL)
"RTN","RGNETWWW",278,0)
 S:'IEN IEN=$$URL2EPX(METHOD,URL,$E(URL))
"RTN","RGNETWWW",279,0)
 S:'IEN IEN=$$URL2EPX(METHOD,URL,"#")
"RTN","RGNETWWW",280,0)
 S:'IEN IEN=$$URL2EPX(METHOD,URL,"*")
"RTN","RGNETWWW",281,0)
 Q IEN
"RTN","RGNETWWW",282,0)
URL2EPX(METHOD,URL,URLX) ;
"RTN","RGNETWWW",283,0)
 Q:'$D(URLX) $O(^RGNET(996.52,"C",METHOD,URL,0))
"RTN","RGNETWWW",284,0)
 N RT,FND,PTRN,IEN
"RTN","RGNETWWW",285,0)
 S RT=URLX,FND=0
"RTN","RGNETWWW",286,0)
 F  S URLX=$O(^RGNET(996.52,"C",METHOD,URLX)) Q:$E(URLX)'=RT  D  Q:FND
"RTN","RGNETWWW",287,0)
 .F IEN=0:0 S IEN=$O(^RGNET(996.52,"C",METHOD,URLX,IEN)) Q:'IEN  S PTRN=^(IEN) D:$L(PTRN)  Q:FND
"RTN","RGNETWWW",288,0)
 ..S:URL?@PTRN FND=IEN
"RTN","RGNETWWW",289,0)
 I 'FND,$E(URL,$L(URL))'="/" S FND=$$URL2EPX(METHOD,URL_"/",URLX)
"RTN","RGNETWWW",290,0)
 Q FND
"RTN","RGNETWWW",291,0)
 ; Returns the weighted value if content type matches an accepted type,
"RTN","RGNETWWW",292,0)
 ; or 0 if no match.
"RTN","RGNETWWW",293,0)
ISCTYPE(MTYPE,ACCPT) ;
"RTN","RGNETWWW",294,0)
 N AT,LP,MT,R,X,Q
"RTN","RGNETWWW",295,0)
 S ACCPT=$TR(ACCPT," "),MTYPE=$TR(MTYPE," ")
"RTN","RGNETWWW",296,0)
 F LP=1:1:$L(ACCPT,",") D
"RTN","RGNETWWW",297,0)
 .S X=$P(ACCPT,",",LP),Q=$P(X,";",2),X=$P(X,";")
"RTN","RGNETWWW",298,0)
 .S Q=$S($E(Q,1,2)="q=":+$E(Q,3,99),1:1)
"RTN","RGNETWWW",299,0)
 .S:$L(X) AT(Q,X)=""
"RTN","RGNETWWW",300,0)
 Q:'$D(AT) 1
"RTN","RGNETWWW",301,0)
 S Q=""
"RTN","RGNETWWW",302,0)
 F  S Q=$O(AT(Q),-1) Q:'Q  D  Q:$D(R)
"RTN","RGNETWWW",303,0)
 .S AT=""
"RTN","RGNETWWW",304,0)
 .F  S AT=$O(AT(Q,AT)) Q:'$L(AT)  D  Q:$D(R)
"RTN","RGNETWWW",305,0)
 ..I AT="*/*" S R=Q Q
"RTN","RGNETWWW",306,0)
 ..F LP=1:1:$L(MTYPE,",") D  Q:$D(R)
"RTN","RGNETWWW",307,0)
 ...S MT=$P(MTYPE,",",LP)
"RTN","RGNETWWW",308,0)
 ...I AT=MT S R=Q Q
"RTN","RGNETWWW",309,0)
 ...I AT["/*",$P(AT,"/")=$P(MT,"/") S R=Q Q
"RTN","RGNETWWW",310,0)
 ...I AT["*/",$P(AT,"/",2)=$P(MT,"/",2) S R=Q Q
"RTN","RGNETWWW",311,0)
 Q $S($D(R):R,1:0)
"RTN","RGNETWWW",312,0)
 ; Return unique temp global reference
"RTN","RGNETWWW",313,0)
 ; If X is specified, returns the temp global at that index.
"RTN","RGNETWWW",314,0)
 ; Otherwise, returns the next available global reference.
"RTN","RGNETWWW",315,0)
TMPGBL(X) ;
"RTN","RGNETWWW",316,0)
 Q:$G(X) $NA(^TMP("RGNETWWW",$J,X))
"RTN","RGNETWWW",317,0)
 F  S X=$G(^TMP("RGNETWWW",$J))+1,^($J)=X,X=$NA(^($J,X)) Q:'$D(@X)
"RTN","RGNETWWW",318,0)
 Q X
"RTN","RGNETWWW",319,0)
 ; Cleanup temp globals on completion
"RTN","RGNETWWW",320,0)
CLEANUP N LP,TMP,EXC
"RTN","RGNETWWW",321,0)
 S TMP=$NA(^TMP("RGNETWWW",$J))
"RTN","RGNETWWW",322,0)
 I TMP'=$NA(@RGNETRSP,2) K @TMP Q
"RTN","RGNETWWW",323,0)
 S (@TMP,EXC)=$QS(RGNETRSP,3)
"RTN","RGNETWWW",324,0)
 F LP=0:0 S LP=$O(@TMP@(LP)) Q:'LP  K:LP'=EXC @TMP@(LP)
"RTN","RGNETWWW",325,0)
 Q
"RTN","RGNETWWW",326,0)
 ; Returns description
"RTN","RGNETWWW",327,0)
GREETING D ADDARY($NA(^RGNET(996.52,HANDLER,99)))
"RTN","RGNETWWW",328,0)
 Q
"SEC","^DIC",996.5,996.5,0,"AUDIT")
@
"SEC","^DIC",996.5,996.5,0,"DD")
@
"SEC","^DIC",996.5,996.5,0,"DEL")
@
"SEC","^DIC",996.5,996.5,0,"LAYGO")
@
"SEC","^DIC",996.5,996.5,0,"RD")
@
"SEC","^DIC",996.5,996.5,0,"WR")
@
"SEC","^DIC",996.51,996.51,0,"AUDIT")
@
"SEC","^DIC",996.51,996.51,0,"DD")
@
"SEC","^DIC",996.51,996.51,0,"DEL")
@
"SEC","^DIC",996.51,996.51,0,"LAYGO")
@
"SEC","^DIC",996.51,996.51,0,"RD")
@
"SEC","^DIC",996.51,996.51,0,"WR")
@
"SEC","^DIC",996.52,996.52,0,"AUDIT")
@
"SEC","^DIC",996.52,996.52,0,"DD")
@
"SEC","^DIC",996.52,996.52,0,"DEL")
@
"SEC","^DIC",996.52,996.52,0,"LAYGO")
@
"SEC","^DIC",996.52,996.52,0,"RD")
@
"SEC","^DIC",996.52,996.52,0,"WR")
@
"VER")
8.0^22.0
"^DD",996.5,996.5,0)
FIELD^^4^6
"^DD",996.5,996.5,0,"DDA")
N
"^DD",996.5,996.5,0,"DT")
3150330
"^DD",996.5,996.5,0,"IX","B",996.5,.01)

"^DD",996.5,996.5,0,"NM","NETSERV TCP LISTENER")

"^DD",996.5,996.5,.01,0)
NAME^RF^^0;1^K:$L(X)>30!(X?.N)!($L(X)<3)!'(X'?1P.E) X
"^DD",996.5,996.5,.01,1,0)
^.1
"^DD",996.5,996.5,.01,1,1,0)
996.5^B
"^DD",996.5,996.5,.01,1,1,1)
S ^RGNET(996.5,"B",$E(X,1,30),DA)=""
"^DD",996.5,996.5,.01,1,1,2)
K ^RGNET(996.5,"B",$E(X,1,30),DA)
"^DD",996.5,996.5,.01,3)
NAME MUST BE 3-30 CHARACTERS, NOT NUMERIC OR STARTING WITH PUNCTUATION
"^DD",996.5,996.5,.01,21,0)
^^1^1^3150330.090909
"^DD",996.5,996.5,.01,21,1,0)
This is the unique name for the primary listener.
"^DD",996.5,996.5,1,0)
PORT^NJ5,0^^0;2^K:+X'=X!(X>32767)!(X<1)!(X?.E1"."1N.N) X
"^DD",996.5,996.5,1,3)
Enter the TCP port number.
"^DD",996.5,996.5,1,21,0)
^^2^2^3150330.090954
"^DD",996.5,996.5,1,21,1,0)
This is the TCP port that the primary listener uses to service connection
"^DD",996.5,996.5,1,21,2,0)
requests.
"^DD",996.5,996.5,1,"DT")
3150329
"^DD",996.5,996.5,2,0)
UCI^F^^0;3^K:$L(X)>10!($L(X)<1) X
"^DD",996.5,996.5,2,3)
Enter the target UCI (none = current).
"^DD",996.5,996.5,2,21,0)
^^2^2^3150330.091148
"^DD",996.5,996.5,2,21,1,0)
This is the UCI where the primary listener should be spawned.  If not specified,
"^DD",996.5,996.5,2,21,2,0)
the primary listener will reside in the same UCI where it was initially spawned.
"^DD",996.5,996.5,2,"DT")
3150329
"^DD",996.5,996.5,3,0)
DISABLE^S^0:NO;1:YES;^0;4^Q
"^DD",996.5,996.5,3,3)
Enter YES to disable the listener.
"^DD",996.5,996.5,3,21,0)
^^2^2^3150330.091254
"^DD",996.5,996.5,3,21,1,0)
If set to YES, attempts to spawn a primary or secondary listener will fail.
"^DD",996.5,996.5,3,21,2,0)
This has no impact on currently running listeners.
"^DD",996.5,996.5,3,"DT")
3150330
"^DD",996.5,996.5,4,0)
MAXIMUM^NJ6,0^^0;5^K:+X'=X!(X>999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",996.5,996.5,4,3)
Enter the maximum number of secondary listeners.
"^DD",996.5,996.5,4,21,0)
^.001^3^3^3150330^
"^DD",996.5,996.5,4,21,1,0)
This sets the maximum allowable number of secondary listeners that may be 
"^DD",996.5,996.5,4,21,2,0)
spawned by the primary listener.  When this number is exceeded, additional
"^DD",996.5,996.5,4,21,3,0)
connection requests will be denied.
"^DD",996.5,996.5,4,"DT")
3150330
"^DD",996.5,996.5,10,0)
HANDLER^FX^^10;E1,250^K:X'?.8AN1"^"1.8AN X
"^DD",996.5,996.5,10,3)
Enter entry point for I/O handler as TAG^ROUTINE.
"^DD",996.5,996.5,10,21,0)
^^7^7^3150330.091725
"^DD",996.5,996.5,10,21,1,0)
This is the entry point (as TAG^ROUTINE) that will service an established
"^DD",996.5,996.5,10,21,2,0)
connection.  The handler should relinquish control back to the caller after
"^DD",996.5,996.5,10,21,3,0)
completing each request/response cycle to allow the caller to determine if
"^DD",996.5,996.5,10,21,4,0)
the connection should be terminated.  The handler may request termination
"^DD",996.5,996.5,10,21,5,0)
by setting RGQUIT to a nonzero value.  Otherwise, unless an external request
"^DD",996.5,996.5,10,21,6,0)
to terminate the connection has been received, the handler will be called
"^DD",996.5,996.5,10,21,7,0)
again.
"^DD",996.5,996.5,10,"DT")
3150330
"^DD",996.51,996.51,0)
FIELD^^1^2
"^DD",996.51,996.51,0,"DDA")
N
"^DD",996.51,996.51,0,"DT")
3150317
"^DD",996.51,996.51,0,"NM","NETSERV HTTP STATUS")

"^DD",996.51,996.51,.01,0)
CODE^RNJ3,0X^^0;1^K:X<100!(X>999)!(X\1'=X) X S:$D(X) DINUM=X
"^DD",996.51,996.51,.01,1,0)
^.1^^0
"^DD",996.51,996.51,.01,3)
Enter the HTTP status code.
"^DD",996.51,996.51,.01,"DT")
3150317
"^DD",996.51,996.51,1,0)
TEXT^F^^0;2^K:$L(X)>80!($L(X)<1) X
"^DD",996.51,996.51,1,3)
Enter the display text for this status code.
"^DD",996.51,996.51,1,"DT")
3150317
"^DD",996.52,996.52,0)
FIELD^^2^5
"^DD",996.52,996.52,0,"DDA")
N
"^DD",996.52,996.52,0,"DT")
3150331
"^DD",996.52,996.52,0,"IX","B",996.52,.01)

"^DD",996.52,996.52,0,"NM","NETSERV HTTP ENDPOINT")

"^DD",996.52,996.52,.01,0)
URL^RF^^0;1^K:$L(X)>150!($L(X)<1) X
"^DD",996.52,996.52,.01,1,0)
^.1
"^DD",996.52,996.52,.01,1,1,0)
996.52^B
"^DD",996.52,996.52,.01,1,1,1)
S ^RGNET(996.52,"B",$E(X,1,30),DA)=""
"^DD",996.52,996.52,.01,1,1,2)
K ^RGNET(996.52,"B",$E(X,1,30),DA)
"^DD",996.52,996.52,.01,3)
Enter URL pattern for this endpoint.
"^DD",996.52,996.52,.01,21,0)
^^6^6^3150330.151834
"^DD",996.52,996.52,.01,21,1,0)
This is the pattern to which a request URL is to be matched.  It may contain
"^DD",996.52,996.52,.01,21,2,0)
the following wildcard characters:
"^DD",996.52,996.52,.01,21,3,0)

"^DD",996.52,996.52,.01,21,4,0)
       * Matches any character sequence.
"^DD",996.52,996.52,.01,21,5,0)
       # Matches any sequence of digits.
"^DD",996.52,996.52,.01,21,6,0)

"^DD",996.52,996.52,.01,"DT")
3150330
"^DD",996.52,996.52,1,0)
METHOD^S^GET:GET;HEAD:HEAD;POST:POST;PUT:PUT;DELETE:DELETE;^0;2^Q
"^DD",996.52,996.52,1,"DT")
3150330
"^DD",996.52,996.52,2,0)
AUTH^S^BASIC:BASIC AUTHENTICATION;BEARER:OAUTH2 AUTHENTICATION;^0;3^Q
"^DD",996.52,996.52,2,3)
Enter authentication type (or no entry for none).
"^DD",996.52,996.52,2,21,0)
^^6^6^3150331.200154
"^DD",996.52,996.52,2,21,1,0)
This determines the type of authentication required for the associated endpoint.
"^DD",996.52,996.52,2,21,2,0)

"^DD",996.52,996.52,2,21,3,0)
       BASIC - Basic authentication (username/password)
"^DD",996.52,996.52,2,21,4,0)
       OAUTH - OAuth2 authentication (bearer)
"^DD",996.52,996.52,2,21,5,0)

"^DD",996.52,996.52,2,21,6,0)
No entry means that no authentication is required.
"^DD",996.52,996.52,2,"DT")
3150331
"^DD",996.52,996.52,10,0)
HANDLER^FX^^10;E1,250^K:X'?.8AN1"^"1.8AN X
"^DD",996.52,996.52,10,3)
Enter the handler entry point as TAG^ROUTINE.
"^DD",996.52,996.52,10,"DT")
3150330
"^DD",996.52,996.52,99,0)
DESCRIPTION^996.5299^^99;0
"^DD",996.52,996.5299,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",996.52,996.5299,0,"DT")
3150330
"^DD",996.52,996.5299,0,"NM","DESCRIPTION")

"^DD",996.52,996.5299,0,"UP")
996.52
"^DD",996.52,996.5299,.01,0)
DESCRIPTION^WL^^0;1^Q
"^DD",996.52,996.5299,.01,21,0)
^^1^1^3150330.181043
"^DD",996.52,996.5299,.01,21,1,0)
Provides a detailed description of this end point.
"^DD",996.52,996.5299,.01,"DT")
3150330
"^DIC",996.5,996.5,0)
NETSERV TCP LISTENER^996.5
"^DIC",996.5,996.5,0,"GL")
^RGNET(996.5,
"^DIC",996.5,996.5,"%D",0)
^1.001^2^2^3150330^
"^DIC",996.5,996.5,"%D",1,0)
Each entry in this file represents a configuration for a listener that will
"^DIC",996.5,996.5,"%D",2,0)
process requests on a given TCP port via the specified handler.
"^DIC",996.5,"B","NETSERV TCP LISTENER",996.5)

"^DIC",996.51,996.51,0)
NETSERV HTTP STATUS^996.51
"^DIC",996.51,996.51,0,"GL")
^RGNET(996.51,
"^DIC",996.51,996.51,"%D",0)
^1.001^1^1^3150330^^^
"^DIC",996.51,996.51,"%D",1,0)
List of valid HTTP status codes and their default display text.
"^DIC",996.51,"B","NETSERV HTTP STATUS",996.51)

"^DIC",996.52,996.52,0)
NETSERV HTTP ENDPOINT^996.52
"^DIC",996.52,996.52,0,"GL")
^RGNET(996.52,
"^DIC",996.52,996.52,"%",0)
^1.005^^
"^DIC",996.52,996.52,"%D",0)
^^3^3^3150330.180223
"^DIC",996.52,996.52,"%D",1,0)
This file defines execution endpoints for HTTP-based services. A service 
"^DIC",996.52,996.52,"%D",2,0)
request is matched to its respective endpoint by matching the request method 
"^DIC",996.52,996.52,"%D",3,0)
and the request URL to the corresponding entry in this file.
"^DIC",996.52,"B","NETSERV HTTP ENDPOINT",996.52)

**INSTALL NAME**
NETSERV RPC BROKER 1.0
"BLD",8509,0)
NETSERV RPC BROKER 1.0^NETWORK SERVICES^0^3150404^n
"BLD",8509,1,0)
^^3^3^3150401.075336
"BLD",8509,1,1,0)
This is an implementation of a remote procedure call broker that uses the
"BLD",8509,1,2,0)
TCP connection manager.  It supports native asynchronous RPC calls and
"BLD",8509,1,3,0)
event propagation.
"BLD",8509,4,0)
^9.64PA^996.5^5
"BLD",8509,4,996.5,0)
996.5
"BLD",8509,4,996.5,222)
n^y^f^^n^^y^o^n
"BLD",8509,4,996.5,224)
I $G(^RGNET(996.5,Y,10))["^RGNETB"
"BLD",8509,4,996.54,0)
996.54
"BLD",8509,4,996.54,222)
y^y^f^^^^n
"BLD",8509,4,996.55,0)
996.55
"BLD",8509,4,996.55,222)
y^y^f^^^^n
"BLD",8509,4,996.56,0)
996.56
"BLD",8509,4,996.56,222)
y^y^f^^^^n
"BLD",8509,4,996.57,0)
996.57
"BLD",8509,4,996.57,222)
y^y^f^^^^n
"BLD",8509,4,"B",996.5,996.5)

"BLD",8509,4,"B",996.54,996.54)

"BLD",8509,4,"B",996.55,996.55)

"BLD",8509,4,"B",996.56,996.56)

"BLD",8509,4,"B",996.57,996.57)

"BLD",8509,6.3)
45
"BLD",8509,"ABPKG")
n
"BLD",8509,"KRN",0)
^9.67PA^779.2^20
"BLD",8509,"KRN",.4,0)
.4
"BLD",8509,"KRN",.401,0)
.401
"BLD",8509,"KRN",.402,0)
.402
"BLD",8509,"KRN",.403,0)
.403
"BLD",8509,"KRN",.5,0)
.5
"BLD",8509,"KRN",.84,0)
.84
"BLD",8509,"KRN",3.6,0)
3.6
"BLD",8509,"KRN",3.8,0)
3.8
"BLD",8509,"KRN",9.2,0)
9.2
"BLD",8509,"KRN",9.8,0)
9.8
"BLD",8509,"KRN",9.8,"NM",0)
^9.68A^7^7
"BLD",8509,"KRN",9.8,"NM",1,0)
RGNETBAC^^0^B22725869
"BLD",8509,"KRN",9.8,"NM",2,0)
RGNETBAS^^0^B5689802
"BLD",8509,"KRN",9.8,"NM",3,0)
RGNETBEV^^0^B59524142
"BLD",8509,"KRN",9.8,"NM",4,0)
RGNETBLG^^0^B10138528
"BLD",8509,"KRN",9.8,"NM",5,0)
RGNETBRK^^0^B5805650
"BLD",8509,"KRN",9.8,"NM",6,0)
RGNETBRP^^0^B62000067
"BLD",8509,"KRN",9.8,"NM",7,0)
RGNETBUT^^0^B38250970
"BLD",8509,"KRN",9.8,"NM","B","RGNETBAC",1)

"BLD",8509,"KRN",9.8,"NM","B","RGNETBAS",2)

"BLD",8509,"KRN",9.8,"NM","B","RGNETBEV",3)

"BLD",8509,"KRN",9.8,"NM","B","RGNETBLG",4)

"BLD",8509,"KRN",9.8,"NM","B","RGNETBRK",5)

"BLD",8509,"KRN",9.8,"NM","B","RGNETBRP",6)

"BLD",8509,"KRN",9.8,"NM","B","RGNETBUT",7)

"BLD",8509,"KRN",19,0)
19
"BLD",8509,"KRN",19,"NM",0)
^9.68A^5^4
"BLD",8509,"KRN",19,"NM",1,0)
RGNETB NIGHTLY TASK^^0
"BLD",8509,"KRN",19,"NM",2,0)
RGNETB PURGE EVENT LOG^^0
"BLD",8509,"KRN",19,"NM",4,0)
RGNETB MAIN MENU^^0
"BLD",8509,"KRN",19,"NM",5,0)
RGNETB SITE PARAMETERS^^0
"BLD",8509,"KRN",19,"NM","B","RGNETB MAIN MENU",4)

"BLD",8509,"KRN",19,"NM","B","RGNETB NIGHTLY TASK",1)

"BLD",8509,"KRN",19,"NM","B","RGNETB PURGE EVENT LOG",2)

"BLD",8509,"KRN",19,"NM","B","RGNETB SITE PARAMETERS",5)

"BLD",8509,"KRN",19.1,0)
19.1
"BLD",8509,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",8509,"KRN",101,0)
101
"BLD",8509,"KRN",101,"NM",0)
^9.68A^^
"BLD",8509,"KRN",409.61,0)
409.61
"BLD",8509,"KRN",771,0)
771
"BLD",8509,"KRN",779.2,0)
779.2
"BLD",8509,"KRN",870,0)
870
"BLD",8509,"KRN",8989.51,0)
8989.51
"BLD",8509,"KRN",8989.51,"NM",0)
^9.68A^6^6
"BLD",8509,"KRN",8989.51,"NM",1,0)
RGNETB ACTIVITY LOGGING^^0
"BLD",8509,"KRN",8989.51,"NM",2,0)
RGNETB ACTIVITY RETENTION^^0
"BLD",8509,"KRN",8989.51,"NM",3,0)
RGNETB AUTHENTICATION^^0
"BLD",8509,"KRN",8989.51,"NM",4,0)
RGNETB POLLING INTERVAL^^0
"BLD",8509,"KRN",8989.51,"NM",5,0)
RGNETB RESOURCE DEVICE COUNT^^0
"BLD",8509,"KRN",8989.51,"NM",6,0)
RGNETB RESOURCE DEVICE SLOTS^^0
"BLD",8509,"KRN",8989.51,"NM","B","RGNETB ACTIVITY LOGGING",1)

"BLD",8509,"KRN",8989.51,"NM","B","RGNETB ACTIVITY RETENTION",2)

"BLD",8509,"KRN",8989.51,"NM","B","RGNETB AUTHENTICATION",3)

"BLD",8509,"KRN",8989.51,"NM","B","RGNETB POLLING INTERVAL",4)

"BLD",8509,"KRN",8989.51,"NM","B","RGNETB RESOURCE DEVICE COUNT",5)

"BLD",8509,"KRN",8989.51,"NM","B","RGNETB RESOURCE DEVICE SLOTS",6)

"BLD",8509,"KRN",8989.52,0)
8989.52
"BLD",8509,"KRN",8989.52,"NM",0)
^9.68A^1^1
"BLD",8509,"KRN",8989.52,"NM",1,0)
RGNETB SITE PARAMETERS^^0
"BLD",8509,"KRN",8989.52,"NM","B","RGNETB SITE PARAMETERS",1)

"BLD",8509,"KRN",8994,0)
8994
"BLD",8509,"KRN",8994,"NM",0)
^9.68A^16^16
"BLD",8509,"KRN",8994,"NM",1,0)
RGNETBAS STOP^^0
"BLD",8509,"KRN",8994,"NM",2,0)
RGNETBEV BCAST^^0
"BLD",8509,"KRN",8994,"NM",3,0)
RGNETBEV GETSUBSC^^0
"BLD",8509,"KRN",8994,"NM",4,0)
RGNETBRP AUTH^^0
"BLD",8509,"KRN",8994,"NM",5,0)
RGNETBRP CANRUN^^0
"BLD",8509,"KRN",8994,"NM",6,0)
RGNETBRP CVC^^0
"BLD",8509,"KRN",8994,"NM",7,0)
RGNETBRP DIALOG^^0
"BLD",8509,"KRN",8994,"NM",8,0)
RGNETBRP DIVGET^^0
"BLD",8509,"KRN",8994,"NM",9,0)
RGNETBRP DIVSET^^0
"BLD",8509,"KRN",8994,"NM",10,0)
RGNETBRP GETINFO^^0
"BLD",8509,"KRN",8994,"NM",11,0)
RGNETBRP GETRPCS^^0
"BLD",8509,"KRN",8994,"NM",12,0)
RGNETBRP GETSESSN^^0
"BLD",8509,"KRN",8994,"NM",13,0)
RGNETBRP GETVAR^^0
"BLD",8509,"KRN",8994,"NM",14,0)
RGNETBRP LOCK^^0
"BLD",8509,"KRN",8994,"NM",15,0)
RGNETBRP LOCKRES^^0
"BLD",8509,"KRN",8994,"NM",16,0)
RGNETBRP SETVAR^^0
"BLD",8509,"KRN",8994,"NM","B","RGNETBAS STOP",1)

"BLD",8509,"KRN",8994,"NM","B","RGNETBEV BCAST",2)

"BLD",8509,"KRN",8994,"NM","B","RGNETBEV GETSUBSC",3)

"BLD",8509,"KRN",8994,"NM","B","RGNETBRP AUTH",4)

"BLD",8509,"KRN",8994,"NM","B","RGNETBRP CANRUN",5)

"BLD",8509,"KRN",8994,"NM","B","RGNETBRP CVC",6)

"BLD",8509,"KRN",8994,"NM","B","RGNETBRP DIALOG",7)

"BLD",8509,"KRN",8994,"NM","B","RGNETBRP DIVGET",8)

"BLD",8509,"KRN",8994,"NM","B","RGNETBRP DIVSET",9)

"BLD",8509,"KRN",8994,"NM","B","RGNETBRP GETINFO",10)

"BLD",8509,"KRN",8994,"NM","B","RGNETBRP GETRPCS",11)

"BLD",8509,"KRN",8994,"NM","B","RGNETBRP GETSESSN",12)

"BLD",8509,"KRN",8994,"NM","B","RGNETBRP GETVAR",13)

"BLD",8509,"KRN",8994,"NM","B","RGNETBRP LOCK",14)

"BLD",8509,"KRN",8994,"NM","B","RGNETBRP LOCKRES",15)

"BLD",8509,"KRN",8994,"NM","B","RGNETBRP SETVAR",16)

"BLD",8509,"KRN","B",.4,.4)

"BLD",8509,"KRN","B",.401,.401)

"BLD",8509,"KRN","B",.402,.402)

"BLD",8509,"KRN","B",.403,.403)

"BLD",8509,"KRN","B",.5,.5)

"BLD",8509,"KRN","B",.84,.84)

"BLD",8509,"KRN","B",3.6,3.6)

"BLD",8509,"KRN","B",3.8,3.8)

"BLD",8509,"KRN","B",9.2,9.2)

"BLD",8509,"KRN","B",9.8,9.8)

"BLD",8509,"KRN","B",19,19)

"BLD",8509,"KRN","B",19.1,19.1)

"BLD",8509,"KRN","B",101,101)

"BLD",8509,"KRN","B",409.61,409.61)

"BLD",8509,"KRN","B",771,771)

"BLD",8509,"KRN","B",779.2,779.2)

"BLD",8509,"KRN","B",870,870)

"BLD",8509,"KRN","B",8989.51,8989.51)

"BLD",8509,"KRN","B",8989.52,8989.52)

"BLD",8509,"KRN","B",8994,8994)

"BLD",8509,"QUES",0)
^9.62^^
"BLD",8509,"REQB",0)
^9.611^1^1
"BLD",8509,"REQB",1,0)
NETSERV CONNECTION MANAGER 1.0^2
"BLD",8509,"REQB","B","NETSERV CONNECTION MANAGER 1.0",1)

"DATA",996.5,2,0)
RPC BROKER^9300
"DATA",996.5,2,10)
NETSERV^RGNETBRK
"FIA",996.5)
NETSERV TCP LISTENER
"FIA",996.5,0)
^RGNET(996.5,
"FIA",996.5,0,0)
996.5
"FIA",996.5,0,1)
n^y^f^^n^^y^o^n
"FIA",996.5,0,10)

"FIA",996.5,0,11)
I $G(^RGNET(996.5,Y,10))["^RGNETB"
"FIA",996.5,0,"RLRO")

"FIA",996.5,0,"VR")
1.0^NETSERV RPC BROKER
"FIA",996.5,996.5)
0
"FIA",996.54)
NETSERV BROKER EVENT TYPE
"FIA",996.54,0)
^RGNET(996.54,
"FIA",996.54,0,0)
996.54
"FIA",996.54,0,1)
y^y^f^^^^n
"FIA",996.54,0,10)

"FIA",996.54,0,11)

"FIA",996.54,0,"RLRO")

"FIA",996.54,0,"VR")
1.0^NETSERV RPC BROKER
"FIA",996.54,996.54)
0
"FIA",996.54,996.542)
0
"FIA",996.54,996.5421)
0
"FIA",996.54,996.5499)
0
"FIA",996.55)
NETSERV BROKER EVENT LOG
"FIA",996.55,0)
^RGNET(996.55,
"FIA",996.55,0,0)
996.55DI
"FIA",996.55,0,1)
y^y^f^^^^n
"FIA",996.55,0,10)

"FIA",996.55,0,11)

"FIA",996.55,0,"RLRO")

"FIA",996.55,0,"VR")
1.0^NETSERV RPC BROKER
"FIA",996.55,996.55)
0
"FIA",996.55,996.552)
0
"FIA",996.56)
NETSERV BROKER ACTIVITY LOG
"FIA",996.56,0)
^RGNET(996.56,
"FIA",996.56,0,0)
996.56
"FIA",996.56,0,1)
y^y^f^^^^n
"FIA",996.56,0,10)

"FIA",996.56,0,11)

"FIA",996.56,0,"RLRO")

"FIA",996.56,0,"VR")
1.0^NETSERV RPC BROKER
"FIA",996.56,996.56)
0
"FIA",996.56,996.561)
0
"FIA",996.56,996.562)
0
"FIA",996.57)
NETSERV BROKER AUTHENTICATION
"FIA",996.57,0)
^RGNET(996.57,
"FIA",996.57,0,0)
996.57AI
"FIA",996.57,0,1)
y^y^f^^^^n
"FIA",996.57,0,10)

"FIA",996.57,0,11)

"FIA",996.57,0,"RLRO")

"FIA",996.57,0,"VR")
1.0^NETSERV RPC BROKER
"FIA",996.57,996.57)
0
"KRN",19,11325,-1)
0^4
"KRN",19,11325,0)
RGNETB MAIN MENU^NETSERV Broker Main Menu^^M^^^^^^^^NETWORK SERVICES^^^^^1
"KRN",19,11325,10,0)
^19.01IP^4^2
"KRN",19,11325,10,1,0)
11328^1^10
"KRN",19,11325,10,1,"^")
RGNETB SITE PARAMETERS
"KRN",19,11325,10,4,0)
11326^4^40
"KRN",19,11325,10,4,"^")
RGNETB PURGE EVENT LOG
"KRN",19,11325,15)

"KRN",19,11325,20)

"KRN",19,11325,26)
D MNUHDR^RGUT()
"KRN",19,11325,99)
63643,10563
"KRN",19,11325,"U")
NETSERV BROKER MAIN MENU
"KRN",19,11326,-1)
0^2
"KRN",19,11326,0)
RGNETB PURGE EVENT LOG^Purge Event Log^^A^^^^^^^^^^1^
"KRN",19,11326,1,0)
^^1^1^3030611.123339
"KRN",19,11326,1,1,0)
Tasks the nightly purge of the NETSERV Broker event log file.
"KRN",19,11326,15)

"KRN",19,11326,20)
D MNUEXEC^RGUT("D TASKPRG^RGNETBEV",1)
"KRN",19,11326,25)

"KRN",19,11326,"U")
PURGE EVENT LOG
"KRN",19,11327,-1)
0^1
"KRN",19,11327,0)
RGNETB NIGHTLY TASK^Submit Cleanup Task^^R^^^^^^^^NETWORK SERVICES^^1^
"KRN",19,11327,15)

"KRN",19,11327,20)
D MNUHDR^RGUT()
"KRN",19,11327,25)
NIGHTLY^RGNETBUT
"KRN",19,11327,200.9)
y
"KRN",19,11327,"U")
SUBMIT CLEANUP TASK
"KRN",19,11328,-1)
0^5
"KRN",19,11328,0)
RGNETB SITE PARAMETERS^Edit NETSERV Broker Package Parameters^^A^^^^^^^^^^1
"KRN",19,11328,20)
D MNUTEMPL^RGUT()
"KRN",19,11328,"U")
EDIT NETSERV BROKER PACKAGE PA
"KRN",8989.51,412,-1)
0^3
"KRN",8989.51,412,0)
RGNETB AUTHENTICATION^Authentication method^1^UCI^Authentication method
"KRN",8989.51,412,1)
S^0:Normal;1:Client Cached;2:Server Cached
"KRN",8989.51,412,6)
F
"KRN",8989.51,412,20,0)
^8989.512^5^5^3061024^^^^
"KRN",8989.51,412,20,1,0)
Dictates authentication method used.
"KRN",8989.51,412,20,2,0)

"KRN",8989.51,412,20,3,0)
Normal        - No password caching is used.
"KRN",8989.51,412,20,4,0)
Client Cached - Username and password are encrypted and cached in NT user profile.
"KRN",8989.51,412,20,5,0)
Server Cached - User SID (security identifier) cached on server. 
"KRN",8989.51,412,30,0)
^8989.513I^1^1
"KRN",8989.51,412,30,1,0)
100^4.2
"KRN",8989.51,413,-1)
0^4
"KRN",8989.51,413,0)
RGNETB POLLING INTERVAL^Host polling interval^0^Interval^Host Polling Interval
"KRN",8989.51,413,1)
N^^Number of seconds (1-60) between polls.
"KRN",8989.51,413,2)
S Y=Y\1 S:Y<1 Y=1 S:Y>60 Y=60
"KRN",8989.51,413,20,0)
^8989.512^4^4^3070607^^
"KRN",8989.51,413,20,1,0)
This is the interval in seconds that the client will poll the server for 
"KRN",8989.51,413,20,2,0)
signaled events or asynchronous remote procedure calls.  
"KRN",8989.51,413,20,3,0)

"KRN",8989.51,413,20,4,0)
Range should be 1-60, inclusive.  Typical values are 3-5 seconds.
"KRN",8989.51,413,30,0)
^8989.513I^1^1
"KRN",8989.51,413,30,1,0)
100^4.2
"KRN",8989.51,414,-1)
0^5
"KRN",8989.51,414,0)
RGNETB RESOURCE DEVICE COUNT^Maximum number of resource devices^0^Count^Resource Device Count
"KRN",8989.51,414,1)
N^^The maximum number (1-20) of resource devices that may be created.
"KRN",8989.51,414,2)
S Y=Y\1 S:Y<1 Y=1 S:Y>20 Y=20
"KRN",8989.51,414,20,0)
^8989.512^4^4^3061024^
"KRN",8989.51,414,20,1,0)
This is the maximum number of resource devices that can be used by the package.
"KRN",8989.51,414,20,2,0)
Must be between 1 and 20, inclusive.  Higher values will increase server load,
"KRN",8989.51,414,20,3,0)
but improve application response to asynchronous remote procedure calls and 
"KRN",8989.51,414,20,4,0)
host-signalled events
"KRN",8989.51,414,30,0)
^8989.513I^1^1
"KRN",8989.51,414,30,1,0)
100^4.2
"KRN",8989.51,415,-1)
0^6
"KRN",8989.51,415,0)
RGNETB RESOURCE DEVICE SLOTS^Number of resource slots to allocate^0^Slots^Resource Device Slots
"KRN",8989.51,415,1)
N^^Maximum number (1-20) of slots per resource device.
"KRN",8989.51,415,2)
S Y=Y\1 S:Y<1 Y=1 S:Y>20 Y=20 D SETSLOTS^RGNETBUT(Y)
"KRN",8989.51,415,20,0)
^8989.512^4^4^3061024^
"KRN",8989.51,415,20,1,0)
This is the maximum number of slots that will be allocated to resource devices
"KRN",8989.51,415,20,2,0)
used by the package. Must be between 1 and 20, inclusive.  Higher values will 
"KRN",8989.51,415,20,3,0)
increase server load, but improve application performance for asynchronous 
"KRN",8989.51,415,20,4,0)
remote procedure calls.
"KRN",8989.51,415,30,0)
^8989.513I^1^1
"KRN",8989.51,415,30,1,0)
100^4.2
"KRN",8989.51,416,-1)
0^1
"KRN",8989.51,416,0)
RGNETB ACTIVITY LOGGING^Enable logging of session activities^1^Application^Enable activity logging
"KRN",8989.51,416,1)
Y
"KRN",8989.51,416,6)
P^19
"KRN",8989.51,416,20,0)
^8989.512^3^3^3080104^^
"KRN",8989.51,416,20,1,0)
If activated, results in logging session activities such as remote procedure 
"KRN",8989.51,416,20,2,0)
calls and events to the NETSERV BROKER ACTIVITY LOG file.  Activating this feature may 
"KRN",8989.51,416,20,3,0)
have significant adverse impact on application performance and disk usage. 
"KRN",8989.51,416,30,0)
^8989.513I^3^3
"KRN",8989.51,416,30,1,0)
400^4.2
"KRN",8989.51,416,30,2,0)
200^4
"KRN",8989.51,416,30,3,0)
100^200
"KRN",8989.51,417,-1)
0^2
"KRN",8989.51,417,0)
RGNETB ACTIVITY RETENTION^Retention period for logged activities.^^^Retention period (days)
"KRN",8989.51,417,1)
N^1:9999999^Enter retention period in days for logged activities.
"KRN",8989.51,417,20,0)
^8989.512^1^1^3080104^
"KRN",8989.51,417,20,1,0)
This controls how long entries in the NETSERV BROKER ACTIVITY LOG file are retained.
"KRN",8989.51,417,30,0)
^8989.513I^1^1
"KRN",8989.51,417,30,1,0)
400^4.2
"KRN",8989.52,210,-1)
0^1
"KRN",8989.52,210,0)
RGNETB SITE PARAMETERS^NETSERV RPC Broker Site Parameters^4.2
"KRN",8989.52,210,10,0)
^8989.521IA^7^4
"KRN",8989.52,210,10,3,0)
10.1^RGNETB POLLING INTERVAL
"KRN",8989.52,210,10,5,0)
20.1^RGNETB RESOURCE DEVICE COUNT
"KRN",8989.52,210,10,6,0)
20.2^RGNETB RESOURCE DEVICE SLOTS
"KRN",8989.52,210,10,7,0)
30.1^RGNETB AUTHENTICATION
"KRN",8994,2721,-1)
0^4
"KRN",8994,2721,0)
RGNETBRP AUTH^AUTH^RGNETBRP^2
"KRN",8994,2722,-1)
0^9
"KRN",8994,2722,0)
RGNETBRP DIVSET^DIVSET^RGNETBRP^1
"KRN",8994,2723,-1)
0^8
"KRN",8994,2723,0)
RGNETBRP DIVGET^DIVGET^RGNETBRP^2
"KRN",8994,2724,-1)
0^7
"KRN",8994,2724,0)
RGNETBRP DIALOG^DIALOG^RGNETBRP^2
"KRN",8994,2725,-1)
0^11
"KRN",8994,2725,0)
RGNETBRP GETRPCS^GETRPCS^RGNETBRP^4
"KRN",8994,2726,-1)
0^16
"KRN",8994,2726,0)
RGNETBRP SETVAR^SETVAR^RGNETBRP^1
"KRN",8994,2727,-1)
0^2
"KRN",8994,2727,0)
RGNETBEV BCAST^BCAST^RGNETBEV^1
"KRN",8994,2728,-1)
0^3
"KRN",8994,2728,0)
RGNETBEV GETSUBSC^GETSUBSC^RGNETBEV^4^^^^1
"KRN",8994,2729,-1)
0^12
"KRN",8994,2729,0)
RGNETBRP GETSESSN^GETSESSN^RGNETBRP^4^^^^1
"KRN",8994,2730,-1)
0^1
"KRN",8994,2730,0)
RGNETBAS STOP^STOP^RGNETBAS^1
"KRN",8994,2731,-1)
0^13
"KRN",8994,2731,0)
RGNETBRP GETVAR^GETVAR^RGNETBRP^2^^^^1
"KRN",8994,2732,-1)
0^10
"KRN",8994,2732,0)
RGNETBRP GETINFO^GETINFO^RGNETBRP^4^^^^1
"KRN",8994,2733,-1)
0^5
"KRN",8994,2733,0)
RGNETBRP CANRUN^CANRUN^RGNETBRP^1
"KRN",8994,2734,-1)
0^14
"KRN",8994,2734,0)
RGNETBRP LOCK^LOCK^RGNETBRP^1
"KRN",8994,2735,-1)
0^15
"KRN",8994,2735,0)
RGNETBRP LOCKRES^LOCKRES^RGNETBRP^4^^^^1
"KRN",8994,2736,-1)
0^6
"KRN",8994,2736,0)
RGNETBRP CVC^CVC^RGNETBRP^1^^^^1
"MBREQ")
1
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"ORD",21,8989.52)
8989.52;21;1;;PAR2E1^XPDTA2;PAR2F1^XPDIA3;PAR2E1^XPDIA3;PAR2F2^XPDIA3;;PAR2DEL^XPDIA3(%)
"ORD",21,8989.52,0)
PARAMETER TEMPLATE
"PKG",225,-1)
1^1
"PKG",225,0)
NETWORK SERVICES^RGNE^Network services
"PKG",225,20,0)
^9.402P^^
"PKG",225,22,0)
^9.49I^1^1
"PKG",225,22,1,0)
1.0^3150404
"PKG",225,22,1,1,0)
^^3^3^3150404
"PKG",225,22,1,1,1,0)
This is an implementation of a remote procedure call broker that uses the
"PKG",225,22,1,1,2,0)
TCP connection manager.  It supports native asynchronous RPC calls and
"PKG",225,22,1,1,3,0)
event propagation.
"PKG",225,"VERSION")
1.0
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","RGNETBAC")
0^1^B22725869
"RTN","RGNETBAC",1,0)
RGNETBAC ;RI/CBMI/DKM - NETSERV RPC Broker Actions;04-Apr-2015 07:33;DKM
"RTN","RGNETBAC",2,0)
 ;;1.0;NETWORK SERVICES;;01-Apr-2015;Build 45
"RTN","RGNETBAC",3,0)
 ;=================================================================
"RTN","RGNETBAC",4,0)
 ; Connect action
"RTN","RGNETBAC",5,0)
 ; Data is returned to client as:
"RTN","RGNETBAC",6,0)
 ;   debug flag^authentication method^server version^case sensitive^cipher key
"RTN","RGNETBAC",7,0)
ACTC N X,Y,VOL,UCI,VER,AUTH
"RTN","RGNETBAC",8,0)
 S Y=$$GETUCI,UCI(0)=Y,UCI=$$UP^XLFSTR($G(RGNETB("UCI"),Y)),VOL=$P(UCI,",",2),VER=$P($T(+2),";",3)
"RTN","RGNETBAC",9,0)
 S:'$L(UCI) UCI=Y
"RTN","RGNETBAC",10,0)
 S:'$L(VOL) VOL=$P(Y,",",2),$P(UCI,",",2)=VOL
"RTN","RGNETBAC",11,0)
 I UCI'=UCI(0),$$ERRCHK(0[$$UCICHECK^%ZOSV(UCI),14,UCI) Q
"RTN","RGNETBAC",12,0)
 Q:$$ERRCHK('$L(VOL),11)
"RTN","RGNETBAC",13,0)
 S AUTH=$$AUTHMETH(UCI),RGDATA=(RGMODE=3)_U_AUTH_U_VER_U_$$GET^XPAR("SYS","XU VC CASE SENSITIVE")_U_$E($P($T(Z+1^XUSRB1),";;",2,999),1,4)
"RTN","RGNETBAC",14,0)
 Q:$$ERRCHK('$L(AUTH),24,UCI)
"RTN","RGNETBAC",15,0)
 I $D(^%ZOSF("ACTJ")) D  Q:$$ERRCHK(X'>Y&X,10,Y,X)
"RTN","RGNETBAC",16,0)
 .; Y=# active jobs, X=max active jobs
"RTN","RGNETBAC",17,0)
 .X ^%ZOSF("ACTJ")
"RTN","RGNETBAC",18,0)
 .S X=+$O(^XTV(8989.3,1,4,"B",VOL,0)),X=$S(X:+$P($G(^XTV(8989.3,1,4,X,0)),U,3),1:0)
"RTN","RGNETBAC",19,0)
 D INTRO^XUS1A("RGDATA")
"RTN","RGNETBAC",20,0)
 Q
"RTN","RGNETBAC",21,0)
 ; Disconnect action
"RTN","RGNETBAC",22,0)
ACTD D RESET^RGNETBRP()
"RTN","RGNETBAC",23,0)
 S RGDATA=1,RGQUIT=1
"RTN","RGNETBAC",24,0)
 Q
"RTN","RGNETBAC",25,0)
 ; Query action
"RTN","RGNETBAC",26,0)
ACTQ Q:$$ASYCHK^RGNETBAS
"RTN","RGNETBAC",27,0)
 Q:$$EVTCHK^RGNETBEV
"RTN","RGNETBAC",28,0)
 ; Ping action
"RTN","RGNETBAC",29,0)
ACTP S DT=$$NOW^XLFDT,RGDATA=$$PARAM^RGNETBUT("RGNETB POLLING INTERVAL",1,60)_U_DT,DT=DT\1
"RTN","RGNETBAC",30,0)
 Q
"RTN","RGNETBAC",31,0)
 ; Subscribe action
"RTN","RGNETBAC",32,0)
ACTS S RGDATA=1
"RTN","RGNETBAC",33,0)
 Q:$$ERRCHK('$$SUBSCR^RGNETBEV(RGNETB("EVT"),1),13,RGNETB("EVT"))
"RTN","RGNETBAC",34,0)
 Q
"RTN","RGNETBAC",35,0)
 ; Unsubscribe action
"RTN","RGNETBAC",36,0)
ACTU S RGDATA=$$SUBSCR^RGNETBEV(RGNETB("EVT"),0)
"RTN","RGNETBAC",37,0)
 Q
"RTN","RGNETBAC",38,0)
 ; RPC action
"RTN","RGNETBAC",39,0)
ACTR N RPC,RTN,RGD,XWBWRAP,XWBPTYPE,I
"RTN","RGNETBAC",40,0)
 I '$D(RGNETB("CTX")) S RGNETB("CTX")=$$GETVAR^RGNETBUT("CTX")
"RTN","RGNETBAC",41,0)
 E  D SETVAR^RGNETBUT("CTX",RGNETB("CTX"))
"RTN","RGNETBAC",42,0)
 S:RGNETB("CTX")="" RGNETB("CTX")=$$GETVAR^RGNETBUT("AID")
"RTN","RGNETBAC",43,0)
 S RPC=$$FIND1^DIC(8994,,"QX",$G(RGNETB("RPC")))
"RTN","RGNETBAC",44,0)
 Q:$$ERRCHK('RPC,3)
"RTN","RGNETBAC",45,0)
 S I=$G(^XWB(8994,RPC,0)),RTN=$P(I,U,2,3),XWBWRAP=+$P(I,U,8),XWBPTYPE=$P(I,U,4)
"RTN","RGNETBAC",46,0)
 Q:$$ERRCHK($S($E($P(RTN,U,2),1,6)="RGNETB":0,1:'$$CANRUN(RPC,RGNETB("CTX"))),4,RGNETB("RPC"),RGNETB("CTX"))
"RTN","RGNETBAC",47,0)
 Q:$$ERRCHK("03"'[$P(I,U,6),5)
"RTN","RGNETBAC",48,0)
 Q:$$ERRCHK(RTN'?.8AN1"^"1.8AN,6)
"RTN","RGNETBAC",49,0)
 Q:$$ERRCHK("^1^2^3^4^5^H^"'[(U_XWBPTYPE_U),6)
"RTN","RGNETBAC",50,0)
 Q:$$ERRCHK(ARG>40,7,,ARG,40)
"RTN","RGNETBAC",51,0)
 I $G(RGNETB("ASY")) D
"RTN","RGNETBAC",52,0)
 .N RD
"RTN","RGNETBAC",53,0)
 .S RD="RGNETB THREAD RESOURCE #"_$$GETVAR^RGNETBUT("RDEV")
"RTN","RGNETBAC",54,0)
 .S RGD=$$QUEUE^RGUTTSK("TASK^RGNETBAS","ASYNC RPC: "_RGNETB("RPC"),,"RTN^XWBWRAP^XWBPTYPE^ARG^ARG(^RGNETB(^XWBOS^P*",RD)
"RTN","RGNETBAC",55,0)
 .Q:$$ERRCHK(RGD<1,8)
"RTN","RGNETBAC",56,0)
 .S ^XTMP("RGNETB",RGNETB("UID"),"T",RGD)=""
"RTN","RGNETBAC",57,0)
 .D REPLY^RGNETBRK(RGD)
"RTN","RGNETBAC",58,0)
 E  D
"RTN","RGNETBAC",59,0)
 .S:XWBPTYPE=4 RGD=$$TMPGBL^RGNETBRP("X")
"RTN","RGNETBAC",60,0)
 .D STREST^RGNETTCP(1),DORPC,DATAOUT
"RTN","RGNETBAC",61,0)
 Q
"RTN","RGNETBAC",62,0)
 ; Builds the RPC entry code and executes it
"RTN","RGNETBAC",63,0)
DORPC N I,P,XWBAPVER,XQY,RGQUIT,ALOG,$ET
"RTN","RGNETBAC",64,0)
 S RTN=RTN_"(.RGD",XWBAPVER=$G(RGNETB("VER")),XQY=$$GETVAR^RGNETBUT("AID0")
"RTN","RGNETBAC",65,0)
 S ALOG=$$ISACTIVE^RGNETBLG,ALOG(0)=$S(ALOG:$$LOG^RGNETBLG(ALOG,1,RGNETB("RPC")),1:0)
"RTN","RGNETBAC",66,0)
 F I=1:1:ARG D
"RTN","RGNETBAC",67,0)
 .S RTN=RTN_","
"RTN","RGNETBAC",68,0)
 .Q:'$D(ARG(I))
"RTN","RGNETBAC",69,0)
 .S P="P"_I,RTN=RTN_"."_P
"RTN","RGNETBAC",70,0)
 .S:$D(@P)=10 @P=""
"RTN","RGNETBAC",71,0)
 .D:ALOG(0) ADD^RGNETBLG(ALOG,ALOG(0),P,1)
"RTN","RGNETBAC",72,0)
 S RTN=RTN_")"
"RTN","RGNETBAC",73,0)
 D
"RTN","RGNETBAC",74,0)
 .N ALOG
"RTN","RGNETBAC",75,0)
 .D @RTN
"RTN","RGNETBAC",76,0)
 I ALOG(0) D
"RTN","RGNETBAC",77,0)
 .N VAL,ARY
"RTN","RGNETBAC",78,0)
 .S VAL=$C(13)_"Return Data:"_$C(13)
"RTN","RGNETBAC",79,0)
 .D ADD^RGNETBLG(ALOG,ALOG(0),"VAL")
"RTN","RGNETBAC",80,0)
 .I XWBPTYPE=1 S VAL=$G(RGD),ARY="VAL"
"RTN","RGNETBAC",81,0)
 .E  I XWBPTYPE=2 S ARY="RGD"
"RTN","RGNETBAC",82,0)
 .E  I XWBPTYPE=3 S ARY="RGD"
"RTN","RGNETBAC",83,0)
 .E  I XWBPTYPE=4 S ARY=RGD
"RTN","RGNETBAC",84,0)
 .E  I XWBPTYPE=5 S VAL=$G(@RGD),ARY="VAL"
"RTN","RGNETBAC",85,0)
 .E  I XWBPTYPE="H" S VAL=RGD,ARY="VAL"
"RTN","RGNETBAC",86,0)
 .E  Q
"RTN","RGNETBAC",87,0)
 .D ADD^RGNETBLG(ALOG,ALOG(0),ARY)
"RTN","RGNETBAC",88,0)
 Q
"RTN","RGNETBAC",89,0)
 ; Test for error condition
"RTN","RGNETBAC",90,0)
 ; TEST = If true, setup the error
"RTN","RGNETBAC",91,0)
 ; ERR  = Error code
"RTN","RGNETBAC",92,0)
 ; Pn   = Optional parameters (up to 3)
"RTN","RGNETBAC",93,0)
ERRCHK(TEST,ERR,P1,P2,P3) ;
"RTN","RGNETBAC",94,0)
 I TEST,'$G(RGERR(0)) D
"RTN","RGNETBAC",95,0)
 .D GETDLG^RGNETBUT(ERR,.RGERR,.P1,.P2,.P3)
"RTN","RGNETBAC",96,0)
 .S RGERR(0)=ERR
"RTN","RGNETBAC",97,0)
 Q:$Q +$G(RGERR(0))
"RTN","RGNETBAC",98,0)
 Q
"RTN","RGNETBAC",99,0)
 ; Writes return data to TCP stream
"RTN","RGNETBAC",100,0)
DATAOUT D TCPWRITE^RGNETTCP($C(0))
"RTN","RGNETBAC",101,0)
 I XWBPTYPE=1 D TCPWRITE^RGNETBRK(.RGD) Q
"RTN","RGNETBAC",102,0)
 I XWBPTYPE=2 D ARYOUT^RGNETBRK("RGD",1) Q
"RTN","RGNETBAC",103,0)
 I XWBPTYPE=3 D ARYOUT^RGNETBRK("RGD",XWBWRAP) Q
"RTN","RGNETBAC",104,0)
 I XWBPTYPE=4 D ARYOUT^RGNETBRK(RGD,XWBWRAP) Q
"RTN","RGNETBAC",105,0)
 I XWBPTYPE=5 D TCPWRITE^RGNETBRK($G(@RGD)) Q
"RTN","RGNETBAC",106,0)
 I XWBPTYPE="H" D HFSOUT^RGNETBRK(RGD,XWBWRAP) Q
"RTN","RGNETBAC",107,0)
 Q
"RTN","RGNETBAC",108,0)
 ; Returns true if RPC can run in current context
"RTN","RGNETBAC",109,0)
CANRUN(RPC,CTX) ;
"RTN","RGNETBAC",110,0)
 Q:'$G(DUZ)!'RPC 0
"RTN","RGNETBAC",111,0)
 S CTX(0)=$$OPTLKP^RGNETBUT(CTX)
"RTN","RGNETBAC",112,0)
 Q:$$ERRCHK('$L(CTX(0)),2,CTX) 0
"RTN","RGNETBAC",113,0)
 D:'$G(^XTMP("RGNETB",RGNETB("UID"),"C",CTX(0))) BLDCTX(CTX(0))
"RTN","RGNETBAC",114,0)
 Q:$$KCHK^XUSRB("XUPROGMODE") 1
"RTN","RGNETBAC",115,0)
 Q $D(^XTMP("RGNETB",RGNETB("UID"),"C",CTX(0),RPC))
"RTN","RGNETBAC",116,0)
 ; Build RPC context table
"RTN","RGNETBAC",117,0)
BLDCTX(OPT,CTX) ;
"RTN","RGNETBAC",118,0)
 N X
"RTN","RGNETBAC",119,0)
 I '$D(CTX) K ^XTMP("RGNETB",RGNETB("UID"),"C",OPT) S ^(OPT)=1,CTX=OPT
"RTN","RGNETBAC",120,0)
 Q:$D(^XTMP("RGNETB",RGNETB("UID"),"C",CTX,0,OPT))  S ^(OPT)=""
"RTN","RGNETBAC",121,0)
 Q:$$OPTCHK^RGNETBUT(OPT,"B")
"RTN","RGNETBAC",122,0)
 M ^XTMP("RGNETB",RGNETB("UID"),"C",CTX)=^DIC(19,OPT,"RPC","B")
"RTN","RGNETBAC",123,0)
 F X=0:0 S X=$O(^DIC(19,OPT,10,"B",X)) Q:'X  D BLDCTX(X,CTX)
"RTN","RGNETBAC",124,0)
 K:CTX=OPT ^XTMP("RGNETB",RGNETB("UID"),"C",CTX,0)
"RTN","RGNETBAC",125,0)
 Q
"RTN","RGNETBAC",126,0)
 ; Return current UCI
"RTN","RGNETBAC",127,0)
GETUCI() N Y
"RTN","RGNETBAC",128,0)
 D UCI^%ZOSV
"RTN","RGNETBAC",129,0)
 Q Y
"RTN","RGNETBAC",130,0)
 ; Change UCI
"RTN","RGNETBAC",131,0)
SETUCI(X) D SWAP^%XUCI
"RTN","RGNETBAC",132,0)
 Q
"RTN","RGNETBAC",133,0)
 ; Get authentication method for target UCI
"RTN","RGNETBAC",134,0)
AUTHMETH(UCI) ;
"RTN","RGNETBAC",135,0)
 N X,PC
"RTN","RGNETBAC",136,0)
 F PC=2,1 D  Q:$L(X)
"RTN","RGNETBAC",137,0)
 .S X=$$GET^XPAR("ALL","RGNETB AUTHENTICATION",$P(UCI,",",1,PC))
"RTN","RGNETBAC",138,0)
 Q X
"RTN","RGNETBAS")
0^2^B5689802
"RTN","RGNETBAS",1,0)
RGNETBAS ;RI/CBMI/DKM - Asynchronous RPC calls ;04-Apr-2015 08:42;DKM
"RTN","RGNETBAS",2,0)
 ;;1.0;NETWORK SERVICES;;01-Apr-2015;Build 45
"RTN","RGNETBAS",3,0)
 ;=================================================================
"RTN","RGNETBAS",4,0)
 ; Background task for executing an asynchronous RPC
"RTN","RGNETBAS",5,0)
TASK N RGD,TGT,$ET,$ES
"RTN","RGNETBAS",6,0)
 S $ET="D ERROR^RGNETBAS",ZTREQ="@"
"RTN","RGNETBAS",7,0)
 K ^XTMP("RGNETB",RGNETB("UID"),"T",ZTSK)
"RTN","RGNETBAS",8,0)
 Q:$$S^%ZTLOAD
"RTN","RGNETBAS",9,0)
 S ^XTMP("RGNETB",RGNETB("UID"),"T",ZTSK)=0,TGT=$NA(^(ZTSK,0))
"RTN","RGNETBAS",10,0)
 S:XWBPTYPE=4 RGD=TGT
"RTN","RGNETBAS",11,0)
 D DORPC^RGNETBAC
"RTN","RGNETBAS",12,0)
 I XWBPTYPE=1 S @TGT@(0)=RGD
"RTN","RGNETBAS",13,0)
 E  I XWBPTYPE>1,XWBPTYPE<4 M @TGT=RGD S:XWBPTYPE=2 XWBWRAP=1
"RTN","RGNETBAS",14,0)
 E  I XWBPTYPE=4,$L(RGD),RGD'=TGT M @TGT=@RGD K @RGD
"RTN","RGNETBAS",15,0)
 E  I XWBPTYPE=5 S @TGT@(0)=$G(@RGD)
"RTN","RGNETBAS",16,0)
 E  I XWBPTYPE="H" D
"RTN","RGNETBAS",17,0)
 .N X,Y,FIL,DIR
"RTN","RGNETBAS",18,0)
 .S X=$E($$DIRDLM^RGUTOS,3),Y=$L(RGD,X),DIR=$P(RGD,X,1,Y-1),FIL=$P(RGD,X,Y)
"RTN","RGNETBAS",19,0)
 .I '$$FTG^%ZISH(DIR,FIL,$NA(@TGT@(0)),$QL(TGT)+1)
"RTN","RGNETBAS",20,0)
 .D DELETE^RGUTOS(RGD)
"RTN","RGNETBAS",21,0)
 I $$S^%ZTLOAD K ^XTMP("RGNETB",RGNETB("UID"),"T",ZTSK)
"RTN","RGNETBAS",22,0)
 E  S ^XTMP("RGNETB",RGNETB("UID"),"T",ZTSK)=ZTSK_"^0^"_XWBWRAP
"RTN","RGNETBAS",23,0)
 Q
"RTN","RGNETBAS",24,0)
ERROR D SETERR(-1,$$EC^%ZOSV)
"RTN","RGNETBAS",25,0)
 D ^%ZTER,UNWIND^%ZTER
"RTN","RGNETBAS",26,0)
 Q
"RTN","RGNETBAS",27,0)
 ; Retrieve specified routine line
"RTN","RGNETBAS",28,0)
RTNTEXT(RTN) ;
"RTN","RGNETBAS",29,0)
 N TAG
"RTN","RGNETBAS",30,0)
 S TAG=$P(RTN,U),RTN=$P(RTN,U,2)
"RTN","RGNETBAS",31,0)
 Q $S('$L(RTN):$T(^@TAG),$L(TAG):$T(@TAG^@RTN),1:$T(^@RTN))
"RTN","RGNETBAS",32,0)
 ; Set error info to return to client
"RTN","RGNETBAS",33,0)
SETERR(CODE,TEXT) ;
"RTN","RGNETBAS",34,0)
 K ^XTMP("RGNETB",RGNETB("UID"),"T",ZTSK) M ^(ZTSK,0,0)=TEXT
"RTN","RGNETBAS",35,0)
 S ^XTMP("RGNETB",RGNETB("UID"),"T",ZTSK)=ZTSK_U_CODE_"^1"
"RTN","RGNETBAS",36,0)
 Q
"RTN","RGNETBAS",37,0)
 ; RPC to check for completed tasks
"RTN","RGNETBAS",38,0)
 ; Results[0] at the client end will contain the TaskMan ID of the
"RTN","RGNETBAS",39,0)
 ; completed RPC. The remainder of the Result will be the data
"RTN","RGNETBAS",40,0)
 ; returned by the RPC.
"RTN","RGNETBAS",41,0)
ASYCHK() N ZTSK,RGD,X
"RTN","RGNETBAS",42,0)
 S ZTSK=0
"RTN","RGNETBAS",43,0)
 F  S ZTSK=+$O(^XTMP("RGNETB",RGNETB("UID"),"T",ZTSK)) Q:'ZTSK  S X=$G(^(ZTSK)),RGD=$NA(^(ZTSK,0)) I X D  Q
"RTN","RGNETBAS",44,0)
 .D TCPWRITE^RGNETBRK($C(2)_X_$C(13))
"RTN","RGNETBAS",45,0)
 .D ARYOUT^RGNETBRK(RGD,$P(X,U,3))
"RTN","RGNETBAS",46,0)
 .K ^XTMP("RGNETB",RGNETB("UID"),"T",ZTSK)
"RTN","RGNETBAS",47,0)
 Q ZTSK
"RTN","RGNETBAS",48,0)
 ; RPC: Stop a task
"RTN","RGNETBAS",49,0)
 ; Signals to a backround task that it should stop running.  Cleans up
"RTN","RGNETBAS",50,0)
 ; any output generated by completed tasks.
"RTN","RGNETBAS",51,0)
STOP(RGD,ZTSK) ;
"RTN","RGNETBAS",52,0)
 S RGD=''$D(^XTMP("RGNETB",RGNETB("UID"),"T",ZTSK)) K:RGD ^(ZTSK)
"RTN","RGNETBAS",53,0)
 Q:'$D(^%ZTSK(ZTSK))
"RTN","RGNETBAS",54,0)
 S $P(^%ZTSK(ZTSK,.1),U,10)=$P($G(^VA(200,DUZ,0)),U)
"RTN","RGNETBAS",55,0)
 D DQ^%ZTLOAD
"RTN","RGNETBAS",56,0)
 I $G(ZTSK(0)) D KILL^%ZTLOAD
"RTN","RGNETBAS",57,0)
 Q
"RTN","RGNETBAS",58,0)
 ; Stop all tasks in task list
"RTN","RGNETBAS",59,0)
STOPALL N ZTSK
"RTN","RGNETBAS",60,0)
 S ZTSK=0
"RTN","RGNETBAS",61,0)
 F  S ZTSK=$O(^XTMP("RGNETB",RGNETB("UID"),"T",ZTSK)) Q:'ZTSK  D STOP(,ZTSK)
"RTN","RGNETBAS",62,0)
 K ^XTMP("RGNETB",RGNETB("UID"),"T")
"RTN","RGNETBAS",63,0)
 Q
"RTN","RGNETBEV")
0^3^B59524142
"RTN","RGNETBEV",1,0)
RGNETBEV ;RI/CBMI/DKM - Event Support ;03-Apr-2015 09:57;DKM
"RTN","RGNETBEV",2,0)
 ;;1.0;NETWORK SERVICES;;01-Apr-2015;Build 45
"RTN","RGNETBEV",3,0)
 ;=================================================================
"RTN","RGNETBEV",4,0)
 ; Check for the occurrence of host events
"RTN","RGNETBEV",5,0)
EVTCHK() ;EP
"RTN","RGNETBEV",6,0)
 N RTN,$ET,X
"RTN","RGNETBEV",7,0)
 S $ET="",X="ERR1^RGNETBEV",@^%ZOSF("TRAP")
"RTN","RGNETBEV",8,0)
 L +^XTMP("RGNETB",RGNETB("UID"),"E"):0
"RTN","RGNETBEV",9,0)
 E  Q 0
"RTN","RGNETBEV",10,0)
 S RTN=+$O(^XTMP("RGNETB",RGNETB("UID"),"E",0)),X=$NA(^(RTN))
"RTN","RGNETBEV",11,0)
 I RTN D
"RTN","RGNETBEV",12,0)
 .D TCPWRITE^RGNETTCP($C(3))
"RTN","RGNETBEV",13,0)
 .D ARYOUT^RGNETBRK(X)
"RTN","RGNETBEV",14,0)
ERR1 L -^XTMP("RGNETB",RGNETB("UID"),"E")
"RTN","RGNETBEV",15,0)
 Q $G(RTN)
"RTN","RGNETBEV",16,0)
 ; Start monitor in background if not already running
"RTN","RGNETBEV",17,0)
MONSTART ;EP
"RTN","RGNETBEV",18,0)
 I '$$MONCHECK,$$QUEUE^RGUTTSK("MONITOR^RGNETBEV","NETSERV Broker Event Monitor")
"RTN","RGNETBEV",19,0)
 Q
"RTN","RGNETBEV",20,0)
 ; Returns true if event monitor is running
"RTN","RGNETBEV",21,0)
 ;   LOCK = If specified and true, do not release lock.
"RTN","RGNETBEV",22,0)
MONCHECK(LOCK) ;EP
"RTN","RGNETBEV",23,0)
 L +^XTMP("RGNETBEV MONITOR"):0
"RTN","RGNETBEV",24,0)
 E  Q 1
"RTN","RGNETBEV",25,0)
 L:'$G(LOCK) -^XTMP("RGNETBEV MONITOR")
"RTN","RGNETBEV",26,0)
 Q 0
"RTN","RGNETBEV",27,0)
 ; Taskman entry point for background event monitor
"RTN","RGNETBEV",28,0)
MONITOR ;EP
"RTN","RGNETBEV",29,0)
 N IEN,TYPE,EXE,IDLE,PMETH,X
"RTN","RGNETBEV",30,0)
 S ZTREQ="@",IDLE=360
"RTN","RGNETBEV",31,0)
 Q:$$MONCHECK(1)
"RTN","RGNETBEV",32,0)
 F  D  Q:IDLE<1!$$S^%ZTLOAD
"RTN","RGNETBEV",33,0)
 .H 5
"RTN","RGNETBEV",34,0)
 .F IEN=0:0 S IEN=$O(^RGNET(996.54,IEN)) Q:'IEN  D
"RTN","RGNETBEV",35,0)
 ..S X=$G(^(IEN,0)),TYPE=$P(X,U),PMETH=$P(X,U,6),EXE=$G(^(1))          ; Note: NR set above
"RTN","RGNETBEV",36,0)
 ..I $L(EXE),'$P(X,U,2),$$CHKINT(+$P(X,U,3)) D
"RTN","RGNETBEV",37,0)
 ...I PMETH D EXEMON Q
"RTN","RGNETBEV",38,0)
 ...N UID
"RTN","RGNETBEV",39,0)
 ...F  Q:'$$NXTUID^RGNETBUT(.UID)  D EXEUID(UID,TYPE)
"RTN","RGNETBEV",40,0)
 .S IDLE=$S($$NXTUID^RGNETBUT:360,1:IDLE-1)
"RTN","RGNETBEV",41,0)
 L -^XTMP("RGNETBEV MONITOR")
"RTN","RGNETBEV",42,0)
 Q
"RTN","RGNETBEV",43,0)
 ; Execute an event monitor in session context
"RTN","RGNETBEV",44,0)
EXEUID(UID,TYPE) ;EP
"RTN","RGNETBEV",45,0)
 Q:'$$ISSUBSCR(UID,TYPE)
"RTN","RGNETBEV",46,0)
 N RG,DUZ
"RTN","RGNETBEV",47,0)
 S RGNETB("UID")=UID,DUZ=$$EXEVAR("DUZ"),DUZ(0)=$$EXEVAR("DUZ0"),DUZ(2)=$$EXEVAR("DUZ2")
"RTN","RGNETBEV",48,0)
 D EXEMON
"RTN","RGNETBEV",49,0)
 Q
"RTN","RGNETBEV",50,0)
 ; Execute the event monitor
"RTN","RGNETBEV",51,0)
EXEMON N X,$ET
"RTN","RGNETBEV",52,0)
 S X="EXEERR^RGNETBEV",@^%ZOSF("TRAP"),$ET=""
"RTN","RGNETBEV",53,0)
 D EXERUN
"RTN","RGNETBEV",54,0)
 Q
"RTN","RGNETBEV",55,0)
EXERUN N IEN,IDLE
"RTN","RGNETBEV",56,0)
 X EXE
"RTN","RGNETBEV",57,0)
 Q
"RTN","RGNETBEV",58,0)
 ; Log any errors
"RTN","RGNETBEV",59,0)
EXEERR N ERT,ERD,X
"RTN","RGNETBEV",60,0)
 S ERT=$TR($$EC^%ZOSV,U,"~"),ERD=$$NOW^XLFDT
"RTN","RGNETBEV",61,0)
 S X=$G(^RGNET(996.54,IEN,100)),^(100)=ERD_U_ERT
"RTN","RGNETBEV",62,0)
 D:(ERD\1'=(X\1))!($P(X,U,2)'=ERT) ^%ZTER
"RTN","RGNETBEV",63,0)
 Q
"RTN","RGNETBEV",64,0)
EXEVAR(VAR) ;
"RTN","RGNETBEV",65,0)
 Q $$GETVAR^RGNETBUT(VAR,,,UID)
"RTN","RGNETBEV",66,0)
 ; Check nominal polling interval.  Return true if event needs to be polled.
"RTN","RGNETBEV",67,0)
CHKINT(INT) ;EP
"RTN","RGNETBEV",68,0)
 Q:'INT 1
"RTN","RGNETBEV",69,0)
 N NXT,NOW,CHK
"RTN","RGNETBEV",70,0)
 S NOW=$H,NOW=NOW*86400+$P(NOW,",",2)
"RTN","RGNETBEV",71,0)
 S NXT=$G(IEN(IEN),NOW),CHK=NOW'<NXT
"RTN","RGNETBEV",72,0)
 S:CHK IEN(IEN)=NOW+INT
"RTN","RGNETBEV",73,0)
 Q CHK
"RTN","RGNETBEV",74,0)
 ; RPC: Broadcast an event to some or all active users
"RTN","RGNETBEV",75,0)
BCAST(DATA,EVENT,STUB,LST,AID) ;
"RTN","RGNETBEV",76,0)
 S DATA=$$BRDCAST(.EVENT,.STUB,.LST,.AID)
"RTN","RGNETBEV",77,0)
 Q
"RTN","RGNETBEV",78,0)
 ; Called by event monitor to signal an event to client
"RTN","RGNETBEV",79,0)
SIGNAL(STUB) ;
"RTN","RGNETBEV",80,0)
 D QUEUE(TYPE,.STUB)
"RTN","RGNETBEV",81,0)
 Q
"RTN","RGNETBEV",82,0)
 ; Add an event to a process event queue
"RTN","RGNETBEV",83,0)
QUEUE(TYPE,STUB,UID) ;EP
"RTN","RGNETBEV",84,0)
 N Q
"RTN","RGNETBEV",85,0)
 S:'$D(UID) UID=$G(RGNETB("UID"))
"RTN","RGNETBEV",86,0)
 I '$$ISSUBSCR(UID,TYPE) Q:$Q 0 Q
"RTN","RGNETBEV",87,0)
 L +^XTMP("RGNETB",UID,"E"):5
"RTN","RGNETBEV",88,0)
 E  Q:$Q 0 Q
"RTN","RGNETBEV",89,0)
 S Q=1+$O(^XTMP("RGNETB",UID,"E",$C(1)),-1),^(Q,0)=TYPE_$C(13) M ^(1)=STUB
"RTN","RGNETBEV",90,0)
 L -^XTMP("RGNETB",UID,"E")
"RTN","RGNETBEV",91,0)
 Q:$Q 1
"RTN","RGNETBEV",92,0)
 Q
"RTN","RGNETBEV",93,0)
 ; Lookup event type, returning IEN
"RTN","RGNETBEV",94,0)
EVENTIEN(TYPE) ;EP
"RTN","RGNETBEV",95,0)
 N X,Y
"RTN","RGNETBEV",96,0)
 Q:TYPE=+TYPE!'$L(TYPE) +TYPE
"RTN","RGNETBEV",97,0)
 S X=$E(TYPE,1,30),Y=0
"RTN","RGNETBEV",98,0)
 F  S Y=+$O(^RGNET(996.54,"B",X,Y)) Q:'Y!($P($G(^RGNET(996.54,Y,0)),U)=TYPE)
"RTN","RGNETBEV",99,0)
 Q $S(Y:Y,1:$$EVENTIEN($P(TYPE,".",1,$L(TYPE,".")-1)))
"RTN","RGNETBEV",100,0)
 ; Return event name, given IEN
"RTN","RGNETBEV",101,0)
EVENTNAM(IEN) ;EP
"RTN","RGNETBEV",102,0)
 Q $P($G(^RGNET(996.54,+IEN,0)),U)
"RTN","RGNETBEV",103,0)
 ; Check to see if an event type is disabled
"RTN","RGNETBEV",104,0)
DISABLED(TYPE) ;EP
"RTN","RGNETBEV",105,0)
 N X,Y
"RTN","RGNETBEV",106,0)
 S X=$$EVENTIEN(TYPE),Y=$G(^RGNET(996.54,+X,0)),TYPE=$P(Y,U),Y=+$P(Y,U,2)
"RTN","RGNETBEV",107,0)
 S:'Y Y=$$KEYCHECK(X,20)
"RTN","RGNETBEV",108,0)
 Q $S(Y:Y,'X:0,1:$$DISABLED($P(TYPE,".",1,$L(TYPE,".")-1)))
"RTN","RGNETBEV",109,0)
 ; Check to see if event type is protected by security key(s)
"RTN","RGNETBEV",110,0)
 ; Returns true if user does not have required keys
"RTN","RGNETBEV",111,0)
 ;   SB=20: Publication keys; SB=21: Subscription keys
"RTN","RGNETBEV",112,0)
KEYCHECK(TYPE,SB) ;EP
"RTN","RGNETBEV",113,0)
 N X,Y,Z
"RTN","RGNETBEV",114,0)
 S X=$$EVENTIEN(TYPE),(Y,Z)=0
"RTN","RGNETBEV",115,0)
 F  S Z=$O(^RGNET(996.54,X,SB,"B",Z)) Q:'Z  D  Q:'Y
"RTN","RGNETBEV",116,0)
 .S Y='$$HASKEY(Z)
"RTN","RGNETBEV",117,0)
 Q Y
"RTN","RGNETBEV",118,0)
 ; Return true if user has key
"RTN","RGNETBEV",119,0)
HASKEY(KEY) ;EP
"RTN","RGNETBEV",120,0)
 S:KEY=+KEY KEY=$$LKUP^XPDKEY(KEY)
"RTN","RGNETBEV",121,0)
 Q $S($L(KEY):''$$KCHK^XUSRB(KEY),1:0)
"RTN","RGNETBEV",122,0)
 ; Signal an event to all or selected sessions
"RTN","RGNETBEV",123,0)
 ; If called as extrinsic, returns # of events broadcast
"RTN","RGNETBEV",124,0)
BRDCAST(TYPE,STUB,USR,AID) ;EP
"RTN","RGNETBEV",125,0)
 N X,C
"RTN","RGNETBEV",126,0)
 S C=0
"RTN","RGNETBEV",127,0)
 I '$$DISABLED(TYPE) D
"RTN","RGNETBEV",128,0)
 .I $D(USR("DUZ"))>1 D
"RTN","RGNETBEV",129,0)
 ..F  Q:'$$NXTUID^RGNETBUT(.X,-1,.AID)  D
"RTN","RGNETBEV",130,0)
 ...S:$D(USR("DUZ",+$$GETVAR^RGNETBUT("DUZ",,,X))) USR("UID",X)=""
"RTN","RGNETBEV",131,0)
 .S X=""
"RTN","RGNETBEV",132,0)
 .F  D  Q:'X
"RTN","RGNETBEV",133,0)
 ..I $D(USR)>1 S X=$O(USR("UID",X))
"RTN","RGNETBEV",134,0)
 ..E  D NXTUID^RGNETBUT(.X,-1,.AID)
"RTN","RGNETBEV",135,0)
 ..S:X C=C+$$QUEUE(.TYPE,.STUB,X)
"RTN","RGNETBEV",136,0)
 .D LOG(TYPE,.STUB)
"RTN","RGNETBEV",137,0)
 .D FPRTCOL(TYPE,.STUB)
"RTN","RGNETBEV",138,0)
 Q:$Q C
"RTN","RGNETBEV",139,0)
 Q
"RTN","RGNETBEV",140,0)
 ; Fire Associated Event Protocol
"RTN","RGNETBEV",141,0)
FPRTCOL(TYPE,STUB) ;
"RTN","RGNETBEV",142,0)
 N EVT,X
"RTN","RGNETBEV",143,0)
 S EVT=$$EVENTIEN(TYPE)
"RTN","RGNETBEV",144,0)
 Q:'EVT
"RTN","RGNETBEV",145,0)
 S X=$P($G(^RGNET(996.54,+EVT,0)),U,7)_";ORD(101,"
"RTN","RGNETBEV",146,0)
 Q:'X
"RTN","RGNETBEV",147,0)
 D EN^XQOR
"RTN","RGNETBEV",148,0)
 Q
"RTN","RGNETBEV",149,0)
 ; Subscribe to / unsubscribe from a named event
"RTN","RGNETBEV",150,0)
 ; Returns new subscription state
"RTN","RGNETBEV",151,0)
SUBSCR(TYPE,SUBSCR) ;EP
"RTN","RGNETBEV",152,0)
 I '$L(TYPE) Q:$Q 0 Q
"RTN","RGNETBEV",153,0)
 N CURRNT
"RTN","RGNETBEV",154,0)
 S CURRNT=''$D(^XTMP("RGNETB",RGNETB("UID"),"S",TYPE)),SUBSCR=''$G(SUBSCR)
"RTN","RGNETBEV",155,0)
 I CURRNT'=SUBSCR D
"RTN","RGNETBEV",156,0)
 .I SUBSCR D  Q:'SUBSCR
"RTN","RGNETBEV",157,0)
 ..I $$KEYCHECK(TYPE,21) S SUBSCR=0
"RTN","RGNETBEV",158,0)
 ..E  S ^XTMP("RGNETB",RGNETB("UID"),"S",TYPE)=""
"RTN","RGNETBEV",159,0)
 .E  D
"RTN","RGNETBEV",160,0)
 ..K ^XTMP("RGNETB",RGNETB("UID"),"S",TYPE)
"RTN","RGNETBEV",161,0)
 ..D CLRVAR^RGNETBUT("EVENT."_TYPE)
"RTN","RGNETBEV",162,0)
 .D BRDCAST($S(SUBSCR:"",1:"UN")_"SUBSCRIBE."_TYPE,$$SESSION^RGNETBUT)
"RTN","RGNETBEV",163,0)
 Q:$Q SUBSCR
"RTN","RGNETBEV",164,0)
 Q
"RTN","RGNETBEV",165,0)
 ; Unsubscribe from all events (done at logout)
"RTN","RGNETBEV",166,0)
UNSUBALL ;EP
"RTN","RGNETBEV",167,0)
 N TYPE
"RTN","RGNETBEV",168,0)
 S TYPE=""
"RTN","RGNETBEV",169,0)
 F  S TYPE=$O(^XTMP("RGNETB",RGNETB("UID"),"S",TYPE)) Q:'$L(TYPE)  D
"RTN","RGNETBEV",170,0)
 .D SUBSCR(TYPE,0)
"RTN","RGNETBEV",171,0)
 Q
"RTN","RGNETBEV",172,0)
 ; Returns true if session is a subscriber
"RTN","RGNETBEV",173,0)
ISSUBSCR(UID,TYPE) ;EP
"RTN","RGNETBEV",174,0)
 Q $S('$$ISACTIVE^RGNETBUT(UID):0,1:$$ISSUBX(TYPE))
"RTN","RGNETBEV",175,0)
ISSUBX(TYPE) ;
"RTN","RGNETBEV",176,0)
 Q $S('$L(TYPE):0,$D(^XTMP("RGNETB",UID,"S",TYPE)):1,1:$$ISSUBX($P(TYPE,".",1,$L(TYPE,".")-1)))
"RTN","RGNETBEV",177,0)
 ; Returns list of subscribers to a given event type
"RTN","RGNETBEV",178,0)
GETSUBSC(DATA,TYPE) ;EP
"RTN","RGNETBEV",179,0)
 N Z
"RTN","RGNETBEV",180,0)
 D GETSESSN^RGNETBRP(.DATA)
"RTN","RGNETBEV",181,0)
 F Z=0:0 S Z=$O(@DATA@(Z)) Q:'Z  K:'$$ISSUBSCR(+@DATA@(Z),TYPE) @DATA@(Z)
"RTN","RGNETBEV",182,0)
 Q
"RTN","RGNETBEV",183,0)
 ; Returns number of days to retain log entries for an event type.
"RTN","RGNETBEV",184,0)
ISLOGGED(TYPE) ;EP
"RTN","RGNETBEV",185,0)
 N X,Y
"RTN","RGNETBEV",186,0)
 S TYPE=$$EVENTIEN(TYPE)
"RTN","RGNETBEV",187,0)
 S:TYPE X=^RGNET(996.54,TYPE,0),Y=$P(X,U,4),X=$P(X,U)
"RTN","RGNETBEV",188,0)
 Q $S('TYPE:0,'$L(Y):$$ISLOGGED($P(X,".",$L(X,".")-1)),1:Y)
"RTN","RGNETBEV",189,0)
 ; Log an event
"RTN","RGNETBEV",190,0)
LOG(TYPE,STUB) ;EP
"RTN","RGNETBEV",191,0)
 N IEN,FDA,ERR,STB,X
"RTN","RGNETBEV",192,0)
 S IEN=$$ISACTIVE^RGNETBLG
"RTN","RGNETBEV",193,0)
 I IEN D
"RTN","RGNETBEV",194,0)
 .S X=$$LOG^RGNETBLG(IEN,2,TYPE)
"RTN","RGNETBEV",195,0)
 .D:X ADD^RGNETBLG(IEN,X,"STUB")
"RTN","RGNETBEV",196,0)
 Q:'$$ISLOGGED(TYPE)
"RTN","RGNETBEV",197,0)
 S FDA=$NA(FDA(996.55,"+1,")),STB="STUB",X=0
"RTN","RGNETBEV",198,0)
 F  D  Q:'$L(STB)
"RTN","RGNETBEV",199,0)
 .S:$D(@STB)#2 X=X+1,STB(X)=@STB
"RTN","RGNETBEV",200,0)
 .S STB=$Q(@STB)
"RTN","RGNETBEV",201,0)
 S @FDA@(.01)=$$NOW^XLFDT
"RTN","RGNETBEV",202,0)
 S @FDA@(1)=TYPE
"RTN","RGNETBEV",203,0)
 S @FDA@(2)=DUZ
"RTN","RGNETBEV",204,0)
 S @FDA@(3)=$$GETUID^RGNETBUT
"RTN","RGNETBEV",205,0)
 S:X @FDA@(10)="STB"
"RTN","RGNETBEV",206,0)
 D UPDATE^DIE("U","FDA",,"ERR")
"RTN","RGNETBEV",207,0)
 Q
"RTN","RGNETBEV",208,0)
 ; Purge event log.  Specify at least one of:
"RTN","RGNETBEV",209,0)
 ;   DATE = Date before which entries will be purged.
"RTN","RGNETBEV",210,0)
 ;   TYPE = Event type to be purged.
"RTN","RGNETBEV",211,0)
 ;   FLAG = If set, purges child events as well.
"RTN","RGNETBEV",212,0)
PURGELOG(DATE,TYPE,FLAG) ;EP
"RTN","RGNETBEV",213,0)
 N IEN,CNT
"RTN","RGNETBEV",214,0)
 S CNT=0,TYPE=$G(TYPE),FLAG=$S($G(FLAG):12,1:1)
"RTN","RGNETBEV",215,0)
 S:TYPE=+TYPE TYPE=$$EVENTNAM(TYPE)
"RTN","RGNETBEV",216,0)
 I $G(DATE) D
"RTN","RGNETBEV",217,0)
 .F  S DATE=$O(^RGNET(996.55,"B",DATE),-1),IEN=0 Q:'DATE  D
"RTN","RGNETBEV",218,0)
 ..F  S IEN=$O(^RGNET(996.55,"B",DATE,IEN)) Q:'IEN  D
"RTN","RGNETBEV",219,0)
 ...I $L(TYPE),FLAG'[$$RELATES(TYPE,$P(^RGNET(996.55,IEN,0),U,2)) Q
"RTN","RGNETBEV",220,0)
 ...S CNT=CNT+$$DELLOG(IEN)
"RTN","RGNETBEV",221,0)
 E  D
"RTN","RGNETBEV",222,0)
 .N TYP
"RTN","RGNETBEV",223,0)
 .S IEN=0,TYP=TYPE
"RTN","RGNETBEV",224,0)
 .F  Q:'$L(TYPE)  D
"RTN","RGNETBEV",225,0)
 ..F  S IEN=$O(^RGNET(996.55,"C",TYPE,IEN)) Q:'IEN  S CNT=CNT+$$DELLOG(IEN)
"RTN","RGNETBEV",226,0)
 ..S TYPE=$O(^RGNET(996.55,"C",TYPE))
"RTN","RGNETBEV",227,0)
 ..S:FLAG'[$$RELATES(TYP,TYPE) TYPE=""
"RTN","RGNETBEV",228,0)
 Q:$Q CNT
"RTN","RGNETBEV",229,0)
 Q
"RTN","RGNETBEV",230,0)
 ; Delete log entry corresponding to IEN
"RTN","RGNETBEV",231,0)
DELLOG(IEN) ;EP
"RTN","RGNETBEV",232,0)
 N FDA,ERR
"RTN","RGNETBEV",233,0)
 S FDA(996.55,IEN_",",.01)="@"
"RTN","RGNETBEV",234,0)
 D FILE^DIE(,"FDA","ERR")
"RTN","RGNETBEV",235,0)
 Q:$Q '$D(ERR)
"RTN","RGNETBEV",236,0)
 Q
"RTN","RGNETBEV",237,0)
 ; Task purge in background
"RTN","RGNETBEV",238,0)
TASKPRG ;EP
"RTN","RGNETBEV",239,0)
 N ZTSK
"RTN","RGNETBEV",240,0)
 S ZTSK=$$QUEUE^RGUTTSK("DOPURGE^RGNETBEV(1)","Purge RG EVENT LOG")
"RTN","RGNETBEV",241,0)
 I ZTSK>0 W !,"RG EVENT LOG purge submitted as task #",ZTSK,!!
"RTN","RGNETBEV",242,0)
 E  W !,"Error submitting RG EVENT LOG purge.",!!
"RTN","RGNETBEV",243,0)
 Q
"RTN","RGNETBEV",244,0)
 ; Purges event log according to retention settings
"RTN","RGNETBEV",245,0)
DOPURGE(SILENT) ;EP
"RTN","RGNETBEV",246,0)
 N IEN,TPNM,TPEN,DATE,CNT,TOT
"RTN","RGNETBEV",247,0)
 S TPNM="",SILENT=+$G(SILENT),TOT=0
"RTN","RGNETBEV",248,0)
 F  S TPNM=$O(^RGNET(996.55,"C",TPNM)) Q:'$L(TPNM)  D
"RTN","RGNETBEV",249,0)
 .S TPEN=$$EVENTIEN(TPNM),DATE=+$P($G(^RGNET(996.54,TPEN,0)),U,5)
"RTN","RGNETBEV",250,0)
 .S DATE=$$FMADD^XLFDT(DT,$S(DATE:1-DATE,1:-13))
"RTN","RGNETBEV",251,0)
 .S CNT=$$PURGELOG(DATE,TPNM),TOT=TOT+CNT
"RTN","RGNETBEV",252,0)
 .I CNT,'SILENT W $$SNGPLR^RGU(CNT,"event")," purged for ",TPNM,!
"RTN","RGNETBEV",253,0)
 W:'SILENT !,"Total events purged: ",TOT,!!
"RTN","RGNETBEV",254,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RGNETBEV",255,0)
 Q
"RTN","RGNETBEV",256,0)
 ; Returns the relationship between event types
"RTN","RGNETBEV",257,0)
 ;   0 = none
"RTN","RGNETBEV",258,0)
 ;   1 = same
"RTN","RGNETBEV",259,0)
 ;   2 = A is parent of B
"RTN","RGNETBEV",260,0)
 ;   3 = B is parent of A
"RTN","RGNETBEV",261,0)
RELATES(EVA,EVB) ;EP
"RTN","RGNETBEV",262,0)
 N SWP,X
"RTN","RGNETBEV",263,0)
 S:EVA=+EVA EVA=$$EVENTNAM(EVA)
"RTN","RGNETBEV",264,0)
 S:EVB=+EVB EVB=$$EVENTNAM(EVB)
"RTN","RGNETBEV",265,0)
 S:$L(EVA)>$L(EVB) SWP=EVA,EVA=EVB,EVB=SWP
"RTN","RGNETBEV",266,0)
 Q:EVA=EVB 1
"RTN","RGNETBEV",267,0)
 F  D  Q:'$L(EVB)!(EVA=EVB)
"RTN","RGNETBEV",268,0)
 .S EVB=$P(EVB,".",1,$L(EVB,".")-1)
"RTN","RGNETBEV",269,0)
 Q $S(EVA'=EVB:0,$D(SWP):3,1:2)
"RTN","RGNETBLG")
0^4^B10138528
"RTN","RGNETBLG",1,0)
RGNETBLG ;RI/CBMI/DKM - NETSERV RPC Broker Activity Log Support ;03-Apr-2015 09:47;DKM
"RTN","RGNETBLG",2,0)
 ;;1.0;NETWORK SERVICES;;Jan 3, 2008;Build 45
"RTN","RGNETBLG",3,0)
 ;=================================================================
"RTN","RGNETBLG",4,0)
 ; Open a log entry.  The return value is the IEN of the new entry.
"RTN","RGNETBLG",5,0)
 ;   UID  = Unique session id
"RTN","RGNETBLG",6,0)
 ;   USER = User IEN
"RTN","RGNETBLG",7,0)
 ;   WID  = Workstation id
"RTN","RGNETBLG",8,0)
OPEN(UID,USER,WID) ;EP
"RTN","RGNETBLG",9,0)
 N IEN,NOW,X
"RTN","RGNETBLG",10,0)
 S NOW=$$NOW^XLFDT
"RTN","RGNETBLG",11,0)
 S:$G(WID)="" WID="UNKNOWN"
"RTN","RGNETBLG",12,0)
 L +^RGNET(996.56,0):2
"RTN","RGNETBLG",13,0)
 S X=1+$P(^RGNET(996.56,0),U,3),IEN=$O(^($C(1)),-1)+1,$P(^(0),U,3,4)=X_U_IEN,^(IEN,0)=UID_U_USER_U_WID_U_NOW_U_U_DUZ(2)
"RTN","RGNETBLG",14,0)
 L -^RGNET(996.56,0)
"RTN","RGNETBLG",15,0)
 S ^RGNET(996.56,"B",UID,IEN)=""
"RTN","RGNETBLG",16,0)
 S ^RGNET(996.56,"BUSER",USER,IEN)=""
"RTN","RGNETBLG",17,0)
 S ^RGNET(996.56,"BWID",WID,IEN)=""
"RTN","RGNETBLG",18,0)
 S ^RGNET(996.56,"BLOGIN",NOW,IEN)=""
"RTN","RGNETBLG",19,0)
 S ^RGNET(996.56,"BDIV",DUZ(2),IEN)=""
"RTN","RGNETBLG",20,0)
 Q IEN
"RTN","RGNETBLG",21,0)
 ; Close a log entry.
"RTN","RGNETBLG",22,0)
 ;  IEN = IEN of the entry.
"RTN","RGNETBLG",23,0)
CLOSE(IEN) ;EP
"RTN","RGNETBLG",24,0)
 N NOW
"RTN","RGNETBLG",25,0)
 S NOW=$$NOW^XLFDT
"RTN","RGNETBLG",26,0)
 S:$D(^RGNET(996.56,+IEN,0)) $P(^(0),U,5)=NOW,^RGNET(996.56,"BLOGOUT",NOW,IEN)=""
"RTN","RGNETBLG",27,0)
 Q
"RTN","RGNETBLG",28,0)
 ; Log an activity
"RTN","RGNETBLG",29,0)
 ;  IEN  = IEN of log entry
"RTN","RGNETBLG",30,0)
 ;  TYPE = Type of log entry (1=RPC, 2=Event)
"RTN","RGNETBLG",31,0)
 ;  NAME = Text name associated with activity
"RTN","RGNETBLG",32,0)
 ;  Returns subfile IEN
"RTN","RGNETBLG",33,0)
LOG(IEN,TYPE,NAME) ;EP
"RTN","RGNETBLG",34,0)
 N SUB,NOW
"RTN","RGNETBLG",35,0)
 Q:'$D(^RGNET(996.56,IEN)) 0
"RTN","RGNETBLG",36,0)
 S NOW=$$NOW^XLFDT
"RTN","RGNETBLG",37,0)
 S SUB=$O(^RGNET(996.56,IEN,10,$C(1)),-1)+1,^(0)="^996.561D^"_SUB_U_SUB,^(SUB,0)=NOW_U_TYPE_U_NAME
"RTN","RGNETBLG",38,0)
 Q SUB
"RTN","RGNETBLG",39,0)
 ; Add an entry to the specified activity
"RTN","RGNETBLG",40,0)
 ;  IEN = IEN of log entry
"RTN","RGNETBLG",41,0)
 ;  SUB = IEN of subfile entry
"RTN","RGNETBLG",42,0)
 ;  ARY = Array or global root
"RTN","RGNETBLG",43,0)
 ;  INC = Include variable name with output (optional)
"RTN","RGNETBLG",44,0)
ADD(IEN,SUB,ARY,INC) ;EP
"RTN","RGNETBLG",45,0)
 N ROOT,WP,A,L,P,X,Y,Z
"RTN","RGNETBLG",46,0)
 S ROOT=$NA(^RGNET(996.56,IEN,10,SUB,10))
"RTN","RGNETBLG",47,0)
 S WP=$O(@ROOT@($C(1)),-1),WP(0)=WP,INC=+$G(INC),(A,ARY)=$NA(@ARY),L=$QL(ARY)
"RTN","RGNETBLG",48,0)
 F  D:$D(@A)#2  S A=$Q(@A) Q:'$L(A)  Q:$NA(@A,L)'=ARY
"RTN","RGNETBLG",49,0)
 .S X=@A,P=$S(INC:A_" = ",1:"")
"RTN","RGNETBLG",50,0)
 .F  Q:'$L(X)  D
"RTN","RGNETBLG",51,0)
 ..S Y=$F(X,$C(13))
"RTN","RGNETBLG",52,0)
 ..S:'Y!(Y>200) Y=200
"RTN","RGNETBLG",53,0)
 ..S Z=$TR($E(X,1,Y-1),$C(13,10)),X=$E(X,Y,999999)
"RTN","RGNETBLG",54,0)
 ..S WP=WP+1,@ROOT@(WP,0)=P_Z,P=$S(INC:">>> ",1:"")
"RTN","RGNETBLG",55,0)
 S:WP'=WP(0) @ROOT@(0)="^^"_WP_U_WP_U_$$NOW^XLFDT
"RTN","RGNETBLG",56,0)
 Q
"RTN","RGNETBLG",57,0)
 ; Delete a log entry
"RTN","RGNETBLG",58,0)
DELETE(DA) ;
"RTN","RGNETBLG",59,0)
 Q:'$D(^RGNET(996.56,DA))
"RTN","RGNETBLG",60,0)
 N DIK
"RTN","RGNETBLG",61,0)
 S DIK="^RGNET(996.56,"
"RTN","RGNETBLG",62,0)
 D ^DIK
"RTN","RGNETBLG",63,0)
 Q
"RTN","RGNETBLG",64,0)
 ; Task purge in background
"RTN","RGNETBLG",65,0)
TASKPRG N ZTSK
"RTN","RGNETBLG",66,0)
 S ZTSK=$$QUEUE^RGUTTSK("DOPURGE^RGNETBLG","Purge RG ACTIVITY LOG")
"RTN","RGNETBLG",67,0)
 I ZTSK>0 W !,"RG ACTIVITY LOG purge submitted as task #",ZTSK,!!
"RTN","RGNETBLG",68,0)
 E  W !,"Error submitting RG ACTIVITY LOG purge.",!!
"RTN","RGNETBLG",69,0)
 Q
"RTN","RGNETBLG",70,0)
 ; Purge log entries according to retention criteria
"RTN","RGNETBLG",71,0)
DOPURGE N DAYS,LP,IEN
"RTN","RGNETBLG",72,0)
 S DAYS=$$GET^XPAR("ALL","RGNETB ACTIVITY RETENTION")
"RTN","RGNETBLG",73,0)
 Q:'DAYS
"RTN","RGNETBLG",74,0)
 S LP=$$FMADD^XLFDT(DT,-DAYS)
"RTN","RGNETBLG",75,0)
 F  S LP=$O(^RGNET(996.56,"BLOGIN",LP),-1) Q:'LP  D
"RTN","RGNETBLG",76,0)
 .S IEN=0
"RTN","RGNETBLG",77,0)
 .F  S IEN=$O(^RGNET(996.56,"BLOGIN",LP,IEN)) Q:'IEN  D
"RTN","RGNETBLG",78,0)
 ..D DELETE(IEN)
"RTN","RGNETBLG",79,0)
 Q
"RTN","RGNETBLG",80,0)
 ; Returns true if activity logging is active
"RTN","RGNETBLG",81,0)
 ; Creates a log entry if one does not already exist
"RTN","RGNETBLG",82,0)
ISACTIVE() ;
"RTN","RGNETBLG",83,0)
 N RTN,DUZ2
"RTN","RGNETBLG",84,0)
 Q:'$D(RGNETB("UID")) 0
"RTN","RGNETBLG",85,0)
 Q:'RGNETB("UID") 0
"RTN","RGNETBLG",86,0)
 S DUZ2=$$GETVAR^RGNETBUT("DUZ2")
"RTN","RGNETBLG",87,0)
 S RTN=$$GETVAR^RGNETBUT("ALOG"_$S(DUZ2:":"_DUZ2,1:""))
"RTN","RGNETBLG",88,0)
 I RTN="" D
"RTN","RGNETBLG",89,0)
 .S RTN=+$$GET^XPAR("ALL","RGNETB ACTIVITY LOGGING","`"_$$GETVAR^RGNETBUT("AID0"))
"RTN","RGNETBLG",90,0)
 .S:RTN RTN=$$OPEN(RGNETB("UID"),DUZ,$$GETVAR^RGNETBUT("WID"))
"RTN","RGNETBLG",91,0)
 .D SETVAR^RGNETBUT("ALOG"_$S(DUZ2:":"_DUZ2,1:""),RTN)
"RTN","RGNETBLG",92,0)
 Q RTN
"RTN","RGNETBRK")
0^5^B5805650
"RTN","RGNETBRK",1,0)
RGNETBRK ;RI/CBMI/DKM - NETSERV RPC Broker ;03-Apr-2015 18:26;DKM
"RTN","RGNETBRK",2,0)
 ;;1.0;NETWORK SERVICES;;01-Apr-2015;Build 45
"RTN","RGNETBRK",3,0)
 ;=================================================================
"RTN","RGNETBRK",4,0)
 ; Handler for broker I/O
"RTN","RGNETBRK",5,0)
NETSERV(RGNETB) ;
"RTN","RGNETBRK",6,0)
 S:$$DOACTION($S($D(RGNETB):"DPQRSU",1:"C")) RGRETRY=0
"RTN","RGNETBRK",7,0)
 Q
"RTN","RGNETBRK",8,0)
 ; Read action and params
"RTN","RGNETBRK",9,0)
 ;  VAC = List of valid action codes
"RTN","RGNETBRK",10,0)
 ; Returns true if valid inputs
"RTN","RGNETBRK",11,0)
DOACTION(VAC) ;
"RTN","RGNETBRK",12,0)
 N NM,SB,RT,VL,PR,RG,ACT,SEQ,ARG,RGERR,RGDATA,X
"RTN","RGNETBRK",13,0)
 S RGERR(0)=0
"RTN","RGNETBRK",14,0)
 S X=$$TCPREAD^RGNETTCP(8,10)
"RTN","RGNETBRK",15,0)
 Q:$E(X,1,5)'="{RGN}" 0
"RTN","RGNETBRK",16,0)
 S ARG=0,RGNETB("EOD")=$E(X,6),SEQ=$E(X,7),ACT=$E(X,8)
"RTN","RGNETBRK",17,0)
 F  S NM=$$TCPREADL Q:'$L(NM)  S PR=NM=+NM,RT=$S(PR:"P"_NM,1:"RGNETB("""_NM_"""") N:PR&'$D(ARG(NM)) @RT D
"RTN","RGNETBRK",18,0)
 .S:PR ARG=$S(NM>ARG:NM,1:ARG),ARG(NM)=""
"RTN","RGNETBRK",19,0)
 .S SB=$$TCPREADL,VL=$$TCPREADL
"RTN","RGNETBRK",20,0)
 .I $L(SB) S RT=RT_$S(PR:"(",1:",")_SB_")"
"RTN","RGNETBRK",21,0)
 .E  S:'PR RT=RT_")"
"RTN","RGNETBRK",22,0)
 .S @RT=VL
"RTN","RGNETBRK",23,0)
 D TCPWRITE^RGNETTCP(SEQ)
"RTN","RGNETBRK",24,0)
 I '$$ERRCHK^RGNETBAC(VAC'[ACT,9,ACT) D
"RTN","RGNETBRK",25,0)
 .N $ET,$ES
"RTN","RGNETBRK",26,0)
 .S $ET="D ETRAP2^RGNETBRK"
"RTN","RGNETBRK",27,0)
 .D @("ACT"_ACT_"^RGNETBAC")
"RTN","RGNETBRK",28,0)
 I RGERR(0) D
"RTN","RGNETBRK",29,0)
 .D SNDERR
"RTN","RGNETBRK",30,0)
 E  I $D(RGDATA) D
"RTN","RGNETBRK",31,0)
 .D REPLY(.RGDATA)
"RTN","RGNETBRK",32,0)
 E  D SNDEOD
"RTN","RGNETBRK",33,0)
 Q 1
"RTN","RGNETBRK",34,0)
 ; Read length-prefixed data from input stream
"RTN","RGNETBRK",35,0)
TCPREADL() ;
"RTN","RGNETBRK",36,0)
 N X,L,I,N
"RTN","RGNETBRK",37,0)
 S X=$$TCPREADB^RGNETTCP
"RTN","RGNETBRK",38,0)
 Q:$C(X)=RGNETB("EOD") ""
"RTN","RGNETBRK",39,0)
 S N=X#16,X=$$TCPREAD^RGNETTCP(X\16),L=0
"RTN","RGNETBRK",40,0)
 F I=1:1:$L(X) S L=L*256+$A(X,I)
"RTN","RGNETBRK",41,0)
 Q $$TCPREAD^RGNETTCP(L*16+N)
"RTN","RGNETBRK",42,0)
 ; Write data to socket
"RTN","RGNETBRK",43,0)
TCPWRITE(DATA,EOD) ;
"RTN","RGNETBRK",44,0)
 D TCPWRITE^RGNETTCP($G(DATA)_$$EOD(.EOD))
"RTN","RGNETBRK",45,0)
 Q
"RTN","RGNETBRK",46,0)
 ; Raise an exception
"RTN","RGNETBRK",47,0)
RAISE(MSG,P1,P2) ;
"RTN","RGNETBRK",48,0)
 D GETDLG^RGNETBUT(MSG,.MSG,.P1,.P2)
"RTN","RGNETBRK",49,0)
 S $EC=MSG(1)
"RTN","RGNETBRK",50,0)
 Q
"RTN","RGNETBRK",51,0)
 ; Trapped error, send error info to client
"RTN","RGNETBRK",52,0)
ETRAP2 N ECSAV
"RTN","RGNETBRK",53,0)
 S $ET="D UNWIND^RGNETBRK Q:$Q 0 Q",ECSAV=$$EC^%ZOSV,RGRETRY=RGRETRY+1
"RTN","RGNETBRK",54,0)
 D:RGRETRY=1 ^%ZTER,ERRCHK^RGNETBAC(1,1,ECSAV)
"RTN","RGNETBRK",55,0)
 S $EC=ECSAV
"RTN","RGNETBRK",56,0)
 Q
"RTN","RGNETBRK",57,0)
 ; Send a reply
"RTN","RGNETBRK",58,0)
REPLY(DATA,ACK) ;
"RTN","RGNETBRK",59,0)
 N MORE
"RTN","RGNETBRK",60,0)
 S MORE=$D(DATA)\10
"RTN","RGNETBRK",61,0)
 D TCPWRITE($C(+$G(ACK))_$G(DATA)_$S(MORE:$C(13),1:""),'MORE)
"RTN","RGNETBRK",62,0)
 D:MORE ARYOUT("DATA",1),SNDEOD
"RTN","RGNETBRK",63,0)
 K DATA
"RTN","RGNETBRK",64,0)
 Q
"RTN","RGNETBRK",65,0)
 ; Send error information
"RTN","RGNETBRK",66,0)
SNDERR N X
"RTN","RGNETBRK",67,0)
 D TCPWRITE^RGNETTCP($C(1))
"RTN","RGNETBRK",68,0)
 D ARYOUT("RGERR",1),SNDEOD
"RTN","RGNETBRK",69,0)
 S RGERR(0)=0
"RTN","RGNETBRK",70,0)
 Q
"RTN","RGNETBRK",71,0)
SNDEOD D TCPWRITE(,1)
"RTN","RGNETBRK",72,0)
 Q
"RTN","RGNETBRK",73,0)
 ; Send data from an array.
"RTN","RGNETBRK",74,0)
 ;  ARY = Array to send
"RTN","RGNETBRK",75,0)
 ;  EOL = If true, append line terminator
"RTN","RGNETBRK",76,0)
ARYOUT(ARY,EOL) ;
"RTN","RGNETBRK",77,0)
 D ARYOUT^RGNETTCP(ARY,$S($G(EOL):$C(13),1:""))
"RTN","RGNETBRK",78,0)
 Q
"RTN","RGNETBRK",79,0)
 ; Return control byte
"RTN","RGNETBRK",80,0)
CTL(X) I $D(RGNETB(X)) N Y S Y=RGNETB(X) K RGNETB(X) Q Y
"RTN","RGNETBRK",81,0)
 Q ""
"RTN","RGNETBRK",82,0)
 ; Return EOD byte if X is true
"RTN","RGNETBRK",83,0)
EOD(X) Q $S($G(X):$$CTL("EOD"),1:"")
"RTN","RGNETBRP")
0^6^B62000067
"RTN","RGNETBRP",1,0)
RGNETBRP ;RI/CBMI/DKM - NETSERV RPC Broker Privileged RPCs;03-Apr-2015 09:42;DKM
"RTN","RGNETBRP",2,0)
 ;;1.0;NETWORK SERVICES;;01-Apr-2015;Build 45
"RTN","RGNETBRP",3,0)
 ;=================================================================
"RTN","RGNETBRP",4,0)
 ; RPC: User authentication
"RTN","RGNETBRP",5,0)
 ; AID = Application ID
"RTN","RGNETBRP",6,0)
 ; WID = Workstation ID
"RTN","RGNETBRP",7,0)
 ; SID = NT Security ID
"RTN","RGNETBRP",8,0)
 ; AVC = AV Code
"RTN","RGNETBRP",9,0)
 ; WIP = Workstation IP address
"RTN","RGNETBRP",10,0)
 ; DIV = Login division (optional)
"RTN","RGNETBRP",11,0)
 ; Returns:
"RTN","RGNETBRP",12,0)
 ;  DATA(0)=Status code^Status text
"RTN","RGNETBRP",13,0)
 ;  where Status code is one of:
"RTN","RGNETBRP",14,0)
 ;   0 = success                 (Params=UID^net name^div name^DUZ)
"RTN","RGNETBRP",15,0)
 ;   1 = success, verify expired (Params=same as success)
"RTN","RGNETBRP",16,0)
 ;   2 = logins inhibited        (Params=null)
"RTN","RGNETBRP",17,0)
 ;   3 = locked                  (Params=null)
"RTN","RGNETBRP",18,0)
 ;   4 = authentication failure  (Params=server^volume^UCI^port)
"RTN","RGNETBRP",19,0)
 ;   5 = other error             (Params=null)
"RTN","RGNETBRP",20,0)
 ;  DATA(1)=Params
"RTN","RGNETBRP",21,0)
 ;  DATA(2,n)=Greeting message
"RTN","RGNETBRP",22,0)
AUTH(DATA,AID,WID,SID,AVC,WIP,DIV) ;
"RTN","RGNETBRP",23,0)
 N XOPT,XUT,XUTEXT,XOPT,XUEON,XUEOFF,XUTT,XUDEV,XUSER,XUNOW,X
"RTN","RGNETBRP",24,0)
 K DUZ,DATA,^TMP($J),^UTILITY($J)
"RTN","RGNETBRP",25,0)
 D SET1^XUS(0)
"RTN","RGNETBRP",26,0)
 S (DUZ,XUT)=0,DUZ(0)="",XUDEV=0,DATA(0)=4,DATA(1)=""
"RTN","RGNETBRP",27,0)
 S AID(0)=$$OPTLKP^RGNETBUT(.AID),WID=$$ID(.WID),SID=$G(SID),WIP=$G(WIP)
"RTN","RGNETBRP",28,0)
 I '$L(AID(0)),$$CHK(18,5,.AID) Q
"RTN","RGNETBRP",29,0)
 S X=$$OPTMSG^RGNETBUT(AID(0))
"RTN","RGNETBRP",30,0)
 I $L(X),$$CHK(19,2,X) Q
"RTN","RGNETBRP",31,0)
 I '$L($G(AVC)) S DUZ=+$$AUTOLOG(SID),RGXUT=0
"RTN","RGNETBRP",32,0)
 E  D
"RTN","RGNETBRP",33,0)
 .I $E(AVC,1,2)="~1" S DUZ=$$CHKASH^XUSRB4(AVC)
"RTN","RGNETBRP",34,0)
 .S:'DUZ DUZ=$$CHECKAV^XUS($$DECRYP^XUSRB1(AVC)),RGXUT=$G(RGXUT)+1
"RTN","RGNETBRP",35,0)
 .I 'DUZ,RGXUT>$P(XOPT,U,2),$$CHK(-7,3) Q
"RTN","RGNETBRP",36,0)
 .I 'DUZ,$$CHK(-4,4)
"RTN","RGNETBRP",37,0)
 I DUZ D
"RTN","RGNETBRP",38,0)
 .S DATA(0)=0,XUNOW=$$NOW^XLFDT,X=$$OPTCHK^RGNETBUT(AID)
"RTN","RGNETBRP",39,0)
 .Q:$$CHK(+X,2,$P(X,U,2),$P(X,U,3),$P(X,U,4))
"RTN","RGNETBRP",40,0)
 .Q:$$CHK(-$$INHIBIT^XUSRB,2)
"RTN","RGNETBRP",41,0)
 .I XUT>$P(XOPT,U,2),$$CHK(-7,3) Q
"RTN","RGNETBRP",42,0)
 .D USER^XUS(DUZ)
"RTN","RGNETBRP",43,0)
 .Q:$$CHK(-$$UVALID^XUS(),4)
"RTN","RGNETBRP",44,0)
 .Q:$$CHK(-$$USER^XUS1A,4)
"RTN","RGNETBRP",45,0)
 .F X=0:0 S X=$O(XUTEXT(X)) Q:'X  S DATA(2,X)=$E(XUTEXT(X),2,9999)
"RTN","RGNETBRP",46,0)
 .D DUZ^XUS1A,SAVE^XUS1,LOG^XUS1,ABT^XQ12
"RTN","RGNETBRP",47,0)
 .I $$VCVALID^XUSRB,$$CHK(-12,1)
"RTN","RGNETBRP",48,0)
 .I $G(RGNETB("UID")) D
"RTN","RGNETBRP",49,0)
 ..N UID
"RTN","RGNETBRP",50,0)
 ..S UID=RGNETB("UID"),RGNETB("UID")=0
"RTN","RGNETBRP",51,0)
 ..I '$D(^XTMP("RGNETB",UID)),$$CHK(25,5,UID) Q
"RTN","RGNETBRP",52,0)
 ..I $$SESSION^RGNETBUT(UID,"DUZ")'=DUZ,$$CHK(27,4,UID) Q
"RTN","RGNETBRP",53,0)
 ..D:$$ISACTIVE^RGNETBUT(UID) FORCEEX(RGPORT_":"_$$GETVAR^RGNETBUT("JOB"))
"RTN","RGNETBRP",54,0)
 ..I $$ISACTIVE^RGNETBUT(UID,1,60),$$CHK(26,4,UID) Q
"RTN","RGNETBRP",55,0)
 ..S RGNETB("UID")=UID
"RTN","RGNETBRP",56,0)
 ..D RESVAR^RGNETBUT,SETVAR^RGNETBUT("JOB",$J)
"RTN","RGNETBRP",57,0)
 ..D BRDCAST^RGNETBEV("LOGIN",$$SESSION^RGNETBUT)
"RTN","RGNETBRP",58,0)
 .E  D
"RTN","RGNETBRP",59,0)
 ..S RGNETB("UID")=$$UID^RGNETBUT
"RTN","RGNETBRP",60,0)
 ..D:$G(DIV) DIVSET(,DIV)
"RTN","RGNETBRP",61,0)
 ..D RESET(1)
"RTN","RGNETBRP",62,0)
 .S DATA(1)=RGNETB("UID")_U_$G(^XMB("NETNAME"))_U_$$GET1^DIQ(4,DUZ(2),".01")_U_DUZ
"RTN","RGNETBRP",63,0)
 .S:AID(0) ^XUTL("XQ",$J,1)=AID(0)_U_$G(^DIC(19,AID(0),0)),^("T")=1
"RTN","RGNETBRP",64,0)
 .D AUTOSET(SID),STSAVE^RGNETTCP(1)
"RTN","RGNETBRP",65,0)
 I +DATA(0)=4 D
"RTN","RGNETBRP",66,0)
 .S DATA(1)=$P(XUENV,U,3)_U_$P(XUVOL,U)_U_XUCI_U_+RGPORT
"RTN","RGNETBRP",67,0)
 Q
"RTN","RGNETBRP",68,0)
 ; Force exit disconnected broker session
"RTN","RGNETBRP",69,0)
FORCEEX(RGPORT) ;
"RTN","RGNETBRP",70,0)
 S @$$LOCKNODE^RGNETBRK=-1
"RTN","RGNETBRP",71,0)
 Q
"RTN","RGNETBRP",72,0)
 ; Transform ID values
"RTN","RGNETBRP",73,0)
ID(ID) Q $E($TR($G(ID),U,"~"),1,40)
"RTN","RGNETBRP",74,0)
 ; RPC: Change verify code
"RTN","RGNETBRP",75,0)
CVC(DATA,OLD,NEW) ;
"RTN","RGNETBRP",76,0)
 S DATA=$$BRCVC^XUS2($$DECRYP^XUSRB1(OLD),$$DECRYP^XUSRB1(NEW))
"RTN","RGNETBRP",77,0)
 S:'DATA DATA="0^Your verify code has been changed."
"RTN","RGNETBRP",78,0)
 Q
"RTN","RGNETBRP",79,0)
 ; RPC: Get division list
"RTN","RGNETBRP",80,0)
DIVGET(DATA) ;
"RTN","RGNETBRP",81,0)
 N X,P,G
"RTN","RGNETBRP",82,0)
 S X=0,G=$S(DUZ:$NA(^VA(200,DUZ,2)),1:$NA(^DG(40.8,"AD"))),P=0
"RTN","RGNETBRP",83,0)
 F  S X=$O(@G@(X)) Q:'X  S:DUZ P=$P(^(X,0),U,2) D
"RTN","RGNETBRP",84,0)
 .N X0,X99
"RTN","RGNETBRP",85,0)
 .S X0=$G(^DIC(4,X,0)),X99=$G(^(99))
"RTN","RGNETBRP",86,0)
 .S DATA(X)=X_U_$P(X0,U)_U_$P(X99,U)_U_$P(X0,U,5)
"RTN","RGNETBRP",87,0)
 .S:P DATA(0)=X
"RTN","RGNETBRP",88,0)
 S:'$D(DATA(0)) DATA(0)=+$O(DATA(0))
"RTN","RGNETBRP",89,0)
 I 'DATA(0),$G(DUZ(2)) S DATA(0)=DUZ(2),DATA(DUZ(2))=DUZ(2)_U_$$NS^XUAF4(DUZ(2))
"RTN","RGNETBRP",90,0)
 D:DATA(0) DIVSET(,DATA(0))
"RTN","RGNETBRP",91,0)
 Q
"RTN","RGNETBRP",92,0)
 ; RPC: Set division
"RTN","RGNETBRP",93,0)
DIVSET(DATA,DIV) ;
"RTN","RGNETBRP",94,0)
 S DUZ(2)=+DIV,DATA=1
"RTN","RGNETBRP",95,0)
 D SETVAR^RGNETBUT("DUZ2",DUZ(2))
"RTN","RGNETBRP",96,0)
 D SETVAR^RGNETBUT("DUZ(2)",DUZ(2),-1)
"RTN","RGNETBRP",97,0)
 Q
"RTN","RGNETBRP",98,0)
 ; RPC: Get dialog text
"RTN","RGNETBRP",99,0)
DIALOG(DATA,DLG,P1,P2,P3) ;
"RTN","RGNETBRP",100,0)
 D GETDLG^RGNETBUT(DLG,.DATA,.P1,.P2,.P3)
"RTN","RGNETBRP",101,0)
 Q
"RTN","RGNETBRP",102,0)
 ; RPC: Reset session
"RTN","RGNETBRP",103,0)
RESET(LOGIN) ;
"RTN","RGNETBRP",104,0)
 Q:'$G(RGNETB("UID"))
"RTN","RGNETBRP",105,0)
 D STOPALL^RGNETBAS,UNSUBALL^RGNETBEV
"RTN","RGNETBRP",106,0)
 S LOGIN=+$G(LOGIN)
"RTN","RGNETBRP",107,0)
 N DUZ2
"RTN","RGNETBRP",108,0)
 S DUZ2=$$GETVAR^RGNETBUT("DUZ2")
"RTN","RGNETBRP",109,0)
 I 'LOGIN D
"RTN","RGNETBRP",110,0)
 .D CLOSE^RGNETBLG($$GETVAR^RGNETBUT("ALOG"_$S(DUZ2:":"_DUZ2,1:"")))
"RTN","RGNETBRP",111,0)
 .S IO("IP")=$$GETVAR^RGNETBUT("WIP")
"RTN","RGNETBRP",112,0)
 .D BRDCAST^RGNETBEV("LOGOUT",$$SESSION^RGNETBUT)
"RTN","RGNETBRP",113,0)
 .K ^XTMP("RGNETB",RGNETB("UID"))
"RTN","RGNETBRP",114,0)
 .L -^XTMP("RGNETB",RGNETB("UID"),0)
"RTN","RGNETBRP",115,0)
 .D BYE^XUSCLEAN
"RTN","RGNETBRP",116,0)
 E  D
"RTN","RGNETBRP",117,0)
 .N ENV,X,Y,V
"RTN","RGNETBRP",118,0)
 .K ^XTMP("RGNETB",RGNETB("UID"))
"RTN","RGNETBRP",119,0)
 .F ENV=0:1 S X=$P($T(ENVDATA+ENV),";;",2) Q:'$L(X)  D
"RTN","RGNETBRP",120,0)
 ..S V=$P(X,";",2),@("Y="_V)
"RTN","RGNETBRP",121,0)
 ..D SETVAR^RGNETBUT($P(X,";"),Y)
"RTN","RGNETBRP",122,0)
 ..D:$P(X,";",3) SETVAR^RGNETBUT(V,Y,-1)
"RTN","RGNETBRP",123,0)
 .D BRDCAST^RGNETBEV("LOGIN",$$SESSION^RGNETBUT)
"RTN","RGNETBRP",124,0)
 .S IO("IP")=$$GETVAR^RGNETBUT("WIP")
"RTN","RGNETBRP",125,0)
 .I $$ISACTIVE^RGNETBLG
"RTN","RGNETBRP",126,0)
 .D LOG^XUS1                                                           ;creates handle with client agent
"RTN","RGNETBRP",127,0)
 Q
"RTN","RGNETBRP",128,0)
 ; Environment data to save
"RTN","RGNETBRP",129,0)
 ;;Name;Value;Local
"RTN","RGNETBRP",130,0)
ENVDATA ;;DUZ;DUZ
"RTN","RGNETBRP",131,0)
 ;;DUZ0;DUZ(0);1
"RTN","RGNETBRP",132,0)
 ;;DUZ2;DUZ(2);1
"RTN","RGNETBRP",133,0)
 ;;USER;$P($G(^VA(200,DUZ,0)),U)
"RTN","RGNETBRP",134,0)
 ;;RDEV;$$RESDEV^RGNETBUT
"RTN","RGNETBRP",135,0)
 ;;LDT;$H
"RTN","RGNETBRP",136,0)
 ;;JOB;$J
"RTN","RGNETBRP",137,0)
 ;;AID;AID
"RTN","RGNETBRP",138,0)
 ;;AID0;AID(0)
"RTN","RGNETBRP",139,0)
 ;;WID;WID
"RTN","RGNETBRP",140,0)
 ;;WIP;WIP
"RTN","RGNETBRP",141,0)
 ;;UID;RGNETB("UID")
"RTN","RGNETBRP",142,0)
 ;;
"RTN","RGNETBRP",143,0)
 ; Check error code
"RTN","RGNETBRP",144,0)
CHK(ERR,RTN,P1,P2,P3) ;
"RTN","RGNETBRP",145,0)
 I ERR S DATA(0)=RTN_U_$S(ERR<0:$$TXT^XUS3(-ERR),1:$$GETDLG^RGNETBUT(ERR,,.P1,.P2,.P3)) S:RTN>1 DUZ=0
"RTN","RGNETBRP",146,0)
 Q ERR
"RTN","RGNETBRP",147,0)
 ; Attempt autoauthenticate using SID
"RTN","RGNETBRP",148,0)
 ; Returns DUZ if SID has been authenticated, 0 if prohibited from
"RTN","RGNETBRP",149,0)
 ; being authenticated, or null if never been authenticated.
"RTN","RGNETBRP",150,0)
AUTOLOG(SID) ;
"RTN","RGNETBRP",151,0)
 S SID=$S($L($G(SID))<3:"",1:$$DECRYP^XUSRB1(SID))
"RTN","RGNETBRP",152,0)
 Q:$E(SID,1,9)'="S-1-5-21-" 0
"RTN","RGNETBRP",153,0)
 S SID=$E(SID,10,999)
"RTN","RGNETBRP",154,0)
 Q:SID<1000 0
"RTN","RGNETBRP",155,0)
 N X
"RTN","RGNETBRP",156,0)
 S X=$$FIND1^DIC(996.57,"","QX",SID)
"RTN","RGNETBRP",157,0)
 Q $S(X:+$P($G(^RGNET(996.57,X,0)),U,2),1:"")
"RTN","RGNETBRP",158,0)
 ; Cache NT authentication information
"RTN","RGNETBRP",159,0)
AUTOSET(SID) ;
"RTN","RGNETBRP",160,0)
 Q:$$AUTOLOG(.SID)'=""
"RTN","RGNETBRP",161,0)
 N FLD
"RTN","RGNETBRP",162,0)
 S FLD(996.57,"+1,",.01)=SID
"RTN","RGNETBRP",163,0)
 S FLD(996.57,"+1,",1)=DUZ
"RTN","RGNETBRP",164,0)
 S FLD(996.57,"+1,",2)=$$NOW^XLFDT
"RTN","RGNETBRP",165,0)
 D UPDATE^DIE("","FLD")
"RTN","RGNETBRP",166,0)
 Q
"RTN","RGNETBRP",167,0)
 ; RPC: Get list of active RPCs
"RTN","RGNETBRP",168,0)
GETRPCS(DATA) ;
"RTN","RGNETBRP",169,0)
 N X
"RTN","RGNETBRP",170,0)
 D LIST^DIC(8994,,".01","Q",,,,,"I ""03""[$P(^(0),U,6)",,.DATA)
"RTN","RGNETBRP",171,0)
 S X=""
"RTN","RGNETBRP",172,0)
 F  S X=$O(@DATA@(X)) Q:'$L(X)  K:X'="ID" @DATA@(X)
"RTN","RGNETBRP",173,0)
 Q
"RTN","RGNETBRP",174,0)
 ; RPC: Can RPC be executed in current context
"RTN","RGNETBRP",175,0)
CANRUN(DATA,RPC) ;
"RTN","RGNETBRP",176,0)
 S DATA=$$CANRUN^RGNETBAC($$FIND1^DIC(8994,,"QX",RPC),RGNETB("CTX"))
"RTN","RGNETBRP",177,0)
 Q
"RTN","RGNETBRP",178,0)
 ; RPC: Retrieve list of active sessions
"RTN","RGNETBRP",179,0)
GETSESSN(DATA,VAR,AID) ;
"RTN","RGNETBRP",180,0)
 N X,Z,C
"RTN","RGNETBRP",181,0)
 S DATA=$$TMPGBL
"RTN","RGNETBRP",182,0)
 F C=1:1 Q:'$$NXTUID^RGNETBUT(.X,,.AID)  S @DATA@(C)=$$SESSION^RGNETBUT(X,.VAR)
"RTN","RGNETBRP",183,0)
 Q
"RTN","RGNETBRP",184,0)
 ; RPC: Get stored variable(s)
"RTN","RGNETBRP",185,0)
GETVAR(DATA,LIST,NMSP) ;
"RTN","RGNETBRP",186,0)
 N CNT
"RTN","RGNETBRP",187,0)
 S:$L($G(LIST)) LIST(-99)=LIST
"RTN","RGNETBRP",188,0)
 S LIST="",CNT=0
"RTN","RGNETBRP",189,0)
 S:0[$G(NMSP) NMSP="@"
"RTN","RGNETBRP",190,0)
 F  S LIST=$O(LIST(LIST)) Q:'$L(LIST)  D
"RTN","RGNETBRP",191,0)
 .S CNT=CNT+1,DATA(CNT)=LIST(LIST)_"="_$$GETVAR^RGNETBUT(LIST(LIST),,NMSP)
"RTN","RGNETBRP",192,0)
 Q
"RTN","RGNETBRP",193,0)
 ; RPC: Set stored variable(s)
"RTN","RGNETBRP",194,0)
SETVAR(DATA,LIST,NMSP,RESET) ;
"RTN","RGNETBRP",195,0)
 S:$L($G(LIST)) LIST(-99)=LIST
"RTN","RGNETBRP",196,0)
 S LIST="",DATA=0
"RTN","RGNETBRP",197,0)
 S:0[$G(NMSP) NMSP="@"
"RTN","RGNETBRP",198,0)
 D:$G(RESET) CLRVAR^RGNETBUT(NMSP)
"RTN","RGNETBRP",199,0)
 F  S LIST=$O(LIST(LIST)) Q:'$L(LIST)  D
"RTN","RGNETBRP",200,0)
 .S DATA=DATA+1
"RTN","RGNETBRP",201,0)
 .D SETVAR^RGNETBUT($P(LIST(LIST),"="),$P(LIST(LIST),"=",2,9999),NMSP)
"RTN","RGNETBRP",202,0)
 Q
"RTN","RGNETBRP",203,0)
 ; RPC: Get requested session info
"RTN","RGNETBRP",204,0)
 ; TYPE = 0=subscriptions, 1=local vars, 2=session vars, 3=locks, 4=pending async RPCs
"RTN","RGNETBRP",205,0)
 ; UID  = Session ID (defaults to current session)
"RTN","RGNETBRP",206,0)
GETINFO(DATA,TYPE,UID) ;
"RTN","RGNETBRP",207,0)
 S UID=$G(UID,$G(RGNETB("UID")))
"RTN","RGNETBRP",208,0)
 I TYPE=0 D  Q
"RTN","RGNETBRP",209,0)
 .N EV,CN
"RTN","RGNETBRP",210,0)
 .S EV="",CN=0
"RTN","RGNETBRP",211,0)
 .F  S EV=$O(^XTMP("RGNETB",UID,"S",EV)) Q:'$L(EV)  D
"RTN","RGNETBRP",212,0)
 ..S CN=CN+1,@DATA@(CN)=EV
"RTN","RGNETBRP",213,0)
 I TYPE=1 D  Q
"RTN","RGNETBRP",214,0)
 .D CAPTURE^RGUHFS("ZWRITE  N X F X=""$ET"",""$EC"",""$ES"",""$J"",""$ZE"",""$ZT"" W !,X,""="",@X",DATA,99999)
"RTN","RGNETBRP",215,0)
 I TYPE=2 D  Q
"RTN","RGNETBRP",216,0)
 .N NS,VN,VL,CN
"RTN","RGNETBRP",217,0)
 .S NS="",CN=0
"RTN","RGNETBRP",218,0)
 .F  S NS=$O(^XTMP("RGNETB",UID,"V",NS)),VN="" Q:'$L(NS)  D
"RTN","RGNETBRP",219,0)
 ..F  S VN=$O(^XTMP("RGNETB",UID,"V",NS,VN)) Q:'$L(VN)  S VL=$G(^(VN)) D
"RTN","RGNETBRP",220,0)
 ...S CN=CN+1,@DATA@(CN)=$S(NS=0:"<default>",NS=-1:"<mapped>",1:NS)_U_VN_U_VL
"RTN","RGNETBRP",221,0)
 I TYPE=3 D  Q
"RTN","RGNETBRP",222,0)
 .N GBL,CN,VL
"RTN","RGNETBRP",223,0)
 .S GBL="",CN=0
"RTN","RGNETBRP",224,0)
 .F  S GBL=$O(^XTMP("RGNETB",UID,"L",GBL)) Q:'$L(GBL)  S VL=$G(^(GBL)) D
"RTN","RGNETBRP",225,0)
 ..S CN=CN+1,@DATA@(CN)=$TR(GBL,U,"~")_U_VL
"RTN","RGNETBRP",226,0)
 I TYPE=4 D  Q
"RTN","RGNETBRP",227,0)
 .N TSK,CN
"RTN","RGNETBRP",228,0)
 .S (TSK,CN)=0
"RTN","RGNETBRP",229,0)
 .F  S TSK=$O(^XTMP("RGNETB",UID,"T",TSK)) Q:'TSK  D
"RTN","RGNETBRP",230,0)
 ..S CN=CN+1,@DATA@(CN)=TSK_U_$G(^%ZTSK(TSK,.03),"Unknown")
"RTN","RGNETBRP",231,0)
 S @DATA@(1)="Unknown request type: "_TYPE
"RTN","RGNETBRP",232,0)
 Q
"RTN","RGNETBRP",233,0)
 ; Lock/unlock global reference
"RTN","RGNETBRP",234,0)
 ; GBL  = Global reference
"RTN","RGNETBRP",235,0)
 ; OPR  = Operation to perform:
"RTN","RGNETBRP",236,0)
 ;        >=0: Value is timeout for lock operation.  Returns success.
"RTN","RGNETBRP",237,0)
 ;         <0: Returns # of active locks for node.
"RTN","RGNETBRP",238,0)
 ;    missing: Performs unlock operation.  Returns success.
"RTN","RGNETBRP",239,0)
 ; DATA = Returns status according to value of OPR.
"RTN","RGNETBRP",240,0)
LOCK(DATA,GBL,OPR) ;
"RTN","RGNETBRP",241,0)
 N LCK
"RTN","RGNETBRP",242,0)
 S LCK=$D(OPR),OPR=+$G(OPR),GBL=$NA(@GBL)
"RTN","RGNETBRP",243,0)
 I OPR<0 S DATA=$$LOCKCNT(GBL)
"RTN","RGNETBRP",244,0)
 E  I LCK D
"RTN","RGNETBRP",245,0)
 .L +@GBL:OPR
"RTN","RGNETBRP",246,0)
 .S DATA=$T
"RTN","RGNETBRP",247,0)
 .I DATA,$$LOCKCNT(GBL,1)
"RTN","RGNETBRP",248,0)
 E  D
"RTN","RGNETBRP",249,0)
 .S DATA=''$$LOCKCNT(GBL,-1)
"RTN","RGNETBRP",250,0)
 .L:DATA -@GBL
"RTN","RGNETBRP",251,0)
 Q
"RTN","RGNETBRP",252,0)
 ; RPC: Restore locks (after reconnect)
"RTN","RGNETBRP",253,0)
 ; Data returns list of locks that could not be restored.
"RTN","RGNETBRP",254,0)
LOCKRES(DATA) ;
"RTN","RGNETBRP",255,0)
 N GBL,CNT,X
"RTN","RGNETBRP",256,0)
 S GBL="",X=0
"RTN","RGNETBRP",257,0)
 F  S GBL=$O(^XTMP("RGNETB",RGNETB("UID"),"L",GBL)) Q:'$L(GBL)  S CNT=+$G(^(GBL))  D
"RTN","RGNETBRP",258,0)
 .F CNT=CNT:-1:1 L +@GBL:1 E  D  Q
"RTN","RGNETBRP",259,0)
 ..S X=X+1,@DATA@(X)=GBL
"RTN","RGNETBRP",260,0)
 ..K ^XTMP("RGNETB",RGNETB("UID"),"L",GBL)
"RTN","RGNETBRP",261,0)
 Q
"RTN","RGNETBRP",262,0)
 ; Return lock count.  Optionally increment/decrement afterwards.
"RTN","RGNETBRP",263,0)
 ; Note use of naked reference.
"RTN","RGNETBRP",264,0)
LOCKCNT(GBL,INC) ;
"RTN","RGNETBRP",265,0)
 N X,Y
"RTN","RGNETBRP",266,0)
 S X=+$G(^XTMP("RGNETB",RGNETB("UID"),"L",GBL)),Y=X+$G(INC)                  ; Sets naked reference
"RTN","RGNETBRP",267,0)
 I Y>0 S ^(GBL)=Y
"RTN","RGNETBRP",268,0)
 E  K ^(GBL)
"RTN","RGNETBRP",269,0)
 Q X
"RTN","RGNETBRP",270,0)
 ; Get temp global reference
"RTN","RGNETBRP",271,0)
TMPGBL(X) ;
"RTN","RGNETBRP",272,0)
 K ^TMP("RGNETBTMP"_$G(X),$J) Q $NA(^($J))
"RTN","RGNETBUT")
0^7^B38250970
"RTN","RGNETBUT",1,0)
RGNETBUT ;RI/CBMI/DKM - NETSERV RPC Broker Utilities ;01-Apr-2015 14:12;DKM
"RTN","RGNETBUT",2,0)
 ;;1.0;NETWORK SERVICES;;01-Apr-2015;Build 45
"RTN","RGNETBUT",3,0)
 ;=================================================================
"RTN","RGNETBUT",4,0)
 ; Cleanup stray global nodes
"RTN","RGNETBUT",5,0)
CLEANUP ;EP
"RTN","RGNETBUT",6,0)
 N UID
"RTN","RGNETBUT",7,0)
 F  Q:'$$NXTUID(.UID,0)  K ^XTMP("RGNETB",UID)
"RTN","RGNETBUT",8,0)
 Q
"RTN","RGNETBUT",9,0)
 ; Force RPC context tables to be rebuilt for all active sessions
"RTN","RGNETBUT",10,0)
REBLDCTX ;EP
"RTN","RGNETBUT",11,0)
 N UID,CTX
"RTN","RGNETBUT",12,0)
 F  Q:'$$NXTUID(.UID)  D
"RTN","RGNETBUT",13,0)
 .F CTX=0:0 S CTX=$O(^XTMP("RGNETB",UID,"C",CTX)) Q:'CTX  S ^(CTX)=0
"RTN","RGNETBUT",14,0)
 Q
"RTN","RGNETBUT",15,0)
 ; Get globally unique instance ID
"RTN","RGNETBUT",16,0)
UID() N UID,FLG
"RTN","RGNETBUT",17,0)
 L +^XTMP("RGNETB",0):5
"RTN","RGNETBUT",18,0)
 E  Q "-3^Cannot initialize environment"
"RTN","RGNETBUT",19,0)
 S FLG=0
"RTN","RGNETBUT",20,0)
 F UID=$P($G(^XTMP("RGNETB",0)),U,3)+1:1 D  Q:(UID<1)!(FLG=2)
"RTN","RGNETBUT",21,0)
 .I (UID<1)!(UID>999999) D  Q:UID<1
"RTN","RGNETBUT",22,0)
 ..S UID=$S('FLG:1,1:"-4^Lock table is full"),FLG=1
"RTN","RGNETBUT",23,0)
 .S:'$$ISACTIVE(UID,1) FLG=2
"RTN","RGNETBUT",24,0)
 S:UID>0 ^XTMP("RGNETB",0)=(DT+10000)_U_DT_U_UID
"RTN","RGNETBUT",25,0)
 L -^XTMP("RGNETB",0)
"RTN","RGNETBUT",26,0)
 Q UID
"RTN","RGNETBUT",27,0)
 ; Verifies that a session is truly active
"RTN","RGNETBUT",28,0)
 ;   UID = Unique id of session
"RTN","RGNETBUT",29,0)
 ;   LCK = If nonzero, leave lock active (defaults to 0)
"RTN","RGNETBUT",30,0)
 ;   TMO = Optional lock timeout (defaults to 0)
"RTN","RGNETBUT",31,0)
ISACTIVE(UID,LCK,TMO) ;EP
"RTN","RGNETBUT",32,0)
 Q:'$G(UID) 0
"RTN","RGNETBUT",33,0)
 Q:UID=$G(RGNETB("UID")) 1
"RTN","RGNETBUT",34,0)
 L +^XTMP("RGNETB",UID,0):+$G(TMO)
"RTN","RGNETBUT",35,0)
 E  Q 1
"RTN","RGNETBUT",36,0)
 L:'$G(LCK) -^XTMP("RGNETB",UID,0)
"RTN","RGNETBUT",37,0)
 Q 0
"RTN","RGNETBUT",38,0)
 ; Gets the session ID associated with this process
"RTN","RGNETBUT",39,0)
 ; If not in session context, attempt answerback from client
"RTN","RGNETBUT",40,0)
GETUID() ;EP
"RTN","RGNETBUT",41,0)
 I '$D(RGNETB("UID")) D
"RTN","RGNETBUT",42,0)
 .S RGNETB("UID")=""
"RTN","RGNETBUT",43,0)
 .Q:$D(ZTQUEUED)
"RTN","RGNETBUT",44,0)
 .N X,UID,I
"RTN","RGNETBUT",45,0)
 .S I=$I,UID=""
"RTN","RGNETBUT",46,0)
 .U $S($D(IO(0)):IO(0),1:$P)                                           ; Use home device
"RTN","RGNETBUT",47,0)
 .X ^%ZOSF("EOFF")                                                     ; Suppress echo
"RTN","RGNETBUT",48,0)
 .F  R X#1:0 Q:'$T                                                     ; Flush keyboard buffer
"RTN","RGNETBUT",49,0)
 .W $C(5)                                                              ; Send answerback request
"RTN","RGNETBUT",50,0)
 .F  R X:4 Q:'$T&'$L(X)  S UID=UID_X                                   ; Listen for response
"RTN","RGNETBUT",51,0)
 .S UID=$P(UID,"RG#",2)
"RTN","RGNETBUT",52,0)
 .X ^%ZOSF("EON")                                                      ; Restore echo
"RTN","RGNETBUT",53,0)
 .U I                                                                  ; Restore previous device
"RTN","RGNETBUT",54,0)
 .I $$ISACTIVE(UID),$$GETVAR("DUZ",,,UID)=DUZ S RGNETB("UID")=UID
"RTN","RGNETBUT",55,0)
 .E  S RGNETB("UID")=""
"RTN","RGNETBUT",56,0)
 Q:$Q RGNETB("UID")
"RTN","RGNETBUT",57,0)
 Q
"RTN","RGNETBUT",58,0)
 ; Retrieve next session ID from list
"RTN","RGNETBUT",59,0)
 ;   UID passed as last ID processed, returned as next ID or null
"RTN","RGNETBUT",60,0)
 ;   FLT = <0=all; 0=inactive only; >0=active only (default)
"RTN","RGNETBUT",61,0)
 ;   AID = Application ID (optional)
"RTN","RGNETBUT",62,0)
 ;   Return value is true if ID found
"RTN","RGNETBUT",63,0)
NXTUID(UID,FLT,AID) ;EP
"RTN","RGNETBUT",64,0)
 N PFX,FND,ALL,ACT
"RTN","RGNETBUT",65,0)
 S FLT=+$G(FLT,1),FND=0,ALL=FLT<0,ACT=FLT>0,AID=$$OPTLKP(.AID),UID=+$G(UID)
"RTN","RGNETBUT",66,0)
 I $L(AID) F  S UID=$O(^XTMP("RGNETB",UID)) Q:'UID  D  Q:FND
"RTN","RGNETBUT",67,0)
 .I AID,$$GETVAR("AID0",,,UID)'=AID Q
"RTN","RGNETBUT",68,0)
 .I 'ALL,$$ISACTIVE(UID)'=ACT Q
"RTN","RGNETBUT",69,0)
 .S FND=1
"RTN","RGNETBUT",70,0)
 S:'FND UID=""
"RTN","RGNETBUT",71,0)
 Q:$Q FND
"RTN","RGNETBUT",72,0)
 Q
"RTN","RGNETBUT",73,0)
 ; Retrieve a package parameter value
"RTN","RGNETBUT",74,0)
PARAM(PAR,MIN,MAX) ;EP
"RTN","RGNETBUT",75,0)
 S VAL=+$$GET^XPAR("ALL",PAR)
"RTN","RGNETBUT",76,0)
 S:VAL<MIN VAL=MIN
"RTN","RGNETBUT",77,0)
 S:VAL>MAX VAL=MAX
"RTN","RGNETBUT",78,0)
 Q VAL
"RTN","RGNETBUT",79,0)
 ; Return free resource device
"RTN","RGNETBUT",80,0)
RESDEV() ;EP
"RTN","RGNETBUT",81,0)
 N RD,MX,SL,UID,X,C
"RTN","RGNETBUT",82,0)
 S MX=$$PARAM("RGNETB RESOURCE DEVICE COUNT",1,20)
"RTN","RGNETBUT",83,0)
 S SL=$$PARAM("RGNETB RESOURCE DEVICE SLOTS",1,20)
"RTN","RGNETBUT",84,0)
 F  Q:'$$NXTUID(.UID)  D
"RTN","RGNETBUT",85,0)
 .S RD=$$GETVAR("RDEV",,,UID)
"RTN","RGNETBUT",86,0)
 .S:RD RD(RD)=$G(RD(RD))+1
"RTN","RGNETBUT",87,0)
 S RD=1,C=999999
"RTN","RGNETBUT",88,0)
 F X=1:1:MX S:+$G(RD(X))<C RD=X,C=+$G(RD(X))
"RTN","RGNETBUT",89,0)
 S X=$$RES^XUDHSET("RGNETB THREAD RESOURCE #"_RD,,SL,"RG Broker Asynchronous Callbacks")
"RTN","RGNETBUT",90,0)
 Q RD
"RTN","RGNETBUT",91,0)
 ; Set maximum slots for resource devices
"RTN","RGNETBUT",92,0)
SETSLOTS(CNT) ;EP
"RTN","RGNETBUT",93,0)
 N RES,IEN,FDA,X,Y
"RTN","RGNETBUT",94,0)
 Q:CNT<2!(CNT>20)
"RTN","RGNETBUT",95,0)
 D FIND^DIC(3.5,,"@","UP","RGNETB THREAD RESOURCE #",,"B")
"RTN","RGNETBUT",96,0)
 F RES=0:0 S RES=$O(^TMP("DILIST",$J,RES)) Q:'RES  S IEN=+$G(^(RES,0)) D:IEN
"RTN","RGNETBUT",97,0)
 .S FDA(3.5,IEN_",",35)=CNT
"RTN","RGNETBUT",98,0)
 D FILE^DIE("K","FDA")
"RTN","RGNETBUT",99,0)
 K ^TMP("DILIST",$J),^TMP("DIERR",$J)
"RTN","RGNETBUT",100,0)
 Q
"RTN","RGNETBUT",101,0)
 ; Return info for session
"RTN","RGNETBUT",102,0)
SESSION(UID,VAR) ;EP
"RTN","RGNETBUT",103,0)
 N X,Y,Z
"RTN","RGNETBUT",104,0)
 S (X,Y)=""
"RTN","RGNETBUT",105,0)
 S:'$L($G(VAR)) VAR="UID^WID^AID^DUZ^USER^LDT^JOB"
"RTN","RGNETBUT",106,0)
 F Z=1:1:$L(VAR,U) S X=X_Y_$$GETVAR($P(VAR,U,Z),,,.UID),Y=U
"RTN","RGNETBUT",107,0)
 Q X
"RTN","RGNETBUT",108,0)
 ; Show active sessions
"RTN","RGNETBUT",109,0)
 ;   AID = optional application id
"RTN","RGNETBUT",110,0)
 ;   FLT = <0=all; 0=inactive only; >0=active only (default)
"RTN","RGNETBUT",111,0)
SHOWSESS(AID,FLT) ;EP
"RTN","RGNETBUT",112,0)
 N C,X,Z
"RTN","RGNETBUT",113,0)
 F C=0:1 Q:'$$NXTUID(.X,.FLT,.AID)  D
"RTN","RGNETBUT",114,0)
 .W "#",X,?10,$$HTE^XLFDT($$GETVAR("LDT",,,X)),?40,$$GETVAR("WID",,,X),?60,$$GETVAR("USER",,,X),!
"RTN","RGNETBUT",115,0)
 W !,$S('C:"No sessions are",C=1:"One session is",1:C_" sessions are")," ",$S(FLT>0:"active",FLT<0:"present",1:"inactive"),".",!
"RTN","RGNETBUT",116,0)
 Q:$Q C
"RTN","RGNETBUT",117,0)
 Q
"RTN","RGNETBUT",118,0)
 ; Fetch an environment variable
"RTN","RGNETBUT",119,0)
 ;   NAME = Variable name
"RTN","RGNETBUT",120,0)
 ;   DFLT = Optional default value
"RTN","RGNETBUT",121,0)
 ;   NMSP = Optional namespace (defaults to global)
"RTN","RGNETBUT",122,0)
 ;   UID  = Optional session id (default to current)
"RTN","RGNETBUT",123,0)
GETVAR(NAME,DFLT,NMSP,UID) ;EP
"RTN","RGNETBUT",124,0)
 D FMTVAR(.UID,.NMSP,.NAME)
"RTN","RGNETBUT",125,0)
 Q $S('UID:"",1:$G(^XTMP("RGNETB",UID,"V",NMSP,NAME),$G(DFLT)))
"RTN","RGNETBUT",126,0)
 ; Save an environment variable
"RTN","RGNETBUT",127,0)
 ;   NAME = Variable name
"RTN","RGNETBUT",128,0)
 ;   VALUE = Value to be assigned (if not specified, entry is deleted)
"RTN","RGNETBUT",129,0)
 ;   NMSP = Optional namespace (defaults to global)
"RTN","RGNETBUT",130,0)
SETVAR(NAME,VALUE,NMSP,UID) ;EP
"RTN","RGNETBUT",131,0)
 N $ET
"RTN","RGNETBUT",132,0)
 S $ET="S $EC="""" G ERRVAR^RGNETBUT"
"RTN","RGNETBUT",133,0)
 D FMTVAR(.UID,.NMSP,.NAME)
"RTN","RGNETBUT",134,0)
 I 'UID Q:$Q 0 Q
"RTN","RGNETBUT",135,0)
 L +^XTMP("RGNETB",UID,"V",NMSP,NAME):1
"RTN","RGNETBUT",136,0)
 ;E  Q:$Q 0 Q
"RTN","RGNETBUT",137,0)
 I $D(VALUE) S:NMSP=-1 @NAME=VALUE S ^XTMP("RGNETB",UID,"V",NMSP,NAME)=VALUE
"RTN","RGNETBUT",138,0)
 E  K:NMSP=-1 @NAME K ^XTMP("RGNETB",UID,"V",NMSP,NAME)
"RTN","RGNETBUT",139,0)
 L -^XTMP("RGNETB",UID,"V",NMSP,NAME)
"RTN","RGNETBUT",140,0)
 Q:$Q 1
"RTN","RGNETBUT",141,0)
 Q
"RTN","RGNETBUT",142,0)
 ; Clear all variables in a namespace
"RTN","RGNETBUT",143,0)
CLRVAR(NMSP,UID) ;EP
"RTN","RGNETBUT",144,0)
 N NAME,RES
"RTN","RGNETBUT",145,0)
 D FMTVAR(.UID,.NMSP)
"RTN","RGNETBUT",146,0)
 L +^XTMP("RGNETB",UID,"V",NMSP):1
"RTN","RGNETBUT",147,0)
 ;E  Q:$Q 0 Q
"RTN","RGNETBUT",148,0)
 S NAME="",RES=1
"RTN","RGNETBUT",149,0)
 F  S NAME=$O(^XTMP("RGNETB",UID,"V",NMSP,NAME)) Q:'$L(NAME)  S RES=RES&$$SETVAR(NAME,,NMSP,UID)
"RTN","RGNETBUT",150,0)
 L -^XTMP("RGNETB",UID,"V",NMSP)
"RTN","RGNETBUT",151,0)
 Q:$Q RES
"RTN","RGNETBUT",152,0)
 Q
"RTN","RGNETBUT",153,0)
 ; Restore variables from local variable namespace
"RTN","RGNETBUT",154,0)
RESVAR N NAME,UID
"RTN","RGNETBUT",155,0)
 D FMTVAR(.UID)
"RTN","RGNETBUT",156,0)
 S NAME=""
"RTN","RGNETBUT",157,0)
 F  S NAME=$O(^XTMP("RGNETB",UID,"V",-1,NAME)) Q:'$L(NAME)  S @NAME=^(NAME)
"RTN","RGNETBUT",158,0)
 Q
"RTN","RGNETBUT",159,0)
 ; Error handler for var calls
"RTN","RGNETBUT",160,0)
ERRVAR L -^XTMP("RGNETB",UID,"V",NMSP,NAME)
"RTN","RGNETBUT",161,0)
 Q:$Q 0
"RTN","RGNETBUT",162,0)
 Q
"RTN","RGNETBUT",163,0)
 ; Format arguments for var calls
"RTN","RGNETBUT",164,0)
FMTVAR(UID,NMSP,NAME) ;
"RTN","RGNETBUT",165,0)
 S UID=$G(UID,$G(RGNETB("UID")))
"RTN","RGNETBUT",166,0)
 S NMSP=$$UP^XLFSTR($G(NMSP,0))
"RTN","RGNETBUT",167,0)
 S NAME=$$UP^XLFSTR($G(NAME))
"RTN","RGNETBUT",168,0)
 S:NMSP=-1&$L(NAME) NAME=$NA(@NAME)
"RTN","RGNETBUT",169,0)
 Q
"RTN","RGNETBUT",170,0)
 ; Retrieve dialog text
"RTN","RGNETBUT",171,0)
 ;  NUM = Dialog number (relative or absolute)
"RTN","RGNETBUT",172,0)
 ; .DLG = Array to receive text
"RTN","RGNETBUT",173,0)
 ;  Pn  = Optional parameters (up to 3)
"RTN","RGNETBUT",174,0)
GETDLG(NUM,DLG,P1,P2,P3) ;
"RTN","RGNETBUT",175,0)
 N X
"RTN","RGNETBUT",176,0)
 S:NUM<100 NUM=NUM+9965400
"RTN","RGNETBUT",177,0)
 S P1=$G(P1,$G(RGNETB("RPC")))
"RTN","RGNETBUT",178,0)
 S X=$$GETDLG^RGUT(NUM,.DLG,.P1,.P2,.P3)
"RTN","RGNETBUT",179,0)
 Q:$Q X
"RTN","RGNETBUT",180,0)
 Q
"RTN","RGNETBUT",181,0)
 ; Lookup option, returning IEN
"RTN","RGNETBUT",182,0)
OPTLKP(OPT) ;EP
"RTN","RGNETBUT",183,0)
 Q $S('$L($G(OPT)):0,OPT=+OPT:OPT,1:$O(^DIC(19,"B",OPT,0)))
"RTN","RGNETBUT",184,0)
 ; Get/set out-of-order message for option
"RTN","RGNETBUT",185,0)
 ;   MSG = New message (if passed, a set is performed, otherwise a get)
"RTN","RGNETBUT",186,0)
 ;   Returns current message text
"RTN","RGNETBUT",187,0)
OPTMSG(OPT,MSG) ;EP
"RTN","RGNETBUT",188,0)
 S OPT=+$$OPTLKP(.OPT)
"RTN","RGNETBUT",189,0)
 I OPT,$D(^DIC(19,OPT,0)) D                                            ; Sets naked ref
"RTN","RGNETBUT",190,0)
 .I $D(MSG) S $P(^(0),U,3)=MSG
"RTN","RGNETBUT",191,0)
 .E  S MSG=$P(^(0),U,3)
"RTN","RGNETBUT",192,0)
 E  S MSG=""
"RTN","RGNETBUT",193,0)
 Q:$Q MSG
"RTN","RGNETBUT",194,0)
 Q
"RTN","RGNETBUT",195,0)
 ; Check option for valid access
"RTN","RGNETBUT",196,0)
 ;   OPT=Option IEN or name
"RTN","RGNETBUT",197,0)
 ;   TYP=Optional option type to check
"RTN","RGNETBUT",198,0)
 ;   Returns 0 if OK, <err code>^<err param> otherwise
"RTN","RGNETBUT",199,0)
OPTCHK(OPT,TYP) ;EP
"RTN","RGNETBUT",200,0)
 N XQY,X,Y,Z
"RTN","RGNETBUT",201,0)
 S XQY=$S(OPT=+OPT:OPT,1:$$OPTLKP(OPT))
"RTN","RGNETBUT",202,0)
 Q:XQY'>0 "2^"_OPT
"RTN","RGNETBUT",203,0)
 S X=$G(^DIC(19,XQY,0)),Y=$P($G(^(3)),U),Z=$P(X,U,3)
"RTN","RGNETBUT",204,0)
 Q:$L(Z) "19^"_Z
"RTN","RGNETBUT",205,0)
 I $L($G(TYP)),$P(X,U,4)'=TYP Q "20^"_OPT_U_TYP
"RTN","RGNETBUT",206,0)
 I $P(X,U,16),$L(Y),$$KCHK^XUSRB(Y) Q "21^"_OPT_U_Y
"RTN","RGNETBUT",207,0)
 S Y=$P(X,U,6)
"RTN","RGNETBUT",208,0)
 I $L(Y),'$$KCHK^XUSRB(Y) Q "22^"_OPT_U_Y
"RTN","RGNETBUT",209,0)
 S X=$$NOW^XLFDT
"RTN","RGNETBUT",210,0)
 D ENTRY^XQ92
"RTN","RGNETBUT",211,0)
 Q:'X "23^"_OPT
"RTN","RGNETBUT",212,0)
 Q 0
"RTN","RGNETBUT",213,0)
 ; Nightly task to perform various cleanup procedures.
"RTN","RGNETBUT",214,0)
NIGHTLY ;EP
"RTN","RGNETBUT",215,0)
 D CLEANUP
"RTN","RGNETBUT",216,0)
 D DOPURGE^RGNETBEV(1)
"RTN","RGNETBUT",217,0)
 D DOPURGE^RGNETBLG
"RTN","RGNETBUT",218,0)
 Q
"SEC","^DIC",996.5,996.5,0,"AUDIT")
@
"SEC","^DIC",996.5,996.5,0,"DD")
@
"SEC","^DIC",996.5,996.5,0,"DEL")
@
"SEC","^DIC",996.5,996.5,0,"LAYGO")
@
"SEC","^DIC",996.5,996.5,0,"RD")
@
"SEC","^DIC",996.5,996.5,0,"WR")
@
"SEC","^DIC",996.54,996.54,0,"AUDIT")
@
"SEC","^DIC",996.54,996.54,0,"DD")
@
"SEC","^DIC",996.54,996.54,0,"DEL")
@
"SEC","^DIC",996.54,996.54,0,"LAYGO")
@
"SEC","^DIC",996.54,996.54,0,"RD")
@
"SEC","^DIC",996.54,996.54,0,"WR")
@
"SEC","^DIC",996.55,996.55,0,"AUDIT")
@
"SEC","^DIC",996.55,996.55,0,"DD")
@
"SEC","^DIC",996.55,996.55,0,"DEL")
@
"SEC","^DIC",996.55,996.55,0,"LAYGO")
@
"SEC","^DIC",996.55,996.55,0,"RD")
@
"SEC","^DIC",996.55,996.55,0,"WR")
@
"SEC","^DIC",996.56,996.56,0,"AUDIT")
@
"SEC","^DIC",996.56,996.56,0,"DD")
@
"SEC","^DIC",996.56,996.56,0,"DEL")
@
"SEC","^DIC",996.56,996.56,0,"LAYGO")
@
"SEC","^DIC",996.56,996.56,0,"WR")
@
"SEC","^DIC",996.57,996.57,0,"AUDIT")
@
"SEC","^DIC",996.57,996.57,0,"DD")
@
"SEC","^DIC",996.57,996.57,0,"DEL")
@
"SEC","^DIC",996.57,996.57,0,"LAYGO")
@
"SEC","^DIC",996.57,996.57,0,"RD")
@
"SEC","^DIC",996.57,996.57,0,"WR")
@
"VER")
8.0^22.0
"^DD",996.5,996.5,0)
FIELD^^4^6
"^DD",996.5,996.5,0,"DDA")
N
"^DD",996.5,996.5,0,"DT")
3150330
"^DD",996.5,996.5,0,"IX","B",996.5,.01)

"^DD",996.5,996.5,0,"NM","NETSERV TCP LISTENER")

"^DD",996.5,996.5,.01,0)
NAME^RF^^0;1^K:$L(X)>30!(X?.N)!($L(X)<3)!'(X'?1P.E) X
"^DD",996.5,996.5,.01,1,0)
^.1
"^DD",996.5,996.5,.01,1,1,0)
996.5^B
"^DD",996.5,996.5,.01,1,1,1)
S ^RGNET(996.5,"B",$E(X,1,30),DA)=""
"^DD",996.5,996.5,.01,1,1,2)
K ^RGNET(996.5,"B",$E(X,1,30),DA)
"^DD",996.5,996.5,.01,3)
NAME MUST BE 3-30 CHARACTERS, NOT NUMERIC OR STARTING WITH PUNCTUATION
"^DD",996.5,996.5,.01,21,0)
^^1^1^3150330.090909
"^DD",996.5,996.5,.01,21,1,0)
This is the unique name for the primary listener.
"^DD",996.5,996.5,1,0)
PORT^NJ5,0^^0;2^K:+X'=X!(X>32767)!(X<1)!(X?.E1"."1N.N) X
"^DD",996.5,996.5,1,3)
Enter the TCP port number.
"^DD",996.5,996.5,1,21,0)
^^2^2^3150330.090954
"^DD",996.5,996.5,1,21,1,0)
This is the TCP port that the primary listener uses to service connection
"^DD",996.5,996.5,1,21,2,0)
requests.
"^DD",996.5,996.5,1,"DT")
3150329
"^DD",996.5,996.5,2,0)
UCI^F^^0;3^K:$L(X)>10!($L(X)<1) X
"^DD",996.5,996.5,2,3)
Enter the target UCI (none = current).
"^DD",996.5,996.5,2,21,0)
^^2^2^3150330.091148
"^DD",996.5,996.5,2,21,1,0)
This is the UCI where the primary listener should be spawned.  If not specified,
"^DD",996.5,996.5,2,21,2,0)
the primary listener will reside in the same UCI where it was initially spawned.
"^DD",996.5,996.5,2,"DT")
3150329
"^DD",996.5,996.5,3,0)
DISABLE^S^0:NO;1:YES;^0;4^Q
"^DD",996.5,996.5,3,3)
Enter YES to disable the listener.
"^DD",996.5,996.5,3,21,0)
^^2^2^3150330.091254
"^DD",996.5,996.5,3,21,1,0)
If set to YES, attempts to spawn a primary or secondary listener will fail.
"^DD",996.5,996.5,3,21,2,0)
This has no impact on currently running listeners.
"^DD",996.5,996.5,3,"DT")
3150330
"^DD",996.5,996.5,4,0)
MAXIMUM^NJ6,0^^0;5^K:+X'=X!(X>999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",996.5,996.5,4,3)
Enter the maximum number of secondary listeners.
"^DD",996.5,996.5,4,21,0)
^.001^3^3^3150330^
"^DD",996.5,996.5,4,21,1,0)
This sets the maximum allowable number of secondary listeners that may be 
"^DD",996.5,996.5,4,21,2,0)
spawned by the primary listener.  When this number is exceeded, additional
"^DD",996.5,996.5,4,21,3,0)
connection requests will be denied.
"^DD",996.5,996.5,4,"DT")
3150330
"^DD",996.5,996.5,10,0)
HANDLER^FX^^10;E1,250^K:X'?.8AN1"^"1.8AN X
"^DD",996.5,996.5,10,3)
Enter entry point for I/O handler as TAG^ROUTINE.
"^DD",996.5,996.5,10,21,0)
^^7^7^3150330.091725
"^DD",996.5,996.5,10,21,1,0)
This is the entry point (as TAG^ROUTINE) that will service an established
"^DD",996.5,996.5,10,21,2,0)
connection.  The handler should relinquish control back to the caller after
"^DD",996.5,996.5,10,21,3,0)
completing each request/response cycle to allow the caller to determine if
"^DD",996.5,996.5,10,21,4,0)
the connection should be terminated.  The handler may request termination
"^DD",996.5,996.5,10,21,5,0)
by setting RGQUIT to a nonzero value.  Otherwise, unless an external request
"^DD",996.5,996.5,10,21,6,0)
to terminate the connection has been received, the handler will be called
"^DD",996.5,996.5,10,21,7,0)
again.
"^DD",996.5,996.5,10,"DT")
3150330
"^DD",996.54,996.54,0)
FIELD^^7^14
"^DD",996.54,996.54,0,"DT")
3091007
"^DD",996.54,996.54,0,"IX","B",996.54,.01)

"^DD",996.54,996.54,0,"NM","NETSERV BROKER EVENT TYPE")

"^DD",996.54,996.54,0,"PT",996.55,1)

"^DD",996.54,996.54,0,"PT",999.995,.01)

"^DD",996.54,996.54,0,"PT",19930.995,.01)

"^DD",996.54,996.54,0,"VRPK")
CAREWEB ENHANCEMENTS
"^DD",996.54,996.54,.01,0)
NAME^RF^^0;1^K:$L(X)>100!($L(X)<3)!'(X'?1P.E) X
"^DD",996.54,996.54,.01,1,0)
^.1
"^DD",996.54,996.54,.01,1,1,0)
996.54^B
"^DD",996.54,996.54,.01,1,1,1)
S ^RGNET(996.54,"B",$E(X,1,30),DA)=""
"^DD",996.54,996.54,.01,1,1,2)
K ^RGNET(996.54,"B",$E(X,1,30),DA)
"^DD",996.54,996.54,.01,3)
Answer must be 3-100 characters in length.
"^DD",996.54,996.54,.01,"DT")
3030611
"^DD",996.54,996.54,1,0)
MONITOR^K^^1;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",996.54,996.54,1,3)
M code to invoke monitor for this event type
"^DD",996.54,996.54,1,9)
@
"^DD",996.54,996.54,1,"DT")
3021021
"^DD",996.54,996.54,2,0)
DISABLE^S^0:NO;1:YES;^0;2^Q
"^DD",996.54,996.54,2,3)
Enter YES to disable this event type.
"^DD",996.54,996.54,2,21,0)
^.001^3^3^3030810^
"^DD",996.54,996.54,2,21,1,0)
If set to YES, this event type is disabled.  Once disabled, any attempt to 
"^DD",996.54,996.54,2,21,2,0)
enqueue the event will be ignored.  Disabling an event does not affect events
"^DD",996.54,996.54,2,21,3,0)
already in the queue. 
"^DD",996.54,996.54,2,"DT")
3030810
"^DD",996.54,996.54,3,0)
INTERVAL^NJ11,0X^^0;3^K:X<0!(X\1'=X) X
"^DD",996.54,996.54,3,3)
Enter the nominal polling interval in seconds.
"^DD",996.54,996.54,3,21,0)
^^10^10^3021021.152235
"^DD",996.54,996.54,3,21,1,0)
This is the nominal polling interval for the event in seconds.
"^DD",996.54,996.54,3,21,2,0)
The actual polling interval is dependent on the event polling
"^DD",996.54,996.54,3,21,3,0)
interval set for the client application as a site parameter.
"^DD",996.54,996.54,3,21,4,0)
The nominal polling interval guarantees that polling for this
"^DD",996.54,996.54,3,21,5,0)
event will not occur more frequently than this setting.
"^DD",996.54,996.54,3,21,6,0)
 
"^DD",996.54,996.54,3,21,7,0)
For events that are infrequent and/or do not require real time
"^DD",996.54,996.54,3,21,8,0)
notification, higher values may be selected for this field to
"^DD",996.54,996.54,3,21,9,0)
mitigate impact on system load. 
"^DD",996.54,996.54,3,21,10,0)

"^DD",996.54,996.54,3,"DT")
3021021
"^DD",996.54,996.54,4,0)
LOG EVENT^S^0:NO;1:YES;^0;4^Q
"^DD",996.54,996.54,4,3)
Enter YES to enable logging of this event.
"^DD",996.54,996.54,4,"DT")
3030611
"^DD",996.54,996.54,5,0)
LOG RETENTION^NJ6,0^^0;5^K:+X'=X!(X>999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",996.54,996.54,5,3)
Number of days to retain log entries.
"^DD",996.54,996.54,5,"DT")
3030611
"^DD",996.54,996.54,6,0)
POLLING METHOD^S^0:PER SESSION;1:PER INTERVAL;^0;6^Q
"^DD",996.54,996.54,6,3)
Determines how a monitored event is polled.
"^DD",996.54,996.54,6,21,0)
^^11^11^3030810.175145
"^DD",996.54,996.54,6,21,1,0)
For monitored events, this setting determines how the monitor is invoked
"^DD",996.54,996.54,6,21,2,0)
when the polling interval has been reached.  PER SESSION causes the event
"^DD",996.54,996.54,6,21,3,0)
monitor to be invoked for each active session, setting the user and
"^DD",996.54,996.54,6,21,4,0)
session context prior to each call.  PER INTERVAL cause the event monitor
"^DD",996.54,996.54,6,21,5,0)
to be invoked only once per interval.  No user or session context information
"^DD",996.54,996.54,6,21,6,0)
is available to the monitor in this case.
"^DD",996.54,996.54,6,21,7,0)

"^DD",996.54,996.54,6,21,8,0)
PER SESSION is appropriate for events that depend upon a specific user or
"^DD",996.54,996.54,6,21,9,0)
session (e.g., notifications).  PER INTERVAL is appropriate for events 
"^DD",996.54,996.54,6,21,10,0)
that are independent of a user or session (e.g., status events to display
"^DD",996.54,996.54,6,21,11,0)
the host date/time).
"^DD",996.54,996.54,6,"DT")
3030810
"^DD",996.54,996.54,7,0)
EVENT PROTOCOL^*P101'^ORD(101,^0;7^S DIC("S")="I $E(^(0),1,4)=""RGNE"",$P(^(0),U,4)=""X""" D ^DIC K DIC S DIC=$G(DIE),X=+Y K:Y<0 X
"^DD",996.54,996.54,7,12)
Restricts to Extended Action Protocols starting with RGNE
"^DD",996.54,996.54,7,12.1)
S DIC("S")="I $E(^(0),1,4)=""RGNE"",$P(^(0),U,4)=""X"""
"^DD",996.54,996.54,7,"DT")
3091007
"^DD",996.54,996.54,10,0)
DISPLAY LOGIC^K^^10;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",996.54,996.54,10,3)
Logic to display stub info in log viewer.
"^DD",996.54,996.54,10,9)
@
"^DD",996.54,996.54,10,"DT")
3030611
"^DD",996.54,996.54,20,0)
PUBLICATION KEY^996.542P^^20;0
"^DD",996.54,996.54,21,0)
SUBSCRIPTION KEY^996.5421P^^21;0
"^DD",996.54,996.54,99,0)
DESCRIPTION^996.5499^^99;0
"^DD",996.54,996.54,100,0)
ERROR DATE/TIME^D^^100;1^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",996.54,996.54,100,3)
Date and time of last error
"^DD",996.54,996.54,100,"DT")
3061129
"^DD",996.54,996.54,101,0)
ERROR TEXT^F^^100;2^K:$L(X)>240!($L(X)<1) X
"^DD",996.54,996.54,101,3)
Answer must be 1-240 characters in length.
"^DD",996.54,996.54,101,"DT")
3061129
"^DD",996.54,996.542,0)
PUBLICATION KEY SUB-FIELD^^.01^1
"^DD",996.54,996.542,0,"DT")
3021021
"^DD",996.54,996.542,0,"IX","B",996.542,.01)

"^DD",996.54,996.542,0,"NM","PUBLICATION KEY")

"^DD",996.54,996.542,0,"UP")
996.54
"^DD",996.54,996.542,.01,0)
PUBLICATION KEY^MP19.1'X^DIC(19.1,^0;1^Q
"^DD",996.54,996.542,.01,1,0)
^.1
"^DD",996.54,996.542,.01,1,1,0)
996.542^B
"^DD",996.54,996.542,.01,1,1,1)
S ^RGNET(996.54,DA(1),20,"B",$E(X,1,30),DA)=""
"^DD",996.54,996.542,.01,1,1,2)
K ^RGNET(996.54,DA(1),20,"B",$E(X,1,30),DA)
"^DD",996.54,996.542,.01,3)
Security keys required to fire this event.
"^DD",996.54,996.542,.01,21,0)
^^2^2^3021021.152715
"^DD",996.54,996.542,.01,21,1,0)
If there are entries in this multiple, the user must possess at least one of
"^DD",996.54,996.542,.01,21,2,0)
the listed keys in order to fire an event of this type.
"^DD",996.54,996.542,.01,"DT")
3040310
"^DD",996.54,996.5421,0)
SUBSCRIPTION KEY SUB-FIELD^^.01^1
"^DD",996.54,996.5421,0,"DT")
3021021
"^DD",996.54,996.5421,0,"IX","B",996.5421,.01)

"^DD",996.54,996.5421,0,"NM","SUBSCRIPTION KEY")

"^DD",996.54,996.5421,0,"UP")
996.54
"^DD",996.54,996.5421,.01,0)
SUBSCRIPTION KEY^MP19.1'X^DIC(19.1,^0;1^Q
"^DD",996.54,996.5421,.01,1,0)
^.1
"^DD",996.54,996.5421,.01,1,1,0)
996.5421^B
"^DD",996.54,996.5421,.01,1,1,1)
S ^RGNET(996.54,DA(1),21,"B",$E(X,1,30),DA)=""
"^DD",996.54,996.5421,.01,1,1,2)
K ^RGNET(996.54,DA(1),21,"B",$E(X,1,30),DA)
"^DD",996.54,996.5421,.01,3)
Security keys required to receive this event type.
"^DD",996.54,996.5421,.01,21,0)
^^2^2^3021021.153002
"^DD",996.54,996.5421,.01,21,1,0)
If there are entries in this multiple, the user must possess at least one of
"^DD",996.54,996.5421,.01,21,2,0)
the listed keys in order subscribe to an event of this type. 
"^DD",996.54,996.5421,.01,"DT")
3040310
"^DD",996.54,996.5499,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",996.54,996.5499,0,"DT")
3021021
"^DD",996.54,996.5499,0,"NM","DESCRIPTION")

"^DD",996.54,996.5499,0,"UP")
996.54
"^DD",996.54,996.5499,.01,0)
DESCRIPTION^W^^0;1^Q
"^DD",996.54,996.5499,.01,3)
Enter a detailed description of this event type.
"^DD",996.54,996.5499,.01,"DT")
3021021
"^DD",996.55,996.55,0)
FIELD^^10^5
"^DD",996.55,996.55,0,"DT")
3030611
"^DD",996.55,996.55,0,"ID",1)
W "   ",$P(^(0),U,2)
"^DD",996.55,996.55,0,"IX","B",996.55,.01)

"^DD",996.55,996.55,0,"IX","C",996.55,1)

"^DD",996.55,996.55,0,"IX","D",996.55,2)

"^DD",996.55,996.55,0,"IX","E",996.55,3)

"^DD",996.55,996.55,0,"NM","NETSERV BROKER EVENT LOG")

"^DD",996.55,996.55,0,"VRPK")
NETSERV RPC BROKER
"^DD",996.55,996.55,.01,0)
TIMESTAMP^RD^^0;1^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",996.55,996.55,.01,1,0)
^.1
"^DD",996.55,996.55,.01,1,1,0)
996.55^B
"^DD",996.55,996.55,.01,1,1,1)
S ^RGNET(996.55,"B",$E(X,1,30),DA)=""
"^DD",996.55,996.55,.01,1,1,2)
K ^RGNET(996.55,"B",$E(X,1,30),DA)
"^DD",996.55,996.55,.01,3)
Time event was logged.
"^DD",996.55,996.55,.01,"DT")
3030611
"^DD",996.55,996.55,1,0)
EVENT NAME^RF^^0;2^K:$L(X)>100!($L(X)<1) X
"^DD",996.55,996.55,1,1,0)
^.1
"^DD",996.55,996.55,1,1,1,0)
996.55^C
"^DD",996.55,996.55,1,1,1,1)
S ^RGNET(996.55,"C",$E(X,1,30),DA)=""
"^DD",996.55,996.55,1,1,1,2)
K ^RGNET(996.55,"C",$E(X,1,30),DA)
"^DD",996.55,996.55,1,1,1,"DT")
3030611
"^DD",996.55,996.55,1,3)
Name of event.
"^DD",996.55,996.55,1,"DT")
3030611
"^DD",996.55,996.55,2,0)
USER^P200'^VA(200,^0;3^Q
"^DD",996.55,996.55,2,1,0)
^.1
"^DD",996.55,996.55,2,1,1,0)
996.55^D
"^DD",996.55,996.55,2,1,1,1)
S ^RGNET(996.55,"D",$E(X,1,30),DA)=""
"^DD",996.55,996.55,2,1,1,2)
K ^RGNET(996.55,"D",$E(X,1,30),DA)
"^DD",996.55,996.55,2,1,1,"DT")
3030611
"^DD",996.55,996.55,2,3)
User originating the event.
"^DD",996.55,996.55,2,"DT")
3030611
"^DD",996.55,996.55,3,0)
SESSION^NJ15,0^^0;4^K:+X'=X!(X>999999999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",996.55,996.55,3,1,0)
^.1
"^DD",996.55,996.55,3,1,1,0)
996.55^E
"^DD",996.55,996.55,3,1,1,1)
S ^RGNET(996.55,"E",$E(X,1,30),DA)=""
"^DD",996.55,996.55,3,1,1,2)
K ^RGNET(996.55,"E",$E(X,1,30),DA)
"^DD",996.55,996.55,3,1,1,"DT")
3030611
"^DD",996.55,996.55,3,3)
Session originating the event.
"^DD",996.55,996.55,3,"DT")
3030611
"^DD",996.55,996.55,10,0)
EVENT STUB^996.552^^10;0
"^DD",996.55,996.552,0)
EVENT STUB SUB-FIELD^^.01^1
"^DD",996.55,996.552,0,"DT")
3030611
"^DD",996.55,996.552,0,"NM","EVENT STUB")

"^DD",996.55,996.552,0,"UP")
996.55
"^DD",996.55,996.552,.01,0)
EVENT STUB^WL^^0;1^Q
"^DD",996.55,996.552,.01,3)
Data associated with event.
"^DD",996.55,996.552,.01,"DT")
3030611
"^DD",996.56,996.56,0)
FIELD^^10^7
"^DD",996.56,996.56,0,"DDA")
N
"^DD",996.56,996.56,0,"DT")
3080104
"^DD",996.56,996.56,0,"IX","B",996.56,.01)

"^DD",996.56,996.56,0,"IX","BDIV",996.56,5)

"^DD",996.56,996.56,0,"IX","BLOGIN",996.56,3)

"^DD",996.56,996.56,0,"IX","BLOGOUT",996.56,4)

"^DD",996.56,996.56,0,"IX","BUSER",996.56,1)

"^DD",996.56,996.56,0,"IX","BWKID",996.56,2)

"^DD",996.56,996.56,0,"NM","NETSERV BROKER ACTIVITY LOG")

"^DD",996.56,996.56,0,"VRPK")
NETSERV RPC BROKER
"^DD",996.56,996.56,.01,0)
SESSION ID^RNJ9,0^^0;1^K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",996.56,996.56,.01,1,0)
^.1
"^DD",996.56,996.56,.01,1,1,0)
996.56^B
"^DD",996.56,996.56,.01,1,1,1)
S ^RGNET(996.56,"B",$E(X,1,30),DA)=""
"^DD",996.56,996.56,.01,1,1,2)
K ^RGNET(996.56,"B",$E(X,1,30),DA)
"^DD",996.56,996.56,.01,3)
This is the unique identifier for the session.
"^DD",996.56,996.56,.01,"DT")
3080103
"^DD",996.56,996.56,1,0)
USER^P200'^VA(200,^0;2^Q
"^DD",996.56,996.56,1,1,0)
^.1
"^DD",996.56,996.56,1,1,1,0)
996.56^BUSER
"^DD",996.56,996.56,1,1,1,1)
S ^RGNET(996.56,"BUSER",$E(X,1,30),DA)=""
"^DD",996.56,996.56,1,1,1,2)
K ^RGNET(996.56,"BUSER",$E(X,1,30),DA)
"^DD",996.56,996.56,1,1,1,"DT")
3080103
"^DD",996.56,996.56,1,3)
User associated with this session.
"^DD",996.56,996.56,1,"DT")
3080103
"^DD",996.56,996.56,2,0)
WORKSTATION ID^F^^0;3^K:$L(X)>50!($L(X)<1) X
"^DD",996.56,996.56,2,1,0)
^.1
"^DD",996.56,996.56,2,1,1,0)
996.56^BWKID
"^DD",996.56,996.56,2,1,1,1)
S ^RGNET(996.56,"BWKID",$E(X,1,30),DA)=""
"^DD",996.56,996.56,2,1,1,2)
K ^RGNET(996.56,"BWKID",$E(X,1,30),DA)
"^DD",996.56,996.56,2,1,1,"DT")
3080103
"^DD",996.56,996.56,2,3)
Name of the workstation originating this session.
"^DD",996.56,996.56,2,"DT")
3080103
"^DD",996.56,996.56,3,0)
LOGIN TIME^D^^0;4^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",996.56,996.56,3,1,0)
^.1
"^DD",996.56,996.56,3,1,1,0)
996.56^BLOGIN
"^DD",996.56,996.56,3,1,1,1)
S ^RGNET(996.56,"BLOGIN",$E(X,1,30),DA)=""
"^DD",996.56,996.56,3,1,1,2)
K ^RGNET(996.56,"BLOGIN",$E(X,1,30),DA)
"^DD",996.56,996.56,3,1,1,"DT")
3080103
"^DD",996.56,996.56,3,3)
Time of initial login.
"^DD",996.56,996.56,3,"DT")
3080103
"^DD",996.56,996.56,4,0)
LOGOUT TIME^D^^0;5^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",996.56,996.56,4,1,0)
^.1
"^DD",996.56,996.56,4,1,1,0)
996.56^BLOGOUT
"^DD",996.56,996.56,4,1,1,1)
S ^RGNET(996.56,"BLOGOUT",$E(X,1,30),DA)=""
"^DD",996.56,996.56,4,1,1,2)
K ^RGNET(996.56,"BLOGOUT",$E(X,1,30),DA)
"^DD",996.56,996.56,4,1,1,"DT")
3080103
"^DD",996.56,996.56,4,3)
Time of final logout.
"^DD",996.56,996.56,4,"DT")
3080103
"^DD",996.56,996.56,5,0)
DIVISION^P4'^DIC(4,^0;6^Q
"^DD",996.56,996.56,5,1,0)
^.1
"^DD",996.56,996.56,5,1,1,0)
996.56^BDIV
"^DD",996.56,996.56,5,1,1,1)
S ^RGNET(996.56,"BDIV",$E(X,1,30),DA)=""
"^DD",996.56,996.56,5,1,1,2)
K ^RGNET(996.56,"BDIV",$E(X,1,30),DA)
"^DD",996.56,996.56,5,1,1,"DT")
3080104
"^DD",996.56,996.56,5,3)
Division user has logged into.
"^DD",996.56,996.56,5,"DT")
3080104
"^DD",996.56,996.56,10,0)
ACTIVITY^996.561D^^10;0
"^DD",996.56,996.561,0)
ACTIVITY SUB-FIELD^^10^4
"^DD",996.56,996.561,0,"DT")
3080103
"^DD",996.56,996.561,0,"IX","B",996.561,.01)

"^DD",996.56,996.561,0,"NM","ACTIVITY")

"^DD",996.56,996.561,0,"UP")
996.56
"^DD",996.56,996.561,.01,0)
DATE/TIME^MD^^0;1^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",996.56,996.561,.01,1,0)
^.1
"^DD",996.56,996.561,.01,1,1,0)
996.561^B
"^DD",996.56,996.561,.01,1,1,1)
S ^RGNET(996.56,DA(1),10,"B",$E(X,1,30),DA)=""
"^DD",996.56,996.561,.01,1,1,2)
K ^RGNET(996.56,DA(1),10,"B",$E(X,1,30),DA)
"^DD",996.56,996.561,.01,"DT")
3080103
"^DD",996.56,996.561,1,0)
TYPE^S^1:RPC;2:EVENT;^0;2^Q
"^DD",996.56,996.561,1,"DT")
3080103
"^DD",996.56,996.561,2,0)
NAME^F^^0;3^K:$L(X)>150!($L(X)<1) X
"^DD",996.56,996.561,2,3)
Answer must be 1-150 characters in length.
"^DD",996.56,996.561,2,"DT")
3080103
"^DD",996.56,996.561,10,0)
LOG^996.562^^10;0
"^DD",996.56,996.562,0)
LOG SUB-FIELD^^.01^1
"^DD",996.56,996.562,0,"DT")
3080103
"^DD",996.56,996.562,0,"NM","LOG")

"^DD",996.56,996.562,0,"UP")
996.561
"^DD",996.56,996.562,.01,0)
LOG^WL^^0;1^Q
"^DD",996.56,996.562,.01,"DT")
3080103
"^DD",996.57,996.57,0)
FIELD^^2^3
"^DD",996.57,996.57,0,"DT")
3021009
"^DD",996.57,996.57,0,"ID",1)
S %I=Y,Y=$S('$D(^(0)):"",$D(^VA(200,+$P(^(0),U,2),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(200,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",996.57,996.57,0,"IX","B",996.57,.01)

"^DD",996.57,996.57,0,"NM","NETSERV BROKER AUTHENTICATION")

"^DD",996.57,996.57,0,"VRPK")
NETSERV RPC BROKER
"^DD",996.57,996.57,.01,0)
SID^RF^^0;1^K:$L(X)>200!($L(X)<3) X
"^DD",996.57,996.57,.01,1,0)
^.1
"^DD",996.57,996.57,.01,1,1,0)
996.57^B
"^DD",996.57,996.57,.01,1,1,1)
S ^RGNET(996.57,"B",$E(X,1,30),DA)=""
"^DD",996.57,996.57,.01,1,1,2)
K ^RGNET(996.57,"B",$E(X,1,30),DA)
"^DD",996.57,996.57,.01,3)
Answer must be 3-200 characters in length.
"^DD",996.57,996.57,.01,"DT")
3021009
"^DD",996.57,996.57,1,0)
USER^P200'^VA(200,^0;2^Q
"^DD",996.57,996.57,1,"DT")
3021009
"^DD",996.57,996.57,2,0)
CREATED^D^^0;3^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",996.57,996.57,2,"DT")
3021009
"^DIC",996.5,996.5,0)
NETSERV TCP LISTENER^996.5
"^DIC",996.5,996.5,0,"GL")
^RGNET(996.5,
"^DIC",996.5,996.5,"%D",0)
^1.001^2^2^3150330^
"^DIC",996.5,996.5,"%D",1,0)
Each entry in this file represents a configuration for a listener that will
"^DIC",996.5,996.5,"%D",2,0)
process requests on a given TCP port via the specified handler.
"^DIC",996.5,"B","NETSERV TCP LISTENER",996.5)

"^DIC",996.54,996.54,0)
NETSERV BROKER EVENT TYPE^996.54
"^DIC",996.54,996.54,0,"GL")
^RGNET(996.54,
"^DIC",996.54,"B","NETSERV BROKER EVENT TYPE",996.54)

"^DIC",996.55,996.55,0)
NETSERV BROKER EVENT LOG^996.55
"^DIC",996.55,996.55,0,"GL")
^RGNET(996.55,
"^DIC",996.55,"B","NETSERV BROKER EVENT LOG",996.55)

"^DIC",996.56,996.56,0)
NETSERV BROKER ACTIVITY LOG^996.56
"^DIC",996.56,996.56,0,"GL")
^RGNET(996.56,
"^DIC",996.56,996.56,"%",0)
^1.005^^0
"^DIC",996.56,996.56,"%D",0)
^^1^1^3080103.095644
"^DIC",996.56,996.56,"%D",1,0)
This file logs session activities such as RPC calls and remote events.
"^DIC",996.56,"B","NETSERV BROKER ACTIVITY LOG",996.56)

"^DIC",996.57,996.57,0)
NETSERV BROKER AUTHENTICATION^996.57
"^DIC",996.57,996.57,0,"GL")
^RGNET(996.57,
"^DIC",996.57,"B","NETSERV BROKER AUTHENTICATION",996.57)

**INSTALL NAME**
NETSERV OAUTH2 SERVICE 1.0
"BLD",8511,0)
NETSERV OAUTH2 SERVICE 1.0^NETWORK SERVICES^0^3150404^n
"BLD",8511,1,0)
^^2^2^3150401.080059
"BLD",8511,1,1,0)
Provides an implementation of the OAuth 2 authentication protocol using the
"BLD",8511,1,2,0)
NETSERV web server.
"BLD",8511,4,0)
^9.64PA^996.52^2
"BLD",8511,4,996.52,0)
996.52
"BLD",8511,4,996.52,222)
n^y^f^^n^^y^o^n
"BLD",8511,4,996.52,224)
I $G(^RGNET(996.52,Y,10))["^RGNETOA"
"BLD",8511,4,996.53,0)
996.53
"BLD",8511,4,996.53,222)
y^y^f^^^^n
"BLD",8511,4,"B",996.52,996.52)

"BLD",8511,4,"B",996.53,996.53)

"BLD",8511,6.3)
44
"BLD",8511,"ABPKG")
n
"BLD",8511,"KRN",0)
^9.67PA^779.2^20
"BLD",8511,"KRN",.4,0)
.4
"BLD",8511,"KRN",.401,0)
.401
"BLD",8511,"KRN",.402,0)
.402
"BLD",8511,"KRN",.403,0)
.403
"BLD",8511,"KRN",.5,0)
.5
"BLD",8511,"KRN",.84,0)
.84
"BLD",8511,"KRN",3.6,0)
3.6
"BLD",8511,"KRN",3.8,0)
3.8
"BLD",8511,"KRN",9.2,0)
9.2
"BLD",8511,"KRN",9.8,0)
9.8
"BLD",8511,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",8511,"KRN",9.8,"NM",1,0)
RGNETOA^^0^B4967294
"BLD",8511,"KRN",9.8,"NM",2,0)
RGNETOAA^^0^B3931337
"BLD",8511,"KRN",9.8,"NM",3,0)
RGNETOAT^^0^B8373286
"BLD",8511,"KRN",9.8,"NM","B","RGNETOA",1)

"BLD",8511,"KRN",9.8,"NM","B","RGNETOAA",2)

"BLD",8511,"KRN",9.8,"NM","B","RGNETOAT",3)

"BLD",8511,"KRN",19,0)
19
"BLD",8511,"KRN",19.1,0)
19.1
"BLD",8511,"KRN",101,0)
101
"BLD",8511,"KRN",409.61,0)
409.61
"BLD",8511,"KRN",771,0)
771
"BLD",8511,"KRN",779.2,0)
779.2
"BLD",8511,"KRN",870,0)
870
"BLD",8511,"KRN",8989.51,0)
8989.51
"BLD",8511,"KRN",8989.52,0)
8989.52
"BLD",8511,"KRN",8994,0)
8994
"BLD",8511,"KRN","B",.4,.4)

"BLD",8511,"KRN","B",.401,.401)

"BLD",8511,"KRN","B",.402,.402)

"BLD",8511,"KRN","B",.403,.403)

"BLD",8511,"KRN","B",.5,.5)

"BLD",8511,"KRN","B",.84,.84)

"BLD",8511,"KRN","B",3.6,3.6)

"BLD",8511,"KRN","B",3.8,3.8)

"BLD",8511,"KRN","B",9.2,9.2)

"BLD",8511,"KRN","B",9.8,9.8)

"BLD",8511,"KRN","B",19,19)

"BLD",8511,"KRN","B",19.1,19.1)

"BLD",8511,"KRN","B",101,101)

"BLD",8511,"KRN","B",409.61,409.61)

"BLD",8511,"KRN","B",771,771)

"BLD",8511,"KRN","B",779.2,779.2)

"BLD",8511,"KRN","B",870,870)

"BLD",8511,"KRN","B",8989.51,8989.51)

"BLD",8511,"KRN","B",8989.52,8989.52)

"BLD",8511,"KRN","B",8994,8994)

"BLD",8511,"QUES",0)
^9.62^^
"BLD",8511,"REQB",0)
^9.611^1^1
"BLD",8511,"REQB",1,0)
NETSERV CONNECTION MANAGER 1.0^2
"BLD",8511,"REQB","B","NETSERV CONNECTION MANAGER 1.0",1)

"DATA",996.52,4,0)
oauth2/authorize^GET
"DATA",996.52,4,10)
MGET^RGNETOAA
"DATA",996.52,5,0)
oauth2/token^POST
"DATA",996.52,5,10)
MPOST^RGNETOAT
"FIA",996.52)
NETSERV HTTP ENDPOINT
"FIA",996.52,0)
^RGNET(996.52,
"FIA",996.52,0,0)
996.52
"FIA",996.52,0,1)
n^y^f^^n^^y^o^n
"FIA",996.52,0,10)

"FIA",996.52,0,11)
I $G(^RGNET(996.52,Y,10))["^RGNETOA"
"FIA",996.52,0,"RLRO")

"FIA",996.52,0,"VR")
1.0^NETSERV OAUTH2 SERVICE
"FIA",996.52,996.52)
0
"FIA",996.52,996.5299)
0
"FIA",996.53)
NETSERV OAUTH CONTROL
"FIA",996.53,0)
^RGNET(996.53,
"FIA",996.53,0,0)
996.53
"FIA",996.53,0,1)
y^y^f^^^^n
"FIA",996.53,0,10)

"FIA",996.53,0,11)

"FIA",996.53,0,"RLRO")

"FIA",996.53,0,"VR")
1.0^NETSERV OAUTH2 SERVICE
"FIA",996.53,996.53)
0
"IX",996.52,996.52,"C",0)
996.52^C^Compound index by METHOD and URL.^MU^^R^IR^I^996.52^^^^^LS
"IX",996.52,996.52,"C",1)
S ^RGNET(996.52,"C",X(1),X(2),DA)=$$TOPTRN^RGNETWWW(X(2))
"IX",996.52,996.52,"C",2)
K ^RGNET(996.52,"C",X(1),X(2),DA)
"IX",996.52,996.52,"C",2.5)
K ^RGNET(996.52,"C")
"IX",996.52,996.52,"C",11.1,0)
^.114IA^2^2
"IX",996.52,996.52,"C",11.1,1,0)
1^F^996.52^1^10^1^F
"IX",996.52,996.52,"C",11.1,2,0)
2^F^996.52^.01^150^2^F
"MBREQ")
1
"PKG",225,-1)
1^1
"PKG",225,0)
NETWORK SERVICES^RGNE^Network services
"PKG",225,20,0)
^9.402P^^
"PKG",225,22,0)
^9.49I^1^1
"PKG",225,22,1,0)
1.0^3150404
"PKG",225,22,1,1,0)
^^2^2^3150404
"PKG",225,22,1,1,1,0)
Provides an implementation of the OAuth 2 authentication protocol using the
"PKG",225,22,1,1,2,0)
NETSERV web server.
"PKG",225,"VERSION")
1.0
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","RGNETOA")
0^1^B4967294
"RTN","RGNETOA",1,0)
RGNETOA ;RI/CBMI/DKM - OAuth2 Support ;01-Apr-2015 02:02;DKM
"RTN","RGNETOA",2,0)
 ;;1.0;NETWORK SERVICES;;14-March-2014;Build 44
"RTN","RGNETOA",3,0)
 ;=================================================================
"RTN","RGNETOA",4,0)
 ; Register a client application
"RTN","RGNETOA",5,0)
 ; Returns client id^client secret
"RTN","RGNETOA",6,0)
REGAPP(APPNAME,REDIRECT) ;
"RTN","RGNETOA",7,0)
 N IENS,FDA,ID,SECRET
"RTN","RGNETOA",8,0)
 S IENS=$O(^RGNET(996.53,"B",APPNAME,0))
"RTN","RGNETOA",9,0)
 S IENS=$S(IENS:IENS_",",1:"+1,")
"RTN","RGNETOA",10,0)
 S ID=$$UUID^RGUT,SECRET=$$UUID^RGUT
"RTN","RGNETOA",11,0)
 S FDA=$NA(FDA(996.53,IENS))
"RTN","RGNETOA",12,0)
 S @FDA@(.01)=APPNAME
"RTN","RGNETOA",13,0)
 S @FDA@(1)=ID
"RTN","RGNETOA",14,0)
 S @FDA@(2)=SECRET
"RTN","RGNETOA",15,0)
 S @FDA@(3)=3600
"RTN","RGNETOA",16,0)
 S @FDA@(10)=REDIRECT
"RTN","RGNETOA",17,0)
 D UPDATE^DIE("E","FDA")
"RTN","RGNETOA",18,0)
 Q:$Q ID_U_SECRET
"RTN","RGNETOA",19,0)
 Q
"RTN","RGNETOA",20,0)
 ; Lookup client by id
"RTN","RGNETOA",21,0)
 ; Returns true if successful
"RTN","RGNETOA",22,0)
GETCLNT(CLIENT) ;
"RTN","RGNETOA",23,0)
 Q:'$D(CLIENT) 0
"RTN","RGNETOA",24,0)
 Q:$D(CLIENT)=11 1
"RTN","RGNETOA",25,0)
 N IEN,N0,RU
"RTN","RGNETOA",26,0)
 S IEN=$S('$L(CLIENT):0,1:$O(^RGNET(996.53,"C",CLIENT,0)))
"RTN","RGNETOA",27,0)
 Q:'IEN 0
"RTN","RGNETOA",28,0)
 S N0=$G(^RGNET(996.53,IEN,0)),RU=$G(^(10))
"RTN","RGNETOA",29,0)
 S CLIENT=$P(N0,U,2),CLIENT("redirect_uri")=RU,CLIENT("name")=$P(N0,U)
"RTN","RGNETOA",30,0)
 S CLIENT("secret")=$P(N0,U,3),CLIENT("lifespan")=$P(N0,U,4),CLIENT("flow")=$P(N0,U,5)
"RTN","RGNETOA",31,0)
 S:'CLIENT("lifespan") CLIENT("lifespan")=3600
"RTN","RGNETOA",32,0)
 Q 1
"RTN","RGNETOA",33,0)
 ; Get root of OAUTH data store
"RTN","RGNETOA",34,0)
STORE(NODE) ;
"RTN","RGNETOA",35,0)
 N X
"RTN","RGNETOA",36,0)
 S X=$NA(^XTMP("RGNET_OAUTH"))
"RTN","RGNETOA",37,0)
 Q $S($D(NODE):$NA(@X@(NODE)),1:X)
"RTN","RGNETOA",38,0)
 ; Fetches an object of the given type from the data store
"RTN","RGNETOA",39,0)
GETOBJ(OBJ,TYPE,REMOVE) ;
"RTN","RGNETOA",40,0)
 Q:'$L($G(OBJ))
"RTN","RGNETOA",41,0)
 N STORE
"RTN","RGNETOA",42,0)
 S STORE=$$STORE(TYPE)
"RTN","RGNETOA",43,0)
 M OBJ=@STORE@(OBJ)
"RTN","RGNETOA",44,0)
 K:$G(REMOVE) @STORE@(OBJ)
"RTN","RGNETOA",45,0)
 Q
"RTN","RGNETOA",46,0)
 ; Writes an object of the given type to the data store
"RTN","RGNETOA",47,0)
SETOBJ(OBJ,TYPE) ;
"RTN","RGNETOA",48,0)
 N STORE
"RTN","RGNETOA",49,0)
 S STORE=$$STORE(TYPE)
"RTN","RGNETOA",50,0)
 K @STORE@(OBJ)
"RTN","RGNETOA",51,0)
 M @STORE@(OBJ)=OBJ
"RTN","RGNETOA",52,0)
 Q
"RTN","RGNETOA",53,0)
 ; Removes an object of the given type from the data store
"RTN","RGNETOA",54,0)
DELOBJ(OBJ,TYPE) ;
"RTN","RGNETOA",55,0)
 K:$L($G(OBJ)) @$$STORE(TYPE)@(OBJ)
"RTN","RGNETOA",56,0)
 Q
"RTN","RGNETOA",57,0)
 ; Builds a response
"RTN","RGNETOA",58,0)
BLDRSP(ATKN,RTKN) ;
"RTN","RGNETOA",59,0)
 N PF
"RTN","RGNETOA",60,0)
 S PF="{"
"RTN","RGNETOA",61,0)
 D GETATKN(.ATKN)
"RTN","RGNETOA",62,0)
 D PUT("access_token",ATKN,.PF)
"RTN","RGNETOA",63,0)
 D PUT("token_type","bearer",.PF)
"RTN","RGNETOA",64,0)
 D PUT("expires_in",ATKN("lifespan"),.PF)
"RTN","RGNETOA",65,0)
 D PUT("scope",ATKN("scope"),.PF)
"RTN","RGNETOA",66,0)
 D PUT("refresh_token",.RTKN,.PF)
"RTN","RGNETOA",67,0)
 D ADD^RGNETWWW("}")
"RTN","RGNETOA",68,0)
 Q
"RTN","RGNETOA",69,0)
 ; Wrap a value in quotes
"RTN","RGNETOA",70,0)
QT(X) Q """"_X_""""
"RTN","RGNETOA",71,0)
 ; Writes a name / value pair to output buffer
"RTN","RGNETOA",72,0)
PUT(PN,VL,PF) ;
"RTN","RGNETOA",73,0)
 Q:'$L($G(VL))
"RTN","RGNETOA",74,0)
 D ADD^RGNETWWW(PF_$$QT(PN)_":"_$$QT(VL))
"RTN","RGNETOA",75,0)
 S PF=","
"RTN","RGNETOA",76,0)
 Q
"RTN","RGNETOAA")
0^2^B3931337
"RTN","RGNETOAA",1,0)
RGNETOAA ;RI/CBMI/DKM - OAuth2 Authorization Endpoint ;01-Apr-2015 02:02;DKM
"RTN","RGNETOAA",2,0)
 ;;1.0;NETWORK SERVICES;;14-March-2014;Build 44
"RTN","RGNETOAA",3,0)
 ;=================================================================
"RTN","RGNETOAA",4,0)
 ; GET method handler
"RTN","RGNETOAA",5,0)
MGET N RT,GT,FLOW,CLIENT
"RTN","RGNETOAA",6,0)
 S RT=$$GETPARAM^RGNETWWW("response_type")
"RTN","RGNETOAA",7,0)
 S GT=$$GETPARAM^RGNETWWW("grant_type")
"RTN","RGNETOAA",8,0)
 S CLIENT=$$GETPARAM^RGNETWWW("client_id")
"RTN","RGNETOAA",9,0)
 I '$$GETCLNT^RGNETOA(.CLIENT) D SETSTAT^RGNETWWW(404) Q
"RTN","RGNETOAA",10,0)
 S FLOW=$S(RT="code":"W",RT="token":"U",GT="password":"P",GT="client_credentials":"C",1:"?")
"RTN","RGNETOAA",11,0)
 I FLOW'=CLIENT("flow") D SETSTAT^RGNETWWW(403) Q
"RTN","RGNETOAA",12,0)
 D @("AUTH"_FLOW)
"RTN","RGNETOAA",13,0)
 Q
"RTN","RGNETOAA",14,0)
 ; Web server flow: authorization code grant
"RTN","RGNETOAA",15,0)
AUTHW N CODE,LOCATION,STATE
"RTN","RGNETOAA",16,0)
 Q:'$$VALIDRDU
"RTN","RGNETOAA",17,0)
 Q:'$$AUTH^RGNETWWW(1)
"RTN","RGNETOAA",18,0)
 D SETSTAT^RGNETWWW(302)
"RTN","RGNETOAA",19,0)
 S CODE=$$NEWAUTH(.CLIENT,DUZ)
"RTN","RGNETOAA",20,0)
 S STATE=$$GETPARAM^RGNETWWW("state")
"RTN","RGNETOAA",21,0)
 S LOCATION=CLIENT("redirect_uri")_"?code="_CODE
"RTN","RGNETOAA",22,0)
 S:$L(STATE) LOCATION=LOCATION_"&state="_STATE
"RTN","RGNETOAA",23,0)
 D ADDHDR^RGNETWWW("Location: "_LOCATION)
"RTN","RGNETOAA",24,0)
 Q
"RTN","RGNETOAA",25,0)
 ; User-agent flow: implicit grant
"RTN","RGNETOAA",26,0)
AUTHU N ATKN
"RTN","RGNETOAA",27,0)
 Q:'$$VALIDRDU
"RTN","RGNETOAA",28,0)
 Q:'$$AUTH^RGNETWWW(1)
"RTN","RGNETOAA",29,0)
 S ATKN=$$NEWATKN^RGNETOAT(.CLIENT,DUZ,$$GETPARAM^RGNETWWW("scope"))
"RTN","RGNETOAA",30,0)
 D BLDRSP^RGNETOA(ATKN)
"RTN","RGNETOAA",31,0)
 Q
"RTN","RGNETOAA",32,0)
 ; Username and password flow
"RTN","RGNETOAA",33,0)
AUTHP D SETSTAT^RGNETWWW(501)
"RTN","RGNETOAA",34,0)
 Q
"RTN","RGNETOAA",35,0)
 ; Client credentials flow: access token
"RTN","RGNETOAA",36,0)
AUTHC D SETSTAT^RGNETWWW(501)
"RTN","RGNETOAA",37,0)
 Q
"RTN","RGNETOAA",38,0)
 ; Generate a new authorization code
"RTN","RGNETOAA",39,0)
NEWAUTH(CLIENT,USER) ;
"RTN","RGNETOAA",40,0)
 N AUTH
"RTN","RGNETOAA",41,0)
 S AUTH=$$UUID^RGUT,AUTH("user")=USER,AUTH("client")=CLIENT
"RTN","RGNETOAA",42,0)
 D SETOBJ^RGNETOA(.AUTH,"AUTH")
"RTN","RGNETOAA",43,0)
 Q AUTH
"RTN","RGNETOAA",44,0)
 ; Fetches (and removes) an authorization from the data store
"RTN","RGNETOAA",45,0)
GETAUTH(AUTH) ;
"RTN","RGNETOAA",46,0)
 D GETOBJ^RGNETOA(.AUTH,"AUTH",1)
"RTN","RGNETOAA",47,0)
 Q
"RTN","RGNETOAA",48,0)
 ; Validates the redirect uri
"RTN","RGNETOAA",49,0)
VALIDRDU() 
"RTN","RGNETOAA",50,0)
 I CLIENT("redirect_uri")'=$$GETPARAM^RGNETWWW("redirect_uri") D SETSTAT^RGNETWWW(404) Q 0
"RTN","RGNETOAA",51,0)
 Q 1
"RTN","RGNETOAT")
0^3^B8373286
"RTN","RGNETOAT",1,0)
RGNETOAT ;RI/CBMI/DKM - OAuth2 Token Endpoint ;01-Apr-2015 02:02;DKM
"RTN","RGNETOAT",2,0)
 ;;1.0;NETWORK SERVICES;;14-March-2014;Build 44
"RTN","RGNETOAT",3,0)
 ;=================================================================
"RTN","RGNETOAT",4,0)
 ; POST method
"RTN","RGNETOAT",5,0)
MPOST N GT,POST
"RTN","RGNETOAT",6,0)
 D PARSEBD^RGNETWWW(.POST)
"RTN","RGNETOAT",7,0)
 S GT=$G(POST("grant_type",1,1))
"RTN","RGNETOAT",8,0)
 G GTAC:GT="authorization_code",GTRT:GT="refresh_token"
"RTN","RGNETOAT",9,0)
 D SETSTAT^RGNETWWW(501)
"RTN","RGNETOAT",10,0)
 Q
"RTN","RGNETOAT",11,0)
 ; Grant type = authorization_code
"RTN","RGNETOAT",12,0)
GTAC N CLIENT,AUTH,REDIRECT,SECRET,ATKN,RTKN
"RTN","RGNETOAT",13,0)
 S CLIENT=$G(POST("client_id",1,1)),AUTH=$G(POST("code",1,1))
"RTN","RGNETOAT",14,0)
 S REDIRECT=$G(POST("redirect_uri",1,1)),SECRET=$G(POST("client_secret",1,1))
"RTN","RGNETOAT",15,0)
 I '$L(CLIENT)!'$L(AUTH)!'$L(REDIRECT)!'$L(SECRET) D SETSTAT^RGNETWWW(400) Q
"RTN","RGNETOAT",16,0)
 D GETAUTH^RGNETOAA(.AUTH)
"RTN","RGNETOAT",17,0)
 I $D(AUTH)'>1 D SETSTAT^RGNETWWW(404) Q
"RTN","RGNETOAT",18,0)
 I AUTH("secret")'=SECRET D SETSTAT^RGNETWWW(403)
"RTN","RGNETOAT",19,0)
 S RTKN=$$NEWRTKN(.CLIENT,AUTH("user"),AUTH("scope"))
"RTN","RGNETOAT",20,0)
 I '$L(RTKN) D SETSTAT^RGNETWWW(403) Q
"RTN","RGNETOAT",21,0)
 S ATKN=$$REFATKN(.RTKN)
"RTN","RGNETOAT",22,0)
 D BLDRSP^RGNETOA(.ATKN,.RTKN)
"RTN","RGNETOAT",23,0)
 Q
"RTN","RGNETOAT",24,0)
 ; Grant type = refresh_token
"RTN","RGNETOAT",25,0)
GTRT N RTKN,ATKN
"RTN","RGNETOAT",26,0)
 S RTKN=$G(POST("refresh_token",1,1))
"RTN","RGNETOAT",27,0)
 S ATKN=$$REFTKN(RTKN)
"RTN","RGNETOAT",28,0)
 I '$L(ATKN) D SETSTAT^RGNETWWW(404) Q
"RTN","RGNETOAT",29,0)
 D BLDRSP^RGNETOA(.ATKN)
"RTN","RGNETOAT",30,0)
 Q
"RTN","RGNETOAT",31,0)
 ; Fetches an access token from the data store
"RTN","RGNETOAT",32,0)
GETATKN(ATKN) ;
"RTN","RGNETOAT",33,0)
 D GETOBJ^RGNETOA(.ATKN,"ATKN")
"RTN","RGNETOAT",34,0)
 Q
"RTN","RGNETOAT",35,0)
 ; Fetches a refresh token from the data store
"RTN","RGNETOAT",36,0)
GETRTKN(RTKN) ;
"RTN","RGNETOAT",37,0)
 D GETOBJ^RGNETOA(.RTKN,"RTKN")
"RTN","RGNETOAT",38,0)
 Q
"RTN","RGNETOAT",39,0)
 ; Writes an access token to the data store
"RTN","RGNETOAT",40,0)
SETATKN(ATKN) 
"RTN","RGNETOAT",41,0)
 D SETOBJ^RGNETOA(.ATKN,"ATKN")
"RTN","RGNETOAT",42,0)
 Q
"RTN","RGNETOAT",43,0)
 ; Writes a refresh token to the data store
"RTN","RGNETOAT",44,0)
SETRTKN(RTKN) ;
"RTN","RGNETOAT",45,0)
 D SETOBJ^RGNETOA(.RTKN,"RTKN")
"RTN","RGNETOAT",46,0)
 Q
"RTN","RGNETOAT",47,0)
 ; Generate an access token
"RTN","RGNETOAT",48,0)
NEWATKN(CLIENT,USER,SCOPE) ;
"RTN","RGNETOAT",49,0)
 Q:'$$GETCLNT^RGNETOA(.CLIENT) ""
"RTN","RGNETOAT",50,0)
 N ATKN,EXP
"RTN","RGNETOAT",51,0)
 S ATKN=$$UUID^RGUT,EXP=$$FMADD^XLFDT($$NOW^XLFDT,0,0,0,CLIENT("lifespan"))
"RTN","RGNETOAT",52,0)
 S ATKN("user")=USER,ATKN("expiry")=EXP,ATKN("client")=CLIENT
"RTN","RGNETOAT",53,0)
 S ATKN("lifespan")=CLIENT("lifespan"),ATKN("scope")=SCOPE
"RTN","RGNETOAT",54,0)
 D SETATKN(.ATKN)
"RTN","RGNETOAT",55,0)
 Q ATKN
"RTN","RGNETOAT",56,0)
 ; Generate a refresh token
"RTN","RGNETOAT",57,0)
NEWRTKN(CLIENT,USER,SCOPE) ;
"RTN","RGNETOAT",58,0)
 N RTKN
"RTN","RGNETOAT",59,0)
 S RTKN=$$UUID^RGUT,RTKN("client")=CLIENT,RTKN("user")=USER
"RTN","RGNETOAT",60,0)
 S RTKN("scope")=SCOPE,RTKN("access_token")=""
"RTN","RGNETOAT",61,0)
 D SETRTKN(.RTKN)
"RTN","RGNETOAT",62,0)
 Q RTKN
"RTN","RGNETOAT",63,0)
 ; Revoke access token
"RTN","RGNETOAT",64,0)
REVATKN(ATKN) ;
"RTN","RGNETOAT",65,0)
 D DELOBJ^RGNETOA(.ATKN,"ATKN")
"RTN","RGNETOAT",66,0)
 Q
"RTN","RGNETOAT",67,0)
 ; Refresh access token
"RTN","RGNETOAT",68,0)
REFATKN(RTKN) ;
"RTN","RGNETOAT",69,0)
 N ATKN,CLIENT
"RTN","RGNETOAT",70,0)
 D GETRTKN(.RTKN)
"RTN","RGNETOAT",71,0)
 I $D(RTKN)>1 D
"RTN","RGNETOAT",72,0)
 .S ATKN=RTKN("access_token"),CLIENT=RTKN("client")
"RTN","RGNETOAT",73,0)
 .D:$L(ATKN) REVATKN(ATKN)
"RTN","RGNETOAT",74,0)
 .S ATKN=$$NEWATKN(.CLIENT,RTKN("user"),RTKN("scope"))
"RTN","RGNETOAT",75,0)
 .S RTKN("access_token")=ATKN
"RTN","RGNETOAT",76,0)
 .D SETRTKN(.RTKN)
"RTN","RGNETOAT",77,0)
 Q $G(ATKN)
"RTN","RGNETOAT",78,0)
 ; Returns the user DUZ if access token is valid
"RTN","RGNETOAT",79,0)
 ; Revokes any expired tokens
"RTN","RGNETOAT",80,0)
ISVALID(ATKN) ;
"RTN","RGNETOAT",81,0)
 N EXP,VALID
"RTN","RGNETOAT",82,0)
 D GETATKN(.ATKN)
"RTN","RGNETOAT",83,0)
 S EXP=$G(ATKN("expiry")),VALID=$S('EXP:0,1:$$NOW^XLFDT>EXP)
"RTN","RGNETOAT",84,0)
 I EXP,'VALID D REVATKN(ATKN)
"RTN","RGNETOAT",85,0)
 Q $S(VALID:ATKN("user"),1:0)
"SEC","^DIC",996.52,996.52,0,"AUDIT")
@
"SEC","^DIC",996.52,996.52,0,"DD")
@
"SEC","^DIC",996.52,996.52,0,"DEL")
@
"SEC","^DIC",996.52,996.52,0,"LAYGO")
@
"SEC","^DIC",996.52,996.52,0,"RD")
@
"SEC","^DIC",996.52,996.52,0,"WR")
@
"SEC","^DIC",996.53,996.53,0,"AUDIT")
@
"SEC","^DIC",996.53,996.53,0,"DD")
@
"SEC","^DIC",996.53,996.53,0,"DEL")
@
"SEC","^DIC",996.53,996.53,0,"LAYGO")
@
"SEC","^DIC",996.53,996.53,0,"RD")
@
"SEC","^DIC",996.53,996.53,0,"WR")
@
"VER")
8.0^22.0
"^DD",996.52,996.52,0)
FIELD^^2^5
"^DD",996.52,996.52,0,"DDA")
N
"^DD",996.52,996.52,0,"DT")
3150331
"^DD",996.52,996.52,0,"IX","B",996.52,.01)

"^DD",996.52,996.52,0,"NM","NETSERV HTTP ENDPOINT")

"^DD",996.52,996.52,.01,0)
URL^RF^^0;1^K:$L(X)>150!($L(X)<1) X
"^DD",996.52,996.52,.01,1,0)
^.1
"^DD",996.52,996.52,.01,1,1,0)
996.52^B
"^DD",996.52,996.52,.01,1,1,1)
S ^RGNET(996.52,"B",$E(X,1,30),DA)=""
"^DD",996.52,996.52,.01,1,1,2)
K ^RGNET(996.52,"B",$E(X,1,30),DA)
"^DD",996.52,996.52,.01,3)
Enter URL pattern for this endpoint.
"^DD",996.52,996.52,.01,21,0)
^^6^6^3150330.151834
"^DD",996.52,996.52,.01,21,1,0)
This is the pattern to which a request URL is to be matched.  It may contain
"^DD",996.52,996.52,.01,21,2,0)
the following wildcard characters:
"^DD",996.52,996.52,.01,21,3,0)

"^DD",996.52,996.52,.01,21,4,0)
       * Matches any character sequence.
"^DD",996.52,996.52,.01,21,5,0)
       # Matches any sequence of digits.
"^DD",996.52,996.52,.01,21,6,0)

"^DD",996.52,996.52,.01,"DT")
3150330
"^DD",996.52,996.52,1,0)
METHOD^S^GET:GET;HEAD:HEAD;POST:POST;PUT:PUT;DELETE:DELETE;^0;2^Q
"^DD",996.52,996.52,1,"DT")
3150330
"^DD",996.52,996.52,2,0)
AUTH^S^BASIC:BASIC AUTHENTICATION;BEARER:OAUTH2 AUTHENTICATION;^0;3^Q
"^DD",996.52,996.52,2,3)
Enter authentication type (or no entry for none).
"^DD",996.52,996.52,2,21,0)
^^6^6^3150331.200154
"^DD",996.52,996.52,2,21,1,0)
This determines the type of authentication required for the associated endpoint.
"^DD",996.52,996.52,2,21,2,0)

"^DD",996.52,996.52,2,21,3,0)
       BASIC - Basic authentication (username/password)
"^DD",996.52,996.52,2,21,4,0)
       OAUTH - OAuth2 authentication (bearer)
"^DD",996.52,996.52,2,21,5,0)

"^DD",996.52,996.52,2,21,6,0)
No entry means that no authentication is required.
"^DD",996.52,996.52,2,"DT")
3150331
"^DD",996.52,996.52,10,0)
HANDLER^FX^^10;E1,250^K:X'?.8AN1"^"1.8AN X
"^DD",996.52,996.52,10,3)
Enter the handler entry point as TAG^ROUTINE.
"^DD",996.52,996.52,10,"DT")
3150330
"^DD",996.52,996.52,99,0)
DESCRIPTION^996.5299^^99;0
"^DD",996.52,996.5299,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",996.52,996.5299,0,"DT")
3150330
"^DD",996.52,996.5299,0,"NM","DESCRIPTION")

"^DD",996.52,996.5299,0,"UP")
996.52
"^DD",996.52,996.5299,.01,0)
DESCRIPTION^WL^^0;1^Q
"^DD",996.52,996.5299,.01,21,0)
^^1^1^3150330.181043
"^DD",996.52,996.5299,.01,21,1,0)
Provides a detailed description of this end point.
"^DD",996.52,996.5299,.01,"DT")
3150330
"^DD",996.53,996.53,0)
FIELD^^4^6
"^DD",996.53,996.53,0,"DDA")
N
"^DD",996.53,996.53,0,"DT")
3150327
"^DD",996.53,996.53,0,"IX","B",996.53,.01)

"^DD",996.53,996.53,0,"IX","C",996.53,1)

"^DD",996.53,996.53,0,"NM","NETSERV OAUTH CONTROL")

"^DD",996.53,996.53,.01,0)
APPLICATION NAME^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",996.53,996.53,.01,1,0)
^.1
"^DD",996.53,996.53,.01,1,1,0)
996.53^B^MUMPS
"^DD",996.53,996.53,.01,1,1,1)
S ^RGNET(996.53,"B",X,DA)=""
"^DD",996.53,996.53,.01,1,1,2)
K ^RGNET(996.53,"B",X,DA)
"^DD",996.53,996.53,.01,1,1,"DT")
3150326
"^DD",996.53,996.53,.01,3)
Answer must be 3-30 characters in length.
"^DD",996.53,996.53,.01,"DT")
3150326
"^DD",996.53,996.53,1,0)
CLIENT ID^F^^0;2^K:$L(X)>100!($L(X)<1) X
"^DD",996.53,996.53,1,1,0)
^.1
"^DD",996.53,996.53,1,1,1,0)
996.53^C^MUMPS
"^DD",996.53,996.53,1,1,1,1)
S ^RGNET(996.53,"C",X,DA)=""
"^DD",996.53,996.53,1,1,1,2)
K ^RGNET(996.53,"C",X,DA)
"^DD",996.53,996.53,1,1,1,"DT")
3150326
"^DD",996.53,996.53,1,3)
Answer must be 1-100 characters in length.
"^DD",996.53,996.53,1,"DT")
3150326
"^DD",996.53,996.53,2,0)
CLIENT SECRET^F^^0;3^K:$L(X)>100!($L(X)<1) X
"^DD",996.53,996.53,2,3)
Answer must be 1-100 characters in length.
"^DD",996.53,996.53,2,"DT")
3150326
"^DD",996.53,996.53,3,0)
ACCESS TOKEN LIFESPAN^NJ9,0^^0;4^K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",996.53,996.53,3,3)
Enter lifespan (in seconds) of an issued access token.
"^DD",996.53,996.53,3,"DT")
3150326
"^DD",996.53,996.53,4,0)
FLOW TYPE^S^U:User agent flow;W:Web server flow;P:Username and password flow;C:Client credentials;^0;5^Q
"^DD",996.53,996.53,4,3)
Enter OAuth flow supported for this client.
"^DD",996.53,996.53,4,21,0)
^^25^25^3150327.111709
"^DD",996.53,996.53,4,21,1,0)
The OAuth flow allowed for this client.  Supported flows are:
"^DD",996.53,996.53,4,21,2,0)

"^DD",996.53,996.53,4,21,3,0)
U - User-Agent Flow : Suitable for clients typically implemented in user-
"^DD",996.53,996.53,4,21,4,0)
agents (for example, clients running inside a web browser) using a scripting 
"^DD",996.53,996.53,4,21,5,0)
language such as JavaScript. Mostly used by native applications for mobile or 
"^DD",996.53,996.53,4,21,6,0)
desktop, leveraging the embedded or external browser as the user-agent for 
"^DD",996.53,996.53,4,21,7,0)
authorization and it uses the Implicit Grant authorization.
"^DD",996.53,996.53,4,21,8,0)

"^DD",996.53,996.53,4,21,9,0)
W - Web Server Flow : This makes use of the Authorization Code grant and is a 
"^DD",996.53,996.53,4,21,10,0)
redirection-based flow which requires interaction with the end-user's user-
"^DD",996.53,996.53,4,21,11,0)
agent. Thus, it is most suitable for clients which are a part of web-server 
"^DD",996.53,996.53,4,21,12,0)
based applications, that are typically accessed via a web browser.
"^DD",996.53,996.53,4,21,13,0)

"^DD",996.53,996.53,4,21,14,0)
P - Username and Password Flow : Used only when there is a high trust between 
"^DD",996.53,996.53,4,21,15,0)
the client and the resource owner and when other flows are not viable, as it 
"^DD",996.53,996.53,4,21,16,0)
involves the transfer of the resource owner's credentials. Examples of 
"^DD",996.53,996.53,4,21,17,0)
clients can be a device operating system or a highly privileged application. 
"^DD",996.53,996.53,4,21,18,0)
This can also be used to migrate existing clients using HTTP Basic or Digest 
"^DD",996.53,996.53,4,21,19,0)
Authentication schemes to OAuth by converting the stored credentials to an 
"^DD",996.53,996.53,4,21,20,0)
access token.
"^DD",996.53,996.53,4,21,21,0)

"^DD",996.53,996.53,4,21,22,0)
C - Client Credentials Flow : OAuth is mainly used for delegated access, but 
"^DD",996.53,996.53,4,21,23,0)
there are cases when the client owns the resource or already has been granted 
"^DD",996.53,996.53,4,21,24,0)
the delegated access outside of a typical OAuth flow. Here you just exchange 
"^DD",996.53,996.53,4,21,25,0)
client credentials for an access token. 
"^DD",996.53,996.53,4,"DT")
3150327
"^DD",996.53,996.53,10,0)
REDIRECT URL^F^^10;E1,250^K:$L(X)>250!($L(X)<1) X
"^DD",996.53,996.53,10,3)
Answer must be 1-250 characters in length.
"^DD",996.53,996.53,10,"DT")
3150326
"^DIC",996.52,996.52,0)
NETSERV HTTP ENDPOINT^996.52
"^DIC",996.52,996.52,0,"GL")
^RGNET(996.52,
"^DIC",996.52,996.52,"%",0)
^1.005^^
"^DIC",996.52,996.52,"%D",0)
^^3^3^3150330.180223
"^DIC",996.52,996.52,"%D",1,0)
This file defines execution endpoints for HTTP-based services. A service 
"^DIC",996.52,996.52,"%D",2,0)
request is matched to its respective endpoint by matching the request method 
"^DIC",996.52,996.52,"%D",3,0)
and the request URL to the corresponding entry in this file.
"^DIC",996.52,"B","NETSERV HTTP ENDPOINT",996.52)

"^DIC",996.53,996.53,0)
NETSERV OAUTH CONTROL^996.53
"^DIC",996.53,996.53,0,"GL")
^RGNET(996.53,
"^DIC",996.53,996.53,"%",0)
^1.005^^0
"^DIC",996.53,"B","NETSERV OAUTH CONTROL",996.53)

**END**
**END**
